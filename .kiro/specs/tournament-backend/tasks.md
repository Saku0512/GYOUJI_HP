# 実装計画

- [x] 1. プロジェクト構造と依存関係のセットアップ





  - 設計に従ってディレクトリ構造を作成（cmd/server, internal/handler, internal/service, internal/repository）
  - 必要な依存関係でgo.modを更新（JWT、MySQLドライバー、bcrypt）
  - データベースとJWT設定の設定管理を作成
  - _要件: 6.1, 7.1_

- [x] 2. コアデータモデルとデータベーススキーマの実装




  - [x] 2.1 データモデル構造体の作成


    - 適切なJSONとデータベースタグを持つUser、Tournament、Match、Bracket構造体を定義
    - 各モデルの検証メソッドを実装
    - 列挙型の定数を作成（スポーツ、試合ステータス、トーナメントステータス）
    - _要件: 3.1, 3.2_
  
  - [x] 2.2 データベースマイグレーションスクリプトの作成


    - users、tournaments、matchesテーブル作成のSQLスクリプトを作成
    - 適切なインデックスを持つデータベース初期化スクリプトを作成
    - コネクションプールを使用したデータベース接続ユーティリティを実装
    - _要件: 3.1, 3.3_

- [ ] 3. リポジトリ層の実装
  - [x] 3.1 ベースリポジトリインターフェースと実装の作成






    - 共通データベース操作インターフェースを定義
    - データベース接続管理を実装
    - データベース操作のエラーハンドリングユーティリティを作成
    - _要件: 3.1, 3.4, 7.2_
  
  - [x] 3.2 UserRepositoryの実装






    - UserRepositoryインターフェースとMySQL実装を作成
    - GetAdminUserとValidateCredentialsメソッドを実装
    - ユーザーリポジトリ操作の単体テストを作成
    - _要件: 1.1, 1.2, 3.5_
  
  - [x] 3.3 TournamentRepositoryの実装





    - TournamentRepositoryインターフェースとMySQL実装を作成
    - トーナメントのCRUD操作を実装
    - ブラケット生成のためのGetTournamentBracketメソッドを実装
    - トーナメントリポジトリ操作の単体テストを作成
    - _要件: 2.2, 2.4, 4.2_
  
  - [x] 3.4 MatchRepositoryの実装





    - MatchRepositoryインターフェースとMySQL実装を作成
    - 試合のCRUD操作とスポーツ/トーナメント別クエリを実装
    - 試合結果更新機能を実装
    - 試合リポジトリ操作の単体テストを作成
    - _要件: 2.3, 2.4, 4.3_

- [x] 4. サービス層ビジネスロジックの実装




  - [x] 4.1 AuthServiceの作成


    - JWTトークン生成と検証を実装
    - bcryptを使用したパスワードハッシュ化と検証を作成
    - 認証情報検証を含むログインロジックを実装
    - 認証サービスの単体テストを作成
    - _要件: 1.1, 1.3, 1.4_
  
  - [x] 4.2 TournamentServiceの作成


    - トーナメント管理ビジネスロジックを実装
    - 各スポーツタイプのブラケット生成ロジックを作成
    - トーナメント形式切り替えを実装（卓球の天候条件用）
    - トーナメントサービス操作の単体テストを作成
    - _要件: 2.1, 2.2, 5.1, 5.2, 5.3, 5.5_
  
  - [x] 4.3 MatchServiceの作成


    - 試合作成と結果処理ロジックを実装
    - トーナメント進行のための勝者進出ロジックを作成
    - 試合検証とトーナメントルール強制を実装
    - 試合サービス操作の単体テストを作成
    - _要件: 2.3, 2.4, 5.4_

- [x] 5. HTTPハンドラーとミドルウェアの実装





  - [x] 5.1 認証ミドルウェアの作成


    - JWTトークン検証ミドルウェアを実装
    - 管理者専用アクセスミドルウェアを作成
    - 認証失敗のエラーハンドリングを実装
    - 認証ミドルウェアのテストを作成
    - _要件: 1.3, 1.4, 6.5_
  
  - [x] 5.2 AuthHandlerの作成


    - ログインエンドポイントハンドラーを実装
    - トークンリフレッシュエンドポイントハンドラーを作成
    - 認証の適切なエラーレスポンスを実装
    - 認証エンドポイントの統合テストを作成
    - _要件: 1.1, 1.2, 6.1_
  

  - [x] 5.3 TournamentHandlerの作成




    - トーナメントCRUDエンドポイントハンドラーを実装
    - トーナメントブラケット取得エンドポイントを作成
    - トーナメント形式切り替えエンドポイントを実装
    - トーナメントエンドポイントの統合テストを作成
    - _要件: 2.1, 2.2, 4.2, 6.2, 6.4_
  
  - [x] 5.4 MatchHandlerの作成




    - 試合作成・更新エンドポイントハンドラーを実装
    - スポーツ別フィルタリング付き試合取得エンドポイントを作成
    - 検証付き試合結果提出を実装
    - 試合エンドポイントの統合テストを作成
    - _要件: 2.3, 2.4, 4.1, 4.3, 6.3, 6.4_

- [x] 6. ルーティングとサーバー設定のセットアップ





  - [x] 6.1 Ginルーターとミドルウェアの設定


    - CORSミドルウェア付きGinルーターをセットアップ
    - リクエスト/レスポンス追跡のためのログミドルウェアを設定
    - 一貫したエラーレスポンスのためのエラーハンドリングミドルウェアを実装
    - 認証エンドポイントのレート制限ミドルウェアを設定
    - _要件: 6.1, 6.2, 6.3, 6.4, 6.5, 7.1, 7.2_
  

  - [x] 6.2 メインサーバーエントリーポイントの作成

    - cmd/server/main.goでサーバー起動ロジックを実装
    - データベース接続初期化を設定
    - グレースフルシャットダウンハンドリングをセットアップ
    - 環境ベースの設定読み込みを実装
    - _要件: 3.1, 3.3, 7.1_

- [x] 7. トーナメント初期化とシーディングの実装



  - [x] 7.1 トーナメントシーディングロジックの作成


    - 3つのスポーツすべての初期トーナメントデータシーディングを実装
    - READMEのトーナメントブラケットに基づくチームと試合の初期化を作成
    - タイムスロット付きの適切な試合スケジューリングを実装
    - トーナメント初期化のテストを作成
    - _要件: 2.1, 2.2, 5.1, 5.2, 5.3_
  
  - [x] 7.2 データベースシーディングスクリプトの作成


    - 管理者ユーザーシーディングスクリプトを作成
    - トーナメントと初期試合データのシーディングを実装
    - 開発用のデータベースリセットと再シーディングユーティリティを作成
    - _要件: 1.5, 2.1, 2.2_

- [x] 8. 包括的なエラーハンドリングとログの追加





  - [x] 8.1 構造化ログの実装


    - 適切なログレベルで構造化ログをセットアップ
    - リクエスト相関のためのリクエストID追跡を実装
    - 開発環境と本番環境のログフォーマットを作成
    - _要件: 7.1, 7.3_
  
  - [x] 8.2 包括的なエラーハンドリングの作成


    - 異なるエラーカテゴリのカスタムエラータイプを実装
    - エラーレスポンスフォーマットミドルウェアを作成
    - 適切なHTTPステータスコード付きデータベースエラーハンドリングを実装
    - エラーハンドリングシナリオのテストを作成
    - _要件: 7.2, 7.4, 7.5_

- [ ] 9. 統合テストとAPIドキュメントの作成
  - [ ] 9.1 包括的な統合テストの作成
    - テストデータベースのセットアップとティアダウンユーティリティを作成
    - すべてのエンドポイントのエンドツーエンドAPIテストを実装
    - トーナメント進行ワークフローのテストシナリオを作成
    - 認証と認可フローをテスト
    - _要件: 1.1, 1.2, 1.3, 2.1, 2.2, 2.3, 2.4_
  
  - [ ] 9.2 APIドキュメントの追加
    - すべてのエンドポイントのOpenAPI/Swaggerドキュメントを作成
    - リクエスト/レスポンススキーマとエラーコードを文書化
    - 各エンドポイントのリクエストとレスポンスの例を追加
    - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 10. Docker統合とデプロイ準備
  - [ ] 10.1 バックエンド用Dockerfileの作成
    - Goバックエンド用のマルチステージDockerfileを作成
    - 適切なビルド最適化とセキュリティプラクティスを設定
    - 既存のフロントエンドとデータベースとのdocker-compose統合を作成
    - _要件: 3.1, 3.5_
  
  - [ ] 10.2 docker-compose設定の更新
    - 既存のdocker-compose.ymlにバックエンドサービスを追加
    - バックエンドデータベース用のMySQLサービスを設定
    - フロントエンド、バックエンド、データベース間の適切なネットワーキングをセットアップ
    - 環境変数とシークレット管理を設定
    - _要件: 3.1, 3.5_