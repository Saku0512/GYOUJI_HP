# 実装計画

- [x] 1. バックエンドレスポンス形式の統一




  - [x] 1.1 統一APIレスポンス構造体の実装


    - 統一されたAPIResponse構造体をbackend/internal/modelsに作成
    - 成功・エラー両方に対応した一貫したレスポンス形式を定義
    - タイムスタンプとリクエストID追跡機能を追加
    - _要件: 1.1, 5.1, 5.2_

  - [x] 1.2 ベースハンドラーの作成


    - 共通のレスポンス送信メソッドを持つBaseHandlerを実装
    - SendSuccess、SendError、SendValidationErrorメソッドを作成
    - 全ハンドラーで使用可能な統一されたレスポンス機能を提供
    - _要件: 1.1, 5.1, 5.2, 5.3_

  - [x] 1.3 エラーハンドリングミドルウェアの統一


    - 統一されたエラーコード体系を定義
    - カスタムAPIError型を実装
    - エラーハンドリングミドルウェアを更新して統一形式で出力
    - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 2. エンドポイント構造の標準化



  - [x] 2.1 APIバージョニングの導入


    - /api/v1プレフィックスを全エンドポイントに追加
    - ルーター設定を更新してバージョン管理を実装
    - 後方互換性維持のための旧エンドポイント対応
    - _要件: 1.5, 2.1, 2.2_

  - [x] 2.2 エンドポイントパス構造の統一


    - RESTful設計原則に従ったパス構造に統一
    - 重複エンドポイントの整理と統合
    - 一貫したネーミング規則の適用
    - _要件: 2.1, 2.2, 2.3, 2.4_

  - [x] 2.3 ルーティング設定の更新


    - router.goを更新して新しいエンドポイント構造を適用
    - 認証が必要なエンドポイントと不要なエンドポイントの明確な分離
    - 管理者専用エンドポイントの適切なグループ化
    - _要件: 2.1, 2.2, 2.3, 2.4, 4.2_

- [ ] 3. データ型とシリアライゼーションの統一
  - [ ] 3.1 統一データ型定義の作成
    - 列挙型（SportType、TournamentStatus、MatchStatus）の定義
    - 統一された日時形式（ISO 8601）の適用
    - null値処理の明確化とポインタ型の適切な使用
    - _要件: 3.1, 3.2, 3.3, 3.4, 3.5_

  - [ ] 3.2 リクエスト・レスポンス構造体の統一
    - 全ハンドラーのリクエスト構造体を統一形式に更新
    - レスポンス構造体の一貫性を確保
    - バリデーションタグの統一と強化
    - _要件: 3.1, 3.2, 3.3, 3.4_

  - [ ] 3.3 JSON シリアライゼーションの統一
    - 日時フィールドのカスタムマーシャリング実装
    - null値の適切な処理とomitemptyタグの統一
    - 数値型の一貫性確保（intとstringの混在解消）
    - _要件: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 4. 認証・認可システムの統合
  - [ ] 4.1 JWT仕様の統一
    - 統一されたJWTクレーム構造の実装
    - トークン生成・検証ロジックの標準化
    - トークンの有効期限とリフレッシュ機能の統一
    - _要件: 4.1, 4.2, 4.3, 4.4_

  - [ ] 4.2 認証ミドルウェアの統一
    - 統一された認証ミドルウェアの実装
    - エラーレスポンスの標準化
    - ユーザー情報のコンテキスト設定の統一
    - _要件: 4.1, 4.2, 4.3, 4.4, 4.5_

  - [ ] 4.3 CORS設定の統一
    - 開発・本番環境に対応したCORS設定の実装
    - 許可するオリジン、メソッド、ヘッダーの標準化
    - セキュリティヘッダーの適切な設定
    - _要件: 4.4, 4.5_

- [ ] 5. バックエンドハンドラーの更新
  - [ ] 5.1 AuthHandlerの統一
    - 統一されたレスポンス形式を使用するよう更新
    - エラーハンドリングの標準化
    - バリデーション処理の統一
    - _要件: 1.1, 4.1, 4.2, 5.1, 5.2_

  - [ ] 5.2 TournamentHandlerの統一
    - 統一されたレスポンス形式とエラーハンドリングを適用
    - データ型の統一とシリアライゼーション修正
    - エンドポイントパスの標準化対応
    - _要件: 1.1, 2.1, 2.2, 3.1, 5.1, 5.2_

  - [ ] 5.3 MatchHandlerの統一
    - 統一されたレスポンス形式とエラーハンドリングを適用
    - 試合結果更新のバリデーション強化
    - データ型の統一とnull値処理の改善
    - _要件: 1.1, 2.1, 2.2, 3.1, 5.1, 5.2_

- [ ] 6. フロントエンドAPIクライアントの統合
  - [ ] 6.1 統一APIクライアントの実装
    - UnifiedAPIClientクラスの作成
    - 統一されたリクエスト・レスポンス処理
    - エラーハンドリングの標準化
    - _要件: 1.1, 5.1, 5.2, 7.1_

  - [ ] 6.2 型定義の統一
    - TypeScript型定義ファイルの作成
    - バックエンドと一致するデータ型の定義
    - 列挙型とインターフェースの統一
    - _要件: 3.1, 3.2, 3.3, 7.1_

  - [ ] 6.3 既存APIクライアントの移行
    - auth.js、tournament.js、matches.jsを新しい統一クライアントに移行
    - エンドポイントパスの更新
    - エラーハンドリングの統一
    - _要件: 1.1, 2.1, 2.2, 5.1, 7.1_

- [ ] 7. バリデーションシステムの統合
  - [ ] 7.1 バックエンドバリデーションの強化
    - 統一されたバリデーションルールの実装
    - カスタムバリデーター関数の作成
    - バリデーションエラーメッセージの標準化
    - _要件: 3.4, 5.1, 5.2, 5.3_

  - [ ] 7.2 フロントエンドバリデーションの統一
    - バックエンドと一致するバリデーションルールの実装
    - リアルタイムバリデーション機能の統一
    - エラー表示の標準化
    - _要件: 3.4, 5.1, 7.4_

  - [ ] 7.3 バリデーションエラーレスポンスの統一
    - フィールド別エラー情報の詳細化
    - 多言語対応エラーメッセージの実装
    - クライアント側での適切なエラー表示
    - _要件: 5.1, 5.2, 5.3, 7.4_

- [ ] 8. リアルタイム更新システムの統合
  - [ ] 8.1 WebSocket統合の実装
    - WebSocket接続管理システムの実装
    - 認証されたWebSocket接続の管理
    - スポーツ別購読システムの実装
    - _要件: 6.1, 6.2, 6.3, 6.4_

  - [ ] 8.2 更新通知システムの実装
    - 統一された更新通知形式の定義
    - トーナメント・試合更新時の自動通知
    - 接続管理とエラーハンドリング
    - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_

  - [ ] 8.3 ポーリング代替システムの実装
    - WebSocket利用不可時のポーリング機能
    - 効率的なデータ更新チェック機能
    - 接続状態管理とフォールバック機能
    - _要件: 6.1, 6.2, 6.5_

- [ ] 9. キャッシュとパフォーマンス最適化
  - [ ] 9.1 統一キャッシュシステムの実装
    - Redis統合キャッシュマネージャーの実装
    - トーナメント・試合データの効率的なキャッシュ
    - キャッシュ無効化戦略の実装
    - _要件: 8.1, 8.2, 8.3_

  - [ ] 9.2 ページネーション機能の統一
    - 統一されたページネーション構造の実装
    - 大量データの効率的な取得機能
    - フロントエンドでのページネーション対応
    - _要件: 8.1, 8.4_

  - [ ] 9.3 レスポンス圧縮とヘッダー最適化
    - gzip圧縮の適切な設定
    - キャッシュヘッダーの最適化
    - 不要なデータ転送の削減
    - _要件: 8.1, 8.5_

- [ ] 10. セキュリティ強化
  - [ ] 10.1 レート制限システムの統一
    - エンドポイント別レート制限の実装
    - IP別・ユーザー別制限の設定
    - 制限超過時の適切なエラーレスポンス
    - _要件: 4.5, 5.5_

  - [ ] 10.2 セキュリティヘッダーの統一
    - CSP、HSTS、その他セキュリティヘッダーの設定
    - XSS、CSRF対策の強化
    - セキュアなCookie設定
    - _要件: 4.5_

  - [ ] 10.3 入力サニタイゼーションの強化
    - SQLインジェクション対策の強化
    - XSS攻撃対策の実装
    - 入力データの適切なエスケープ処理
    - _要件: 4.5, 5.3_

- [ ] 11. APIドキュメントとテストの統合
  - [ ] 11.1 OpenAPI仕様書の作成
    - 統一されたAPI仕様書の作成
    - 全エンドポイントの詳細ドキュメント化
    - リクエスト・レスポンス例の追加
    - _要件: 7.1, 7.2, 7.3_

  - [ ] 11.2 契約テストの実装
    - フロントエンド・バックエンド間の契約テスト
    - API仕様変更の自動検出機能
    - 継続的インテグレーションでのテスト実行
    - _要件: 7.1, 7.2, 7.4, 7.5_

  - [ ] 11.3 統合テストの強化
    - エンドツーエンドAPIテストの実装
    - 認証フローの統合テスト
    - エラーケースの包括的テスト
    - _要件: 7.1, 7.4, 7.5_

- [ ] 12. モニタリングとログの統合
  - [ ] 12.1 統一ログシステムの実装
    - 構造化ログの実装
    - リクエストID追跡機能の強化
    - ログレベルの統一と設定
    - _要件: 5.5, 7.5_

  - [ ] 12.2 メトリクス収集システムの実装
    - API使用状況の監視
    - パフォーマンスメトリクスの収集
    - エラー率とレスポンス時間の追跡
    - _要件: 8.1, 8.5_

  - [ ] 12.3 アラートシステムの実装
    - 異常検知とアラート機能
    - システム健全性の監視
    - 自動復旧機能の実装
    - _要件: 5.5, 8.5_

- [ ] 13. 移行とデプロイメント
  - [ ] 13.1 段階的移行計画の実行
    - 後方互換性を維持した段階的移行
    - 旧APIエンドポイントの廃止予定通知
    - フロントエンドの段階的更新
    - _要件: 1.5, 2.5_

  - [ ] 13.2 デプロイメント自動化の更新
    - CI/CDパイプラインの更新
    - 統合テストの自動実行
    - ロールバック機能の強化
    - _要件: 7.5_

  - [ ] 13.3 本番環境での検証
    - 本番環境でのAPI統合テスト
    - パフォーマンス検証とチューニング
    - ユーザー受け入れテストの実施
    - _要件: 8.1, 8.5_

- [ ] 14. ドキュメントと保守性の向上
  - [ ] 14.1 開発者ドキュメントの更新
    - API統合ガイドの作成
    - トラブルシューティングガイドの作成
    - ベストプラクティス文書の作成
    - _要件: 7.1, 7.2_

  - [ ] 14.2 コード品質の向上
    - リファクタリングとコード整理
    - 統一されたコーディング規約の適用
    - 技術的負債の解消
    - _要件: 1.1, 7.5_

  - [ ] 14.3 保守運用手順の確立
    - API変更時の手順書作成
    - 障害対応手順の整備
    - 定期メンテナンス手順の確立
    - _要件: 7.5, 8.5_