import{p as e,f as t,h as s,q as a,k as n,e as o,c as u,j as i,l as c,i as l,o as r,n as d,t as p,u as h,v}from"../../chunks/vendor.js";import{t as m,S as x}from"../../chunks/StaggeredList.js";import{u as f,a as w}from"../../chunks/api.js";import{L as g}from"../../chunks/LoadingSpinner.js";import{R as b,A as $}from"../../chunks/AnimatedTransition.js";function y(e,t=10){return e?e.length<=t?e:e.substring(0,t-3)+"...":""}function k(i,c){let l,r,d,p;e();let h=t(c.match,()=>({}),!0),v=t(c.editable,!1),m=t(c.compact,!1);var x,f,w,g;h.score1,h.score2,l=(x=h).winner?x.winner:null!==x.score1&&null!==x.score2&&void 0!==x.score1&&void 0!==x.score2?x.score1>x.score2?x.team1:x.score2>x.score1?x.team2:"draw":null,r=["match-card",m?"compact":"",v?"editable":"",""].filter(Boolean).join(" "),d=["team",l===h.team1?"winner":""].filter(Boolean).join(" "),p=["team",l===h.team2?"winner":""].filter(Boolean).join(" "),i.out.push(`<div${s(a(r),"svelte-l0munw")} data-testid="match-card"><div class="match-header svelte-l0munw">`),h.round?(i.out.push("\x3c!--[--\x3e"),i.out.push(`<div class="round svelte-l0munw" data-testid="match-round">${n(h.round)}</div>`)):i.out.push("\x3c!--[!--\x3e"),i.out.push("\x3c!--]--\x3e "),h.scheduled_at?(i.out.push("\x3c!--[--\x3e"),i.out.push(`<div class="schedule svelte-l0munw" data-testid="match-schedule">${n(new Date(h.scheduled_at).toLocaleDateString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))}</div>`)):i.out.push("\x3c!--[!--\x3e"),i.out.push(`\x3c!--]--\x3e</div> <div class="teams svelte-l0munw"><div${s(a(d),"svelte-l0munw")} data-testid="team1"><span class="team-name svelte-l0munw">${n(y(h.team1||"Team A",m?8:15))}</span> `),l===h.team1?(i.out.push("\x3c!--[--\x3e"),i.out.push('<span class="winner-badge svelte-l0munw">🏆</span>')):i.out.push("\x3c!--[!--\x3e"),i.out.push(`\x3c!--]--\x3e</div> <div class="vs-section svelte-l0munw"><span class="vs svelte-l0munw">vs</span></div> <div${s(a(p),"svelte-l0munw")} data-testid="team2">`),l===h.team2?(i.out.push("\x3c!--[--\x3e"),i.out.push('<span class="winner-badge svelte-l0munw">🏆</span>')):i.out.push("\x3c!--[!--\x3e"),i.out.push(`\x3c!--]--\x3e <span class="team-name svelte-l0munw">${n(y(h.team2||"Team B",m?8:15))}</span></div></div> <div class="score-section svelte-l0munw">`),i.out.push("\x3c!--[!--\x3e"),i.out.push('<div class="score-display svelte-l0munw" data-testid="score-display">'),null!==h.score1&&void 0!==h.score1&&null!==h.score2&&void 0!==h.score2?(i.out.push("\x3c!--[--\x3e"),i.out.push(`<div class="score svelte-l0munw">${n((w=h.score1,g=h.score2,null==w||null==g?"未実施":`${w} - ${g}`))}</div>`)):(i.out.push("\x3c!--[!--\x3e"),i.out.push(`<div class="status svelte-l0munw" data-testid="match-status">${n((f=h.status||"pending",{pending:"未実施",in_progress:"進行中",completed:"完了",cancelled:"キャンセル"}[f]||f))}</div>`)),i.out.push("\x3c!--]--\x3e</div> "),v&&"completed"!==h.status?(i.out.push("\x3c!--[--\x3e"),i.out.push('<button class="edit-btn svelte-l0munw" data-testid="edit-match-btn" aria-label="試合結果を編集">✏️ 編集</button>')):i.out.push("\x3c!--[!--\x3e"),i.out.push("\x3c!--]--\x3e"),i.out.push("\x3c!--]--\x3e</div> "),m||!h.completed_at&&"completed"!==h.status?i.out.push("\x3c!--[!--\x3e"):(i.out.push("\x3c!--[--\x3e"),i.out.push(`<div class="match-details svelte-l0munw"><div class="completion-time svelte-l0munw" data-testid="completion-time">完了: ${n(new Date(h.completed_at).toLocaleDateString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))}</div></div>`)),i.out.push("\x3c!--]--\x3e</div>"),o(c,{match:h,editable:v,compact:m}),u()}function q(a,y){var q;let _,j,S,L;e();const z=[{key:"volleyball",name:"バレーボール",icon:"🏐"},{key:"table_tennis",name:"卓球",icon:"🏓"},{key:"soccer",name:"サッカー",icon:"⚽"}];function A(e){const t=z.find(t=>t.key===e);return t?t.name:e}r(()=>{}),"undefined"!=typeof document&&document.addEventListener("visibilitychange",function(){"undefined"!=typeof document&&(document.hidden||async function(e,t=!0){try{t&&w.setLoading(!0);const s=await m.fetchTournaments(e);return s.success||w.showNotification(s.message||"データの取得に失敗しました","error"),s}catch(s){return w.showNotification("データの読み込みでエラーが発生しました","error"),{success:!1,message:s.message}}finally{t&&w.setLoading(!1)}}(_.currentSport,!1))}),_=d(q??={},"$tournamentStore",m),j=d(q??={},"$uiStore",f),S=_.tournaments[_.currentSport]||null,L=S?.matches||[],p(a,e=>{e.title=`<title>トーナメント管理システム - ${n(A(_.currentSport))}</title>`,e.out.push('<meta name="description" content="バレーボール、卓球、サッカーのトーナメント結果をリアルタイムで確認できます"/>')}),b(a,{children:v,$$slots:{default:(a,{screenSize:r,screenWidth:d})=>{a.out.push('<div class="homepage svelte-eh2fp7">'),b(a,{container:!0,padding:!0,children:a=>{a.out.push(`<div class="page-header svelte-eh2fp7"><h1 class="page-title responsive-text size-4xl svelte-eh2fp7">トーナメント管理システム</h1> <p class="page-description responsive-text size-lg svelte-eh2fp7">リアルタイムでトーナメントの進行状況を確認できます</p> <div class="header-actions responsive-flex justify-center align-center svelte-eh2fp7"><button class="refresh-button touch-friendly svelte-eh2fp7"${l("disabled",_.loading||j.loading,!0)} aria-label="データを更新"><span${s("refresh-icon svelte-eh2fp7",void 0,{spinning:_.loading||j.loading})}>🔄</span> 更新</button> `),_.lastUpdated?(a.out.push("\x3c!--[--\x3e"),a.out.push(`<span class="last-updated responsive-text size-sm svelte-eh2fp7">最終更新: ${n(new Date(_.lastUpdated).toLocaleTimeString("ja-JP"))}</span>`)):a.out.push("\x3c!--[!--\x3e"),a.out.push('\x3c!--]--\x3e</div></div> <div class="sports-tabs svelte-eh2fp7">'),x(a,{items:z.map(e=>({...e,id:e.key})),staggerDelay:150,animationType:"scaleIn",tag:"div",itemTag:"div",className:"tabs-grid",itemClassName:"tab-item",children:v,$$slots:{default:(e,{item:t})=>{e.out.push(`<button slot="default"${s("sport-tab touch-friendly hover-scale transition-all svelte-eh2fp7",void 0,{active:_.currentSport===t.key})}${l("disabled",_.loading,!0)}${l("aria-label",`${i(t.name)}のトーナメントを表示`)}><span class="sport-icon svelte-eh2fp7">${n(t.icon)}</span> <span class="sport-name responsive-text size-sm svelte-eh2fp7">${n(t.name)}</span></button>`)}}}),a.out.push('\x3c!----\x3e</div> <div class="main-content svelte-eh2fp7">'),_.error?(a.out.push("\x3c!--[--\x3e"),a.out.push(`<div class="error-container svelte-eh2fp7"><div class="error-message svelte-eh2fp7"><h3 class="svelte-eh2fp7">エラーが発生しました</h3> <p class="svelte-eh2fp7">${n(_.error)}</p> <button class="retry-button touch-friendly svelte-eh2fp7">再試行</button></div></div>`)):(a.out.push("\x3c!--[!--\x3e"),_.loading&&!S?(a.out.push("\x3c!--[--\x3e"),a.out.push('<div class="loading-container svelte-eh2fp7">'),g(a,{size:"large"}),a.out.push('\x3c!----\x3e <p class="loading-text responsive-text size-lg svelte-eh2fp7">トーナメントデータを読み込み中...</p></div>')):(a.out.push("\x3c!--[!--\x3e"),S&&L.length>0?(a.out.push("\x3c!--[--\x3e"),$(a,{show:!0,type:"fadeInUp",duration:500,className:"tournament-container",children:a=>{!function(a,r){let d,p;e();let h=t(r.sport,"volleyball"),v=t(r.matches,()=>[],!0),m=t(r.isAdmin,!1),x=t(r.onEditMatch,null);const f={round_1:"1回戦",round_2:"2回戦",quarterfinal:"準々決勝",semifinal:"準決勝",final:"決勝",third_place:"3位決定戦"};function w(e){if(e.winner)return e.winner;if(void 0!==e.score1&&void 0!==e.score2){if(e.score1>e.score2)return e.team1;if(e.score2>e.score1)return e.team2}return null}function g(e){return"completed"===e.status||void 0!==e.score1&&void 0!==e.score2?"completed":"in_progress"===e.status?"in_progress":"pending"}function b(){if("undefined"!=typeof window){const e=window.innerWidth;return e<768?"mobile":e<1024?"tablet":"desktop"}return"desktop"}let $="desktop";var y;if("undefined"!=typeof window&&($=b(),window.addEventListener("resize",()=>{$=b()})),y=v,d=Array.isArray(y)?y.reduce((e,t)=>{if(!t||"object"!=typeof t)return e;const s=t.round||"unknown";return e[s]||(e[s]=[]),e[s].push(t),e},{}):{},p=function(e){const t=Object.keys(e),s=["round_1","round_2","quarterfinal","semifinal","third_place","final"];return s.filter(e=>t.includes(e)).concat(t.filter(e=>!s.includes(e)))}(d),a.out.push(`<div${s(`tournament-bracket ${i($)}`,"svelte-10kswq8")}><div class="bracket-header svelte-10kswq8"><h2 class="tournament-title svelte-10kswq8">${n({volleyball:"バレーボール",table_tennis:"卓球",soccer:"サッカー"}[h]||h)} トーナメント</h2> `),0===v.length?(a.out.push("\x3c!--[--\x3e"),a.out.push('<p class="no-matches svelte-10kswq8">試合データがありません</p>')):a.out.push("\x3c!--[!--\x3e"),a.out.push("\x3c!--]--\x3e</div> "),v.length>0){a.out.push("\x3c!--[--\x3e");const e=c(p);a.out.push('<div class="bracket-container svelte-10kswq8">\x3c!--[--\x3e');for(let t=0,s=e.length;t<s;t++){let s=e[t];const o=c(d[s]);a.out.push(`<div class="round-column svelte-10kswq8"${l("data-round",s)}><h3 class="round-title svelte-10kswq8">${n(f[s]||s)}</h3> <div class="matches-container svelte-10kswq8">\x3c!--[--\x3e`);for(let e=0,t=o.length;e<t;e++){let t=o[e];a.out.push(`<div class="match-wrapper svelte-10kswq8"${l("data-status",g(t))}><div class="match-card-container svelte-10kswq8">`),k(a,{match:t,editable:m}),a.out.push("\x3c!----\x3e "),w(t)?(a.out.push("\x3c!--[--\x3e"),a.out.push(`<div class="winner-indicator svelte-10kswq8">勝者: ${n(w(t))}</div>`)):a.out.push("\x3c!--[!--\x3e"),a.out.push("\x3c!--]--\x3e "),m&&"pending"===g(t)?(a.out.push("\x3c!--[--\x3e"),a.out.push('<button class="edit-button svelte-10kswq8" aria-label="試合結果を編集">結果入力</button>')):a.out.push("\x3c!--[!--\x3e"),a.out.push("\x3c!--]--\x3e</div> "),"final"!==s&&"third_place"!==s?(a.out.push("\x3c!--[--\x3e"),a.out.push('<div class="connection-line svelte-10kswq8" aria-hidden="true"></div>')):a.out.push("\x3c!--[!--\x3e"),a.out.push("\x3c!--]--\x3e</div>")}a.out.push("\x3c!--]--\x3e</div></div>")}a.out.push("\x3c!--]--\x3e</div>")}else a.out.push("\x3c!--[!--\x3e");a.out.push("\x3c!--]--\x3e</div>"),o(r,{sport:h,matches:v,isAdmin:m,onEditMatch:x}),u()}(a,{sport:_.currentSport,matches:L,isAdmin:!1})},$$slots:{default:!0}})):(a.out.push("\x3c!--[!--\x3e"),a.out.push(`<div class="no-data-container svelte-eh2fp7"><div class="no-data-message svelte-eh2fp7"><h3 class="svelte-eh2fp7">トーナメントデータがありません</h3> <p class="svelte-eh2fp7">${n(A(_.currentSport))}のトーナメントはまだ開始されていません。</p> <button class="refresh-button touch-friendly svelte-eh2fp7">データを確認</button></div></div>`)),a.out.push("\x3c!--]--\x3e")),a.out.push("\x3c!--]--\x3e")),a.out.push("\x3c!--]--\x3e</div>")},$$slots:{default:!0}}),a.out.push("\x3c!----\x3e</div>")}}}),q&&h(q),u()}export{q as default};
