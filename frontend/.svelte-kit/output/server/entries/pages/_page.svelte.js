import{p as e,d as t,m as s,h as n,c as a,a as o,f as u,j as i,e as c,l,n as r,u as d,o as p}from"../../chunks/index2.js";import{o as h,R as v,A as m}from"../../chunks/AnimatedTransition.js";import{t as x,S as f}from"../../chunks/StaggeredList.js";import{u as w,a as g}from"../../chunks/client.js";import{y as b}from"../../chunks/utils2.js";import{L as $}from"../../chunks/LoadingSpinner.js";function y(e,t=10){return e?e.length<=t?e:e.substring(0,t-3)+"...":""}function k(u,i){let c,l,r,d;e();let p=b(i.match,()=>({}),!0),h=b(i.editable,!1),v=b(i.compact,!1);var m,x,f,w;p.score1,p.score2,c=(m=p).winner?m.winner:null!==m.score1&&null!==m.score2&&void 0!==m.score1&&void 0!==m.score2?m.score1>m.score2?m.team1:m.score2>m.score1?m.team2:"draw":null,l=["match-card",v?"compact":"",h?"editable":"",""].filter(Boolean).join(" "),r=["team",c===p.team1?"winner":""].filter(Boolean).join(" "),d=["team",c===p.team2?"winner":""].filter(Boolean).join(" "),u.out.push(`<div${t(s(l),"svelte-l0munw")} data-testid="match-card"><div class="match-header svelte-l0munw">`),p.round?(u.out.push("\x3c!--[--\x3e"),u.out.push(`<div class="round svelte-l0munw" data-testid="match-round">${n(p.round)}</div>`)):u.out.push("\x3c!--[!--\x3e"),u.out.push("\x3c!--]--\x3e "),p.scheduled_at?(u.out.push("\x3c!--[--\x3e"),u.out.push(`<div class="schedule svelte-l0munw" data-testid="match-schedule">${n(new Date(p.scheduled_at).toLocaleDateString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))}</div>`)):u.out.push("\x3c!--[!--\x3e"),u.out.push(`\x3c!--]--\x3e</div> <div class="teams svelte-l0munw"><div${t(s(r),"svelte-l0munw")} data-testid="team1"><span class="team-name svelte-l0munw">${n(y(p.team1||"Team A",v?8:15))}</span> `),c===p.team1?(u.out.push("\x3c!--[--\x3e"),u.out.push('<span class="winner-badge svelte-l0munw">🏆</span>')):u.out.push("\x3c!--[!--\x3e"),u.out.push(`\x3c!--]--\x3e</div> <div class="vs-section svelte-l0munw"><span class="vs svelte-l0munw">vs</span></div> <div${t(s(d),"svelte-l0munw")} data-testid="team2">`),c===p.team2?(u.out.push("\x3c!--[--\x3e"),u.out.push('<span class="winner-badge svelte-l0munw">🏆</span>')):u.out.push("\x3c!--[!--\x3e"),u.out.push(`\x3c!--]--\x3e <span class="team-name svelte-l0munw">${n(y(p.team2||"Team B",v?8:15))}</span></div></div> <div class="score-section svelte-l0munw">`),u.out.push("\x3c!--[!--\x3e"),u.out.push('<div class="score-display svelte-l0munw" data-testid="score-display">'),null!==p.score1&&void 0!==p.score1&&null!==p.score2&&void 0!==p.score2?(u.out.push("\x3c!--[--\x3e"),u.out.push(`<div class="score svelte-l0munw">${n((f=p.score1,w=p.score2,null==f||null==w?"未実施":`${f} - ${w}`))}</div>`)):(u.out.push("\x3c!--[!--\x3e"),u.out.push(`<div class="status svelte-l0munw" data-testid="match-status">${n((x=p.status||"pending",{pending:"未実施",in_progress:"進行中",completed:"完了",cancelled:"キャンセル"}[x]||x))}</div>`)),u.out.push("\x3c!--]--\x3e</div> "),h&&"completed"!==p.status?(u.out.push("\x3c!--[--\x3e"),u.out.push('<button class="edit-btn svelte-l0munw" data-testid="edit-match-btn" aria-label="試合結果を編集">✏️ 編集</button>')):u.out.push("\x3c!--[!--\x3e"),u.out.push("\x3c!--]--\x3e"),u.out.push("\x3c!--]--\x3e</div> "),v||!p.completed_at&&"completed"!==p.status?u.out.push("\x3c!--[!--\x3e"):(u.out.push("\x3c!--[--\x3e"),u.out.push(`<div class="match-details svelte-l0munw"><div class="completion-time svelte-l0munw" data-testid="completion-time">完了: ${n(new Date(p.completed_at).toLocaleDateString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))}</div></div>`)),u.out.push("\x3c!--]--\x3e</div>"),a(i,{match:p,editable:h,compact:v}),o()}function j(s,y){var j;let _,q,S,L;e();const z=[{key:"volleyball",name:"バレーボール",icon:"🏐"},{key:"table_tennis",name:"卓球",icon:"🏓"},{key:"soccer",name:"サッカー",icon:"⚽"}];function A(e){const t=z.find(t=>t.key===e);return t?t.name:e}h(()=>{}),"undefined"!=typeof document&&document.addEventListener("visibilitychange",function(){"undefined"!=typeof document&&(document.hidden||async function(e,t=!0){try{t&&g.setLoading(!0);const s=await x.fetchTournaments(e);return s.success||g.showNotification(s.message||"データの取得に失敗しました","error"),s}catch(s){return g.showNotification("データの読み込みでエラーが発生しました","error"),{success:!1,message:s.message}}finally{t&&g.setLoading(!1)}}(_.currentSport,!1))}),_=l(j??={},"$tournamentStore",x),q=l(j??={},"$uiStore",w),S=_.tournaments[_.currentSport]||null,L=S?.matches||[],r(s,e=>{e.title=`<title>トーナメント管理システム - ${n(A(_.currentSport))}</title>`,e.out.push('<meta name="description" content="バレーボール、卓球、サッカーのトーナメント結果をリアルタイムで確認できます"/>')}),v(s,{children:p,$$slots:{default:(s,{screenSize:l,screenWidth:r})=>{s.out.push('<div class="homepage svelte-eh2fp7">'),v(s,{container:!0,padding:!0,children:s=>{s.out.push(`<div class="page-header svelte-eh2fp7"><h1 class="page-title responsive-text size-4xl svelte-eh2fp7">トーナメント管理システム</h1> <p class="page-description responsive-text size-lg svelte-eh2fp7">リアルタイムでトーナメントの進行状況を確認できます</p> <div class="header-actions responsive-flex justify-center align-center svelte-eh2fp7"><button class="refresh-button touch-friendly svelte-eh2fp7"${c("disabled",_.loading||q.loading,!0)} aria-label="データを更新"><span${t("refresh-icon svelte-eh2fp7",void 0,{spinning:_.loading||q.loading})}>🔄</span> 更新</button> `),_.lastUpdated?(s.out.push("\x3c!--[--\x3e"),s.out.push(`<span class="last-updated responsive-text size-sm svelte-eh2fp7">最終更新: ${n(new Date(_.lastUpdated).toLocaleTimeString("ja-JP"))}</span>`)):s.out.push("\x3c!--[!--\x3e"),s.out.push('\x3c!--]--\x3e</div></div> <div class="sports-tabs svelte-eh2fp7">'),f(s,{items:z.map(e=>({...e,id:e.key})),staggerDelay:150,animationType:"scaleIn",tag:"div",itemTag:"div",className:"tabs-grid",itemClassName:"tab-item",children:p,$$slots:{default:(e,{item:s})=>{e.out.push(`<button slot="default"${t("sport-tab touch-friendly hover-scale transition-all svelte-eh2fp7",void 0,{active:_.currentSport===s.key})}${c("disabled",_.loading,!0)}${c("aria-label",`${u(s.name)}のトーナメントを表示`)}><span class="sport-icon svelte-eh2fp7">${n(s.icon)}</span> <span class="sport-name responsive-text size-sm svelte-eh2fp7">${n(s.name)}</span></button>`)}}}),s.out.push('\x3c!----\x3e</div> <div class="main-content svelte-eh2fp7">'),_.error?(s.out.push("\x3c!--[--\x3e"),s.out.push(`<div class="error-container svelte-eh2fp7"><div class="error-message svelte-eh2fp7"><h3 class="svelte-eh2fp7">エラーが発生しました</h3> <p class="svelte-eh2fp7">${n(_.error)}</p> <button class="retry-button touch-friendly svelte-eh2fp7">再試行</button></div></div>`)):(s.out.push("\x3c!--[!--\x3e"),_.loading&&!S?(s.out.push("\x3c!--[--\x3e"),s.out.push('<div class="loading-container svelte-eh2fp7">'),$(s,{size:"large"}),s.out.push('\x3c!----\x3e <p class="loading-text responsive-text size-lg svelte-eh2fp7">トーナメントデータを読み込み中...</p></div>')):(s.out.push("\x3c!--[!--\x3e"),S&&L.length>0?(s.out.push("\x3c!--[--\x3e"),m(s,{show:!0,type:"fadeInUp",duration:500,className:"tournament-container",children:s=>{!function(s,l){let r,d;e();let p=b(l.sport,"volleyball"),h=b(l.matches,()=>[],!0),v=b(l.isAdmin,!1),m=b(l.onEditMatch,null);const x={round_1:"1回戦",round_2:"2回戦",quarterfinal:"準々決勝",semifinal:"準決勝",final:"決勝",third_place:"3位決定戦"};function f(e){if(e.winner)return e.winner;if(void 0!==e.score1&&void 0!==e.score2){if(e.score1>e.score2)return e.team1;if(e.score2>e.score1)return e.team2}return null}function w(e){return"completed"===e.status||void 0!==e.score1&&void 0!==e.score2?"completed":"in_progress"===e.status?"in_progress":"pending"}function g(){if("undefined"!=typeof window){const e=window.innerWidth;return e<768?"mobile":e<1024?"tablet":"desktop"}return"desktop"}let $="desktop";var y;if("undefined"!=typeof window&&($=g(),window.addEventListener("resize",()=>{$=g()})),y=h,r=Array.isArray(y)?y.reduce((e,t)=>{if(!t||"object"!=typeof t)return e;const s=t.round||"unknown";return e[s]||(e[s]=[]),e[s].push(t),e},{}):{},d=function(e){const t=Object.keys(e),s=["round_1","round_2","quarterfinal","semifinal","third_place","final"];return s.filter(e=>t.includes(e)).concat(t.filter(e=>!s.includes(e)))}(r),s.out.push(`<div${t(`tournament-bracket ${u($)}`,"svelte-10kswq8")}><div class="bracket-header svelte-10kswq8"><h2 class="tournament-title svelte-10kswq8">${n({volleyball:"バレーボール",table_tennis:"卓球",soccer:"サッカー"}[p]||p)} トーナメント</h2> `),0===h.length?(s.out.push("\x3c!--[--\x3e"),s.out.push('<p class="no-matches svelte-10kswq8">試合データがありません</p>')):s.out.push("\x3c!--[!--\x3e"),s.out.push("\x3c!--]--\x3e</div> "),h.length>0){s.out.push("\x3c!--[--\x3e");const e=i(d);s.out.push('<div class="bracket-container svelte-10kswq8">\x3c!--[--\x3e');for(let t=0,a=e.length;t<a;t++){let a=e[t];const o=i(r[a]);s.out.push(`<div class="round-column svelte-10kswq8"${c("data-round",a)}><h3 class="round-title svelte-10kswq8">${n(x[a]||a)}</h3> <div class="matches-container svelte-10kswq8">\x3c!--[--\x3e`);for(let e=0,t=o.length;e<t;e++){let t=o[e];s.out.push(`<div class="match-wrapper svelte-10kswq8"${c("data-status",w(t))}><div class="match-card-container svelte-10kswq8">`),k(s,{match:t,editable:v}),s.out.push("\x3c!----\x3e "),f(t)?(s.out.push("\x3c!--[--\x3e"),s.out.push(`<div class="winner-indicator svelte-10kswq8">勝者: ${n(f(t))}</div>`)):s.out.push("\x3c!--[!--\x3e"),s.out.push("\x3c!--]--\x3e "),v&&"pending"===w(t)?(s.out.push("\x3c!--[--\x3e"),s.out.push('<button class="edit-button svelte-10kswq8" aria-label="試合結果を編集">結果入力</button>')):s.out.push("\x3c!--[!--\x3e"),s.out.push("\x3c!--]--\x3e</div> "),"final"!==a&&"third_place"!==a?(s.out.push("\x3c!--[--\x3e"),s.out.push('<div class="connection-line svelte-10kswq8" aria-hidden="true"></div>')):s.out.push("\x3c!--[!--\x3e"),s.out.push("\x3c!--]--\x3e</div>")}s.out.push("\x3c!--]--\x3e</div></div>")}s.out.push("\x3c!--]--\x3e</div>")}else s.out.push("\x3c!--[!--\x3e");s.out.push("\x3c!--]--\x3e</div>"),a(l,{sport:p,matches:h,isAdmin:v,onEditMatch:m}),o()}(s,{sport:_.currentSport,matches:L,isAdmin:!1})},$$slots:{default:!0}})):(s.out.push("\x3c!--[!--\x3e"),s.out.push(`<div class="no-data-container svelte-eh2fp7"><div class="no-data-message svelte-eh2fp7"><h3 class="svelte-eh2fp7">トーナメントデータがありません</h3> <p class="svelte-eh2fp7">${n(A(_.currentSport))}のトーナメントはまだ開始されていません。</p> <button class="refresh-button touch-friendly svelte-eh2fp7">データを確認</button></div></div>`)),s.out.push("\x3c!--]--\x3e")),s.out.push("\x3c!--]--\x3e")),s.out.push("\x3c!--]--\x3e</div>")},$$slots:{default:!0}}),s.out.push("\x3c!----\x3e</div>")}}}),j&&d(j),o()}export{j as default};
