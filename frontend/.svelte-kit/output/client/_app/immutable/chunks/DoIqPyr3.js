const e={"default-src":["'self'"],"script-src":["'self'","'unsafe-inline'"],"style-src":["'self'","'unsafe-inline'"],"img-src":["'self'","data:","https:"],"font-src":["'self'"],"connect-src":["'self'"],"frame-ancestors":["'none'"],"base-uri":["'self'"],"form-action":["'self'"]};const t=new class{constructor(){this.tokenKey="csrf_token",this.tokenExpiry="csrf_token_expiry",this.tokenLifetime=36e5}generateToken(){const e=function(e=32){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";if("undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues){const s=new Uint8Array(e);window.crypto.getRandomValues(s);for(let i=0;i<e;i++)n+=t[s[i]%62]}else for(let s=0;s<e;s++)n+=t[Math.floor(62*Math.random())];return n}(32),t=Date.now()+this.tokenLifetime;return"undefined"!=typeof window&&(sessionStorage.setItem(this.tokenKey,e),sessionStorage.setItem(this.tokenExpiry,t.toString())),e}getToken(){if("undefined"==typeof window)return null;const e=sessionStorage.getItem(this.tokenKey),t=sessionStorage.getItem(this.tokenExpiry);return e&&t?Date.now()>parseInt(t)?(this.clearToken(),this.generateToken()):e:this.generateToken()}validateToken(e){return e===this.getToken()}clearToken(){"undefined"!=typeof window&&(sessionStorage.removeItem(this.tokenKey),sessionStorage.removeItem(this.tokenExpiry))}refreshToken(){return this.clearToken(),this.generateToken()}};function n(e,t=1e3){return"string"!=typeof e?e:e.length>t?e.substring(0,t):e}const s=new class{constructor(e=100,t=6e4){this.maxRequests=e,this.windowMs=t,this.requests=new Map}isAllowed(e="default"){const t=Date.now(),n=t-this.windowMs;if(this.requests.has(e)){const t=this.requests.get(e).filter(e=>e>n);this.requests.set(e,t)}const s=this.requests.get(e)||[];return!(s.length>=this.maxRequests)&&(s.push(t),this.requests.set(e,s),!0)}getRemainingRequests(e="default"){const t=this.requests.get(e)||[];return Math.max(0,this.maxRequests-t.length)}getResetTime(e="default"){const t=this.requests.get(e)||[];if(0===t.length)return 0;return Math.min(...t)+this.windowMs}};const i=new class{constructor(){this.events=[],this.maxEvents=100}logEvent(e,t={}){const n={type:e,details:t,timestamp:(new Date).toISOString(),userAgent:"undefined"!=typeof navigator?navigator.userAgent:"unknown",url:"undefined"!=typeof window?window.location.href:"unknown"};this.events.push(n),this.events.length>this.maxEvents&&(this.events=this.events.slice(-this.maxEvents)),this.isCriticalEvent(e)&&this.reportCriticalEvent(n)}isCriticalEvent(e){return["XSS_ATTEMPT","SQL_INJECTION_ATTEMPT","CSRF_TOKEN_MISMATCH","UNAUTHORIZED_ACCESS","RATE_LIMIT_EXCEEDED"].includes(e)}reportCriticalEvent(e){}getEvents(e=null){return e?this.events.filter(t=>t.type===e):[...this.events]}clearEvents(){this.events=[]}};function o(){if("undefined"==typeof window)return;t.getToken();try{const t=document.createElement("meta");t.httpEquiv="Content-Security-Policy",t.content=Object.entries(e).map(([e,t])=>`${e} ${t.join(" ")}`).join("; "),document.head.appendChild(t)}catch(s){}window.addEventListener("error",e=>{e.error&&e.error.message&&i.logEvent("JAVASCRIPT_ERROR",{message:e.error.message,filename:e.filename,lineno:e.lineno,colno:e.colno})});const n=window.eval;window.eval=function(...e){return i.logEvent("EVAL_USAGE",{args:e}),n.apply(this,e)}}export{t as c,s as d,n as e,o as i,i as s};
