import{b as e,ay as t,e as r,i as s,h as a,az as n,aA as i,aB as o,a3 as l,l as u,aC as c,aD as h,aE as d,aF as f,aG as m,v,aH as p,Y as y,aI as E,aJ as g,aK as R,aL as T,aM as A,Z as I,aN as O,aO as N,aP as w,av as b}from"./VVabkdHj.js";function _(a,n){var i,o=void 0;e(()=>{o!==(o=n())&&(i&&(t(i),i=null),o&&(i=r(()=>{s(()=>o(a))})))})}function U(e){var t,r,s="";if("string"==typeof e||"number"==typeof e)s+=e;else if("object"==typeof e)if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(r=U(e[t]))&&(s&&(s+=" "),s+=r)}else for(r in e)e[r]&&(s&&(s+=" "),s+=r);return s}function L(e){return"object"==typeof e?function(){for(var e,t,r=0,s="",a=arguments.length;r<a;r++)(e=arguments[r])&&(t=U(e))&&(s&&(s+=" "),s+=t);return s}(e):e??""}const S=[..." \t\n\r\f \v\ufeff"];function k(e,t=!1){var r=t?" !important;":";",s="";for(var a in e){var n=e[a];null!=n&&""!==n&&(s+=" "+a+": "+n+r)}return s}function M(e){return"-"!==e[0]||"-"!==e[1]?e.toLowerCase():e}function C(e,t,r,s,n,i){var o=e.__className;if(a||o!==r||void 0===o){var l=function(e,t,r){var s=null==e?"":""+e;if(t&&(s=s?s+" "+t:t),r)for(var a in r)if(r[a])s=s?s+" "+a:a;else if(s.length)for(var n=a.length,i=0;(i=s.indexOf(a,i))>=0;){var o=i+n;0!==i&&!S.includes(s[i-1])||o!==s.length&&!S.includes(s[o])?i=o:s=(0===i?"":s.substring(0,i))+s.substring(o+1)}return""===s?null:s}(r,s,i);a&&l===e.getAttribute("class")||(null==l?e.removeAttribute("class"):t?e.className=l:e.setAttribute("class",l)),e.__className=r}else if(i&&n!==i)for(var u in i){var c=!!i[u];null!=n&&c===!!n[u]||e.classList.toggle(u,c)}return i}function H(e,t={},r,s){for(var a in r){var n=r[a];t[a]!==n&&(null==r[a]?e.style.removeProperty(a):e.style.setProperty(a,n,s))}}function x(e,t,r,s){var n=e.__style;if(a||n!==t){var i=function(e,t){if(t){var r,s,a="";if(Array.isArray(t)?(r=t[0],s=t[1]):r=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var n=!1,i=0,o=!1,l=[];r&&l.push(...Object.keys(r).map(M)),s&&l.push(...Object.keys(s).map(M));var u=0,c=-1;const t=e.length;for(var h=0;h<t;h++){var d=e[h];if(o?"/"===d&&"*"===e[h-1]&&(o=!1):n?n===d&&(n=!1):"/"===d&&"*"===e[h+1]?o=!0:'"'===d||"'"===d?n=d:"("===d?i++:")"===d&&i--,!o&&!1===n&&0===i)if(":"===d&&-1===c)c=h;else if(";"===d||h===t-1){if(-1!==c){var f=M(e.substring(u,c).trim());l.includes(f)||(";"!==d&&h++,a+=" "+e.substring(u,h).trim()+";")}u=h+1,c=-1}}}return r&&(a+=k(r)),s&&(a+=k(s,!0)),""===(a=a.trim())?null:a}return null==e?null:String(e)}(t,s);a&&i===e.getAttribute("style")||(null==i?e.removeAttribute("style"):e.style.cssText=i),e.__style=t}else s&&(Array.isArray(s)?(H(e,r?.[0],s[0]),H(e,r?.[1],s[1],"important")):H(e,r,s));return s}function D(e,t,r=!1){if(e.multiple){if(null==t)return;if(!n(t))return i();for(var s of e.options)s.selected=t.includes($(s))}else{for(s of e.options){var a=$(s);if(o(a,t))return void(s.selected=!0)}r&&void 0===t||(e.selectedIndex=-1)}}function P(e){var t=new MutationObserver(()=>{D(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),l(()=>{t.disconnect()})}function q(e,t,r=t){var a=!0;u(e,"change",t=>{var s,a=t?"[selected]":":checked";if(e.multiple)s=[].map.call(e.querySelectorAll(a),$);else{var n=e.querySelector(a)??e.querySelector("option:not([disabled])");s=n&&$(n)}r(s)}),s(()=>{var s=t();if(D(e,s,a),a&&void 0===s){var n=e.querySelector(":checked");null!==n&&(s=$(n),r(s))}e.__value=s,a=!1}),P(e)}function $(e){return"__value"in e?e.__value:e.value}const j=Symbol("class"),G=Symbol("style"),K=Symbol("is custom element"),W=Symbol("is html");function z(e){if(a){var t=!1,r=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var r=e.value;B(e,"value",null),e.value=r}if(e.hasAttribute("checked")){var s=e.checked;B(e,"checked",null),e.checked=s}}};e.__on_r=r,O(r),N()}}function V(e,t){var r=F(e);r.value!==(r.value=t??void 0)&&(e.value!==t||0===t&&"PROGRESS"===e.nodeName)&&(e.value=t??"")}function J(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function B(e,t,r,s){var n=F(e);a&&(n[t]=e.getAttribute(t),"src"===t||"srcset"===t||"href"===t&&"LINK"===e.nodeName)||n[t]!==(n[t]=r)&&("loading"===t&&(e[c]=r),null==r?e.removeAttribute(t):"string"!=typeof r&&Q(e).includes(t)?e[t]=r:e.setAttribute(t,r))}function Z(n,i,o=[],l=[],u,c=!1){m(o,l,o=>{var l=void 0,h={},d="SELECT"===n.nodeName,f=!1;if(e(()=>{var e=i(...o.map(v)),s=function(e,t,r,s){var n=F(e),i=n[K],o=!n[W];let l=a&&i;l&&y(!1);var u=t||{},c="OPTION"===e.tagName;for(var h in t)h in r||(r[h]=null);r.class?r.class=L(r.class):(s||r[j])&&(r.class=null),r[G]&&(r.style??=null);var d=Q(e);for(const a in r){let l=r[a];if(c&&"value"===a&&null==l)e.value=e.__value="",u[a]=l;else if("class"!==a)if("style"!==a){var f=u[a];if(l!==f||void 0===l&&e.hasAttribute(a)){u[a]=l;var m=a[0]+a[1];if("$$"!==m)if("on"===m){const t={},r="$$"+a;let s=a.slice(2);var v=w(s);if(E(s)&&(s=s.slice(0,-7),t.capture=!0),!v&&f){if(null!=l)continue;e.removeEventListener(s,u[r],t),u[r]=null}if(null!=l)if(v)e[`__${s}`]=l,R([s]);else{let n=function(e){u[a].call(this,e)};u[r]=g(s,e,n,t)}else v&&(e[`__${s}`]=void 0)}else if("style"===a)B(e,a,l);else if("autofocus"===a)T(e,Boolean(l));else if(i||"__value"!==a&&("value"!==a||null==l))if("selected"===a&&c)J(e,l);else{var p=a;o||(p=A(p));var O="defaultValue"===p||"defaultChecked"===p;if(null!=l||i||O)O||d.includes(p)&&(i||"string"!=typeof l)?(e[p]=l,p in n&&(n[p]=I)):"function"!=typeof l&&B(e,p,l);else if(n[a]=null,"value"===p||"checked"===p){let r=e;const s=void 0===t;if("value"===p){let e=r.defaultValue;r.removeAttribute(p),r.defaultValue=e,r.value=r.__value=s?e:null}else{let e=r.defaultChecked;r.removeAttribute(p),r.defaultChecked=e,r.checked=!!s&&e}}else e.removeAttribute(a)}else e.value=e.__value=l}}else x(e,l,t?.[G],r[G]),u[a]=l,u[G]=r[G];else C(e,"http://www.w3.org/1999/xhtml"===e.namespaceURI,l,s,t?.[j],r[j]),u[a]=l,u[j]=r[j]}return l&&y(!0),u}(n,l,e,u,c);f&&d&&"value"in e&&D(n,e.value);for(let r of Object.getOwnPropertySymbols(h))e[r]||t(h[r]);for(let a of Object.getOwnPropertySymbols(e)){var m=e[a];a.description!==p||l&&m===l[a]||(h[a]&&t(h[a]),h[a]=r(()=>_(n,()=>m))),s[a]=m}l=s}),d){var m=n;s(()=>{D(m,l.value,!0),P(m)})}f=!0})}function F(e){return e.__attributes??={[K]:e.nodeName.includes("-"),[W]:e.namespaceURI===h}}var Y=new Map;function Q(e){var t,r=e.getAttribute("is")||e.nodeName,s=Y.get(r);if(s)return s;Y.set(r,s=[]);for(var a=e,n=Element.prototype;n!==a;){for(var i in t=f(a))t[i].set&&s.push(i);a=d(a)}return s}const X={notifications:[],loading:!1,theme:"light"},ee=b(X);let te=0;const re={showNotification:(e,t="info",r=5e3)=>{const s={id:++te,message:e,type:t,timestamp:Date.now()};return ee.update(e=>({...e,notifications:[...e.notifications,s]})),r>0&&setTimeout(()=>{re.removeNotification(s.id)},r),s.id},removeNotification:e=>{ee.update(t=>({...t,notifications:t.notifications.filter(t=>t.id!==e)}))},setLoading:e=>{ee.update(t=>({...t,loading:Boolean(e)}))},clearNotifications:()=>{ee.update(e=>({...e,notifications:[]}))},setTheme:e=>{"light"!==e&&"dark"!==e||(ee.update(t=>({...t,theme:e})),"undefined"!=typeof localStorage&&localStorage.setItem("ui-theme",e))},loadTheme:()=>{if("undefined"!=typeof localStorage){const e=localStorage.getItem("ui-theme");!e||"light"!==e&&"dark"!==e||re.setTheme(e)}},reset:()=>{ee.set(X)}},se={NETWORK:"NETWORK_ERROR",API:"API_ERROR",VALIDATION:"VALIDATION_ERROR",AUTHENTICATION:"AUTHENTICATION_ERROR",AUTHORIZATION:"AUTHORIZATION_ERROR",TIMEOUT:"TIMEOUT_ERROR",PARSE:"PARSE_ERROR",UNKNOWN:"UNKNOWN_ERROR",CLIENT:"CLIENT_ERROR",SERVER:"SERVER_ERROR"},ae={LOW:"low",MEDIUM:"medium",HIGH:"high",CRITICAL:"critical"};class ne extends Error{constructor(e,t=se.UNKNOWN,r=ae.MEDIUM,s=null){super(e),this.name="AppError",this.type=t,this.level=r,this.details=s,this.timestamp=(new Date).toISOString(),this.userAgent="undefined"!=typeof navigator?navigator.userAgent:"Unknown"}toJSON(){return{name:this.name,message:this.message,type:this.type,level:this.level,details:this.details,timestamp:this.timestamp,userAgent:this.userAgent,stack:this.stack}}}const ie=new class{constructor(){this.errorListeners=[],this.retryAttempts=new Map,this.maxRetryAttempts=3,this.retryDelay=1e3,this.isInitialized=!1}initialize(){this.isInitialized||"undefined"==typeof window||(window.addEventListener("error",this.handleGlobalError.bind(this)),window.addEventListener("unhandledrejection",this.handleUnhandledRejection.bind(this)),window.addEventListener("auth:unauthorized",this.handleAuthError.bind(this)),this.isInitialized=!0)}addErrorListener(e){this.errorListeners.push(e)}removeErrorListener(e){const t=this.errorListeners.indexOf(e);t>-1&&this.errorListeners.splice(t,1)}handleGlobalError(e){const t=new ne(e.message||"JavaScript実行エラーが発生しました",se.CLIENT,ae.HIGH,{filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error});this.handleError(t)}handleUnhandledRejection(e){const t=new ne(e.reason?.message||"Promise処理でエラーが発生しました",se.CLIENT,ae.HIGH,{reason:e.reason,promise:e.promise});this.handleError(t),e.preventDefault()}handleAuthError(e){const t=new ne("認証が無効になりました。再度ログインしてください。",se.AUTHENTICATION,ae.MEDIUM);this.handleError(t)}handleError(e,t={}){return e instanceof ne||(e=this.normalizeError(e)),Object.keys(t).length>0&&(e.details={...e.details,context:t}),this.logError(e),this.notifyErrorListeners(e),this.notifyUser(e),e.level===ae.CRITICAL&&this.handleCriticalError(e),e}normalizeError(e){if(e instanceof ne)return e;let t=se.UNKNOWN,r=ae.MEDIUM,s=e.message||"エラーが発生しました";return"TypeError"===e.name&&e.message.includes("fetch")?(t=se.NETWORK,s="ネットワークエラーが発生しました"):"AbortError"===e.name?(t=se.TIMEOUT,s="リクエストがタイムアウトしました"):"SyntaxError"===e.name&&(t=se.PARSE,s="データの解析に失敗しました"),new ne(s,t,r,{originalError:e,stack:e.stack})}logError(e){e.timestamp,e.type,e.level,e.message,e.details,e.stack;e.level}notifyErrorListeners(e){this.errorListeners.forEach(t=>{try{t(e)}catch(r){}})}notifyUser(e){if(e.level===ae.LOW)return;let t="error";e.level===ae.MEDIUM&&(t="warning");const r=this.getUserFriendlyMessage(e);re.showNotification(r,t,8e3)}getUserFriendlyMessage(e){switch(e.type){case se.NETWORK:return"インターネット接続を確認してください。";case se.TIMEOUT:return"リクエストがタイムアウトしました。しばらく待ってから再試行してください。";case se.AUTHENTICATION:return"認証が必要です。ログインしてください。";case se.AUTHORIZATION:return"この操作を実行する権限がありません。";case se.VALIDATION:return"入力内容を確認してください。";case se.SERVER:return"サーバーエラーが発生しました。しばらく待ってから再試行してください。";default:return e.message||"エラーが発生しました。"}}handleCriticalError(e){}async retry(e,t,r=this.maxRetryAttempts){const s=this.retryAttempts.get(t)||0;try{const r=await e();return this.retryAttempts.delete(t),r}catch(a){if(s<r){this.retryAttempts.set(t,s+1);const a=this.retryDelay*Math.pow(2,s);return await new Promise(e=>setTimeout(e,a)),this.retry(e,t,r)}throw this.retryAttempts.delete(t),new ne(`操作が${r}回失敗しました: ${a.message}`,se.UNKNOWN,ae.HIGH,{originalError:a,attempts:r})}}resetErrorBoundary(e){this.retryAttempts.delete(e)}cleanup(){"undefined"!=typeof window&&(window.removeEventListener("error",this.handleGlobalError.bind(this)),window.removeEventListener("unhandledrejection",this.handleUnhandledRejection.bind(this)),window.removeEventListener("auth:unauthorized",this.handleAuthError.bind(this))),this.errorListeners=[],this.retryAttempts.clear(),this.isInitialized=!1}},oe=()=>{ie.initialize()},le=(e,t={})=>{let r=se.API,s=ae.MEDIUM;e.status>=400&&e.status<500?(r=se.CLIENT,401===e.status?r=se.AUTHENTICATION:403===e.status?r=se.AUTHORIZATION:422===e.status&&(r=se.VALIDATION)):e.status>=500&&(r=se.SERVER,s=ae.HIGH);const a=new ne(e.message||`HTTP ${e.status}: ${e.statusText}`,r,s,{status:e.status,statusText:e.statusText,error:e.error,details:e.details,...t});return ie.handleError(a,t)};const ue=new class{constructor(e="http://localhost:8080/api"){this.baseURL=e,this.token=null,this.requestInterceptors=[],this.responseInterceptors=[],this.defaultTimeout=3e4,this.retryConfig={maxAttempts:3,retryableErrors:[se.NETWORK,se.TIMEOUT],retryDelay:1e3}}setToken(e){this.token=e}getToken(){return this.token}addRequestInterceptor(e){this.requestInterceptors.push(e)}addResponseInterceptor(e){this.responseInterceptors.push(e)}getHeaders(e={}){const t={"Content-Type":"application/json",...e};return this.token&&(t.Authorization=`Bearer ${this.token}`),t}async applyRequestInterceptors(e){let t={...e};for(const s of this.requestInterceptors)try{t=await s(t)}catch(r){}return t}async applyResponseInterceptors(e){let t=e;for(const s of this.responseInterceptors)try{t=await s(t)}catch(r){}return t}async request(e,t={}){const r=`${this.baseURL}${e}`,s=`${t.method||"GET"}-${e}-${Date.now()}`,a={method:"GET",headers:this.getHeaders(t.headers),signal:this.createAbortSignal(t.timeout||this.defaultTimeout),...t},n=await this.applyRequestInterceptors(a);return this.shouldRetryRequest(t)?(i=()=>this.executeRequest(r,n),o=s,l=this.retryConfig.maxAttempts,ie.retry(i,o,l)):this.executeRequest(r,n);var i,o,l}async executeRequest(e,t){try{const r=await fetch(e,t),s=await this.applyResponseInterceptors(r);return await this.handleResponse(s)}catch(r){return this.handleError(r)}}createAbortSignal(e){if("undefined"==typeof AbortController)return;const t=new AbortController;return e>0&&setTimeout(()=>{t.abort()},e),t.signal}shouldRetryRequest(e){if(!1===e.retry)return!1;const t=(e.method||"GET").toUpperCase();return"GET"===t||"HEAD"===t||!0===e.retry}async get(e,t={}){return this.request(e,{...t,method:"GET"})}async post(e,t,r={}){return this.request(e,{...r,method:"POST",body:t?JSON.stringify(t):void 0})}async put(e,t,r={}){return this.request(e,{...r,method:"PUT",body:t?JSON.stringify(t):void 0})}async delete(e,t={}){return this.request(e,{...t,method:"DELETE"})}async patch(e,t,r={}){return this.request(e,{...r,method:"PATCH",body:t?JSON.stringify(t):void 0})}async handleResponse(e){const t=e.headers.get("content-type");try{let r;if(r=t&&t.includes("application/json")?await e.json():await e.text(),e.ok)return{success:!0,data:r,status:e.status,statusText:e.statusText};{const t={success:!1,error:r.error||"HTTP_ERROR",message:r.message||`HTTP ${e.status}: ${e.statusText}`,status:e.status,statusText:e.statusText,details:r.details||null};return le(t),t}}catch(r){const t={success:!1,error:"PARSE_ERROR",message:"レスポンスの解析に失敗しました",status:e.status,statusText:e.statusText,details:r.message};return new ne(t.message,se.PARSE,ae.MEDIUM,t.details),le(t),t}}handleError(e){let t;return"TypeError"===e.name&&e.message.includes("fetch")?(t={success:!1,error:"NETWORK_ERROR",message:"ネットワークエラーが発生しました。接続を確認してください。",details:e.message},((e,t={})=>{const r=new ne("ネットワーク接続に問題があります",se.NETWORK,ae.MEDIUM,{originalError:e,...t});ie.handleError(r,t)})(e)):"AbortError"===e.name?(t={success:!1,error:"TIMEOUT_ERROR",message:"リクエストがタイムアウトしました。",details:e.message},new ne(t.message,se.TIMEOUT,ae.MEDIUM,{originalError:e}),le(t)):(t={success:!1,error:"UNKNOWN_ERROR",message:"予期しないエラーが発生しました。",details:e.message},new ne(t.message,se.UNKNOWN,ae.HIGH,{originalError:e}),le(t)),t}async healthCheck(){try{return(await this.get("/health")).success}catch(e){return!1}}};ue.addRequestInterceptor(async e=>e),ue.addResponseInterceptor(async e=>(401===e.status&&(ue.setToken(null),"undefined"!=typeof window&&localStorage.removeItem("auth_token"),"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent("auth:unauthorized"))),e));export{ne as A,ae as E,B as a,V as b,L as c,ue as d,ee as e,x as f,ie as g,D as h,P as i,q as j,J as k,Z as l,se as m,oe as n,z as r,C as s,re as u};
