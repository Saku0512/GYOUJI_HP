import"../chunks/Cm9PB-7n.js";import"../chunks/BB0NFQV6.js";import{p as e,x as t,y as s,m as a,z as n,q as i,B as r,g as l,A as o,i as c,f as d,k as v,a as u,C as m,l as p,r as h,t as f,s as w,V as g,j as b,c as y,d as k,I as $,D as S,J as j,b as q,a0 as _,K as N,a2 as x,o as L,W as z,h as D,Z as I,a1 as A,a3 as T,a4 as B,$ as E,n as J,H as P}from"../chunks/BRFgxvOq.js";import{S as U,t as C}from"../chunks/Ce4CX5Aa.js";import{u as W,b as H}from"../chunks/DiqqC9HZ.js";import{R as K,L as M,A as O}from"../chunks/B3wANwLS.js";function R(e){return{pending:"未実施",in_progress:"進行中",completed:"完了",cancelled:"キャンセル"}[e]||e}function V(e,t){return null==e||null==t?"未実施":`${e} - ${t}`}function Z(e,t=10){return e?e.length<=t?e:e.substring(0,t-3)+"...":""}var F=d('<div class="round svelte-l0munw" data-testid="match-round"> </div>'),G=d('<div class="schedule svelte-l0munw" data-testid="match-schedule"> </div>'),Q=d('<span class="winner-badge svelte-l0munw">🏆</span>'),X=d('<span class="winner-badge svelte-l0munw">🏆</span>'),Y=d('<div class="score-edit svelte-l0munw" data-testid="score-edit"><input type="number" min="0" class="score-input svelte-l0munw" data-testid="score1-input" placeholder="0"/> <span class="score-separator svelte-l0munw">-</span> <input type="number" min="0" class="score-input svelte-l0munw" data-testid="score2-input" placeholder="0"/></div> <div class="edit-actions svelte-l0munw"><button class="btn btn-primary btn-sm svelte-l0munw" data-testid="save-score-btn">保存</button> <button class="btn btn-secondary btn-sm svelte-l0munw" data-testid="cancel-edit-btn">キャンセル</button></div>',1),ee=d('<div class="score svelte-l0munw"> </div>'),te=d('<div class="status svelte-l0munw" data-testid="match-status"> </div>'),se=d('<button class="edit-btn svelte-l0munw" data-testid="edit-match-btn" aria-label="試合結果を編集">✏️ 編集</button>'),ae=d('<div class="score-display svelte-l0munw" data-testid="score-display"><!></div> <!>',1),ne=d('<div class="match-details svelte-l0munw"><div class="completion-time svelte-l0munw" data-testid="completion-time"> </div></div>'),ie=d('<div data-testid="match-card"><div class="match-header svelte-l0munw"><!> <!></div> <div class="teams svelte-l0munw"><div data-testid="team1"><span class="team-name svelte-l0munw"> </span> <!></div> <div class="vs-section svelte-l0munw"><span class="vs svelte-l0munw">vs</span></div> <div data-testid="team2"><!> <span class="team-name svelte-l0munw"> </span></div></div> <div class="score-section svelte-l0munw"><!></div> <!></div>');var re=d('<p class="no-matches svelte-10kswq8">試合データがありません</p>'),le=d('<div class="winner-indicator svelte-10kswq8"> </div>'),oe=d('<button class="edit-button svelte-10kswq8" aria-label="試合結果を編集">結果入力</button>'),ce=d('<div class="connection-line svelte-10kswq8" aria-hidden="true"></div>'),de=d('<div class="match-wrapper svelte-10kswq8"><div class="match-card-container svelte-10kswq8"><!> <!> <!></div> <!></div>'),ve=d('<div class="round-column svelte-10kswq8"><h3 class="round-title svelte-10kswq8"> </h3> <div class="matches-container svelte-10kswq8"></div></div>'),ue=d('<div class="bracket-container svelte-10kswq8"></div>'),me=d('<div><div class="bracket-header svelte-10kswq8"><h2 class="tournament-title svelte-10kswq8"> </h2> <!></div> <!></div>');function pe(d,L){e(L,!1);const z=a(),D=a();let I=t(L,"sport",8,"volleyball"),A=t(L,"matches",24,()=>[]),T=t(L,"isAdmin",8,!1),B=t(L,"onEditMatch",8,null);const E={volleyball:"バレーボール",table_tennis:"卓球",soccer:"サッカー"},J={round_1:"1回戦",round_2:"2回戦",quarterfinal:"準々決勝",semifinal:"準決勝",final:"決勝",third_place:"3位決定戦"};function P(e){if(e.winner)return e.winner;if(void 0!==e.score1&&void 0!==e.score2){if(e.score1>e.score2)return e.team1;if(e.score2>e.score1)return e.team2}return null}function U(e){return"completed"===e.status||void 0!==e.score1&&void 0!==e.score2?"completed":"in_progress"===e.status?"in_progress":"pending"}function C(){if("undefined"!=typeof window){const e=window.innerWidth;return e<768?"mobile":e<1024?"tablet":"desktop"}return"desktop"}let W=a("desktop");"undefined"!=typeof window&&(i(W,C()),window.addEventListener("resize",()=>{i(W,C())})),n(()=>r(A()),()=>{var e;i(z,(e=A(),Array.isArray(e)?e.reduce((e,t)=>{if(!t||"object"!=typeof t)return e;const s=t.round||"unknown";return e[s]||(e[s]=[]),e[s].push(t),e},{}):{}))}),n(()=>l(z),()=>{i(D,function(e){const t=Object.keys(e),s=["round_1","round_2","quarterfinal","semifinal","third_place","final"];return s.filter(e=>t.includes(e)).concat(t.filter(e=>!s.includes(e)))}(l(z)))}),o(),c();var H=me(),K=v(H),M=v(K),O=v(M);h(M);var pe=p(M,2),he=e=>{var t=re();y(e,t)};u(pe,e=>{r(A()),m(()=>0===A().length)&&e(he)}),h(K);var fe=p(K,2),we=d=>{var L=ue();_(L,5,()=>l(D),x,(d,x)=>{var L=ve(),D=v(L),I=v(D,!0);h(D);var A=p(D,2);_(A,5,()=>(l(z),l(x),m(()=>l(z)[l(x)])),e=>e.id,(d,_)=>{var L=de(),z=v(L),D=v(z);!function(d,_){e(_,!1);const N=a(),x=a(),L=a(),z=a();let D=t(_,"match",24,()=>({})),I=t(_,"editable",8,!1),A=t(_,"compact",8,!1);const T=s();let B=a(!1),E=a(D().score1||""),J=a(D().score2||"");function P(){I()&&(i(B,!l(B)),l(B)&&(i(E,D().score1||""),i(J,D().score2||"")))}function U(){const e=parseInt(l(E)),t=parseInt(l(J));isNaN(e)||isNaN(t)||e<0||t<0?T("error",{message:"スコアは0以上の数値を入力してください"}):(T("updateScore",{matchId:D().id,score1:e,score2:t}),i(B,!1))}function C(){i(B,!1),i(E,D().score1||""),i(J,D().score2||"")}function W(e){"Enter"===e.key?U():"Escape"===e.key&&C()}n(()=>r(D()),()=>{var e;i(N,(e=D()).winner?e.winner:null!==e.score1&&null!==e.score2&&void 0!==e.score1&&void 0!==e.score2?e.score1>e.score2?e.team1:e.score2>e.score1?e.team2:"draw":null)}),n(()=>(r(A()),r(I()),l(B)),()=>{i(x,["match-card",A()?"compact":"",I()?"editable":"",l(B)?"edit-mode":""].filter(Boolean).join(" "))}),n(()=>(l(N),r(D())),()=>{i(L,["team",l(N)===D().team1?"winner":""].filter(Boolean).join(" "))}),n(()=>(l(N),r(D())),()=>{i(z,["team",l(N)===D().team2?"winner":""].filter(Boolean).join(" "))}),o(),c();var H=ie(),K=v(H),M=v(K),O=e=>{var t=F(),s=v(t,!0);h(t),f(()=>b(s,(r(D()),m(()=>D().round)))),y(e,t)};u(M,e=>{r(D()),m(()=>D().round)&&e(O)});var re=p(M,2),le=e=>{var t=G(),s=v(t,!0);h(t),f(e=>b(s,e),[()=>(r(D()),m(()=>new Date(D().scheduled_at).toLocaleDateString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})))]),y(e,t)};u(re,e=>{r(D()),m(()=>D().scheduled_at)&&e(le)}),h(K);var oe=p(K,2),ce=v(oe),de=v(ce),ve=v(de,!0);h(de);var ue=p(de,2),me=e=>{var t=Q();y(e,t)};u(ue,e=>{l(N),r(D()),m(()=>l(N)===D().team1)&&e(me)}),h(ce);var pe=p(ce,4),he=v(pe),fe=e=>{var t=X();y(e,t)};u(he,e=>{l(N),r(D()),m(()=>l(N)===D().team2)&&e(fe)});var we=p(he,2),ge=v(we,!0);h(we),h(pe),h(oe);var be=p(oe,2),ye=v(be),ke=e=>{var t=Y(),s=$(t),a=v(s);S(a);var n=p(a,4);S(n),h(s);var r=p(s,2),o=v(r),c=p(o,2);h(r),j(a,()=>l(E),e=>i(E,e)),q("keydown",a,W),j(n,()=>l(J),e=>i(J,e)),q("keydown",n,W),q("click",o,U),q("click",c,C),y(e,t)},$e=e=>{var t=ae(),s=$(t),a=v(s),n=e=>{var t=ee(),s=v(t,!0);h(t),f(e=>b(s,e),[()=>(r(V),r(D()),m(()=>V(D().score1,D().score2)))]),y(e,t)},i=e=>{var t=te(),s=v(t,!0);h(t),f(e=>b(s,e),[()=>(r(R),r(D()),m(()=>R(D().status||"pending")))]),y(e,t)};u(a,e=>{r(D()),m(()=>null!==D().score1&&void 0!==D().score1&&null!==D().score2&&void 0!==D().score2)?e(n):e(i,!1)}),h(s);var l=p(s,2),o=e=>{var t=se();q("click",t,P),y(e,t)};u(l,e=>{r(I()),r(D()),m(()=>I()&&"completed"!==D().status)&&e(o)}),y(e,t)};u(ye,e=>{l(B)?e(ke):e($e,!1)}),h(be);var Se=p(be,2),je=e=>{var t=ne(),s=v(t),a=v(s);h(s),h(t),f(e=>b(a,`完了: ${e??""}`),[()=>(r(D()),m(()=>new Date(D().completed_at).toLocaleDateString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})))]),y(e,t)};u(Se,e=>{r(A()),r(D()),m(()=>!A()&&(D().completed_at||"completed"===D().status))&&e(je)}),h(H),f((e,t)=>{w(H,1,g(l(x)),"svelte-l0munw"),w(ce,1,g(l(L)),"svelte-l0munw"),b(ve,e),w(pe,1,g(l(z)),"svelte-l0munw"),b(ge,t)},[()=>(r(Z),r(D()),r(A()),m(()=>Z(D().team1||"Team A",A()?8:15))),()=>(r(Z),r(D()),r(A()),m(()=>Z(D().team2||"Team B",A()?8:15)))]),y(d,H),k()}(D,{get match(){return l(_)},get editable(){return T()}});var I=p(D,2),A=e=>{var t=le(),s=v(t);h(t),f(e=>b(s,`勝者: ${e??""}`),[()=>(l(_),m(()=>P(l(_))))]),y(e,t)};u(I,e=>{l(_),m(()=>P(l(_)))&&e(A)});var E=p(I,2),J=e=>{var t=oe();q("click",t,()=>function(e){T()&&B()&&"function"==typeof B()&&B()(e)}(l(_))),y(e,t)};u(E,e=>{r(T()),l(_),m(()=>T()&&"pending"===U(l(_)))&&e(J)}),h(z);var C=p(z,2),W=e=>{var t=ce();y(e,t)};u(C,e=>{"final"!==l(x)&&"third_place"!==l(x)&&e(W)}),h(L),f(e=>N(L,"data-status",e),[()=>(l(_),m(()=>U(l(_))))]),y(d,L)}),h(A),h(L),f(()=>{N(L,"data-round",l(x)),b(I,(l(x),m(()=>J[l(x)]||l(x))))}),y(d,L)}),h(L),y(d,L)};u(fe,e=>{r(A()),m(()=>A().length>0)&&e(we)}),h(H),f(()=>{w(H,1,`tournament-bracket ${l(W)??""}`,"svelte-10kswq8"),b(O,`${r(I()),m(()=>E[I()]||I())??""} トーナメント`)}),y(d,H),k()}var he=d('<meta name="description" content="バレーボール、卓球、サッカーのトーナメント結果をリアルタイムで確認できます"/>'),fe=d('<span class="last-updated responsive-text size-sm svelte-eh2fp7"> </span>'),we=d('<button slot="default"><span class="sport-icon svelte-eh2fp7"> </span> <span class="sport-name responsive-text size-sm svelte-eh2fp7"> </span></button>'),ge=d('<div class="error-container svelte-eh2fp7"><div class="error-message svelte-eh2fp7"><h3 class="svelte-eh2fp7">エラーが発生しました</h3> <p class="svelte-eh2fp7"> </p> <button class="retry-button touch-friendly svelte-eh2fp7">再試行</button></div></div>'),be=d('<div class="loading-container svelte-eh2fp7"><!> <p class="loading-text responsive-text size-lg svelte-eh2fp7">トーナメントデータを読み込み中...</p></div>'),ye=d('<div class="no-data-container svelte-eh2fp7"><div class="no-data-message svelte-eh2fp7"><h3 class="svelte-eh2fp7">トーナメントデータがありません</h3> <p class="svelte-eh2fp7"> </p> <button class="refresh-button touch-friendly svelte-eh2fp7">データを確認</button></div></div>'),ke=d('<div class="page-header svelte-eh2fp7"><h1 class="page-title responsive-text size-4xl svelte-eh2fp7">トーナメント管理システム</h1> <p class="page-description responsive-text size-lg svelte-eh2fp7">リアルタイムでトーナメントの進行状況を確認できます</p> <div class="header-actions responsive-flex justify-center align-center svelte-eh2fp7"><button class="refresh-button touch-friendly svelte-eh2fp7" aria-label="データを更新"><span>🔄</span> 更新</button> <!></div></div> <div class="sports-tabs svelte-eh2fp7"><!></div> <div class="main-content svelte-eh2fp7"><!></div>',1),$e=d('<div class="homepage svelte-eh2fp7"><!></div>');function Se(t,s){e(s,!1);const[d,g]=I(),S=()=>A(C,"$tournamentStore",d),j=()=>A(H,"$uiStore",d),_=a(),x=a(),R=a(),V=a(),Z=[{key:"volleyball",name:"バレーボール",icon:"🏐"},{key:"table_tennis",name:"卓球",icon:"🏓"},{key:"soccer",name:"サッカー",icon:"⚽"}];let F=null;async function G(e,t=!0){try{t&&W.setLoading(!0);const s=await C.fetchTournaments(e);return s.success||W.showNotification(s.message||"データの取得に失敗しました","error"),s}catch(s){return W.showNotification("データの読み込みでエラーが発生しました","error"),{success:!1,message:s.message}}finally{t&&W.setLoading(!1)}}async function Q(){try{W.setLoading(!0);const e=await C.refreshData(l(_).currentSport);e.success?W.showNotification("データを更新しました","success"):W.showNotification(e.message||"データの更新に失敗しました","error")}catch(e){W.showNotification("データの更新でエラーが発生しました","error")}finally{W.setLoading(!1)}}function X(){F&&(clearInterval(F),F=null)}function Y(e){const t=Z.find(t=>t.key===e);return t?t.name:e}L(async()=>{try{await C.initialize(),await G(l(_).currentSport),X(),F=setInterval(async()=>{if(!("undefined"!=typeof document&&document.hidden||l(_).loading||l(x).loading))try{await G(l(_).currentSport,!1)}catch(e){}},3e4)}catch(e){W.showNotification("データの読み込みに失敗しました","error")}}),z(()=>{X()}),"undefined"!=typeof document&&document.addEventListener("visibilitychange",function(){"undefined"!=typeof document&&(document.hidden||G(l(_).currentSport,!1))}),n(()=>S(),()=>{i(_,S())}),n(()=>j(),()=>{i(x,j())}),n(()=>l(_),()=>{i(R,l(_).tournaments[l(_).currentSport]||null)}),n(()=>l(R),()=>{i(V,l(R)?.matches||[])}),o(),c(),D(e=>{var t=he();f(e=>E.title=`トーナメント管理システム - ${e??""}`,[()=>(l(_),m(()=>Y(l(_).currentSport)))]),y(e,t)}),K(t,{children:T,$$slots:{default:(e,t)=>{var s=$e(),a=v(s);K(a,{container:!0,padding:!0,children:(e,t)=>{var s=ke(),a=$(s),n=p(v(a),4),i=v(n),o=v(i);let c;J(),h(i);var d=p(i,2),g=e=>{var t=fe(),s=v(t);h(t),f(e=>b(s,`最終更新: ${e??""}`),[()=>(l(_),m(()=>new Date(l(_).lastUpdated).toLocaleTimeString("ja-JP")))]),y(e,t)};u(d,e=>{l(_),m(()=>l(_).lastUpdated)&&e(g)}),h(n),h(a);var k=p(a,2),S=v(k);{let e=B(()=>m(()=>Z.map(e=>({...e,id:e.key}))));U(S,{get items(){return l(e)},staggerDelay:150,animationType:"scaleIn",tag:"div",itemTag:"div",className:"tabs-grid",itemClassName:"tab-item",children:(e,t)=>{var s=we();const a=B(()=>t.item);let n;var i=v(s),o=v(i,!0);h(i);var c=p(i,2),d=v(c,!0);h(c),h(s),f(e=>{n=w(s,1,"sport-tab touch-friendly hover-scale transition-all svelte-eh2fp7",null,n,e),s.disabled=(l(_),m(()=>l(_).loading)),N(s,"aria-label",`${r(l(a)),m(()=>l(a).name)??""}のトーナメントを表示`),b(o,(r(l(a)),m(()=>l(a).icon))),b(d,(r(l(a)),m(()=>l(a).name)))},[()=>({active:l(_).currentSport===l(a).key})]),q("click",s,()=>async function(e){try{if(e===l(_).currentSport)return;const t=C.switchSport(e);t.success?await G(e):W.showNotification(t.message||"スポーツの切り替えに失敗しました","error")}catch(t){W.showNotification("スポーツの切り替えでエラーが発生しました","error")}}(l(a).key)),y(e,s)},$$slots:{default:!0}})}h(k);var j=p(k,2),L=v(j),z=e=>{var t=ge(),s=v(t),a=p(v(s),2),n=v(a,!0);h(a);var i=p(a,2);h(s),h(t),f(()=>b(n,(l(_),m(()=>l(_).error)))),q("click",i,Q),y(e,t)},D=e=>{var t=P(),s=$(t),a=e=>{var t=be(),s=v(t);M(s,{size:"large"}),J(2),h(t),y(e,t)},n=e=>{var t=P(),s=$(t),a=e=>{O(e,{show:!0,type:"fadeInUp",duration:500,className:"tournament-container",children:(e,t)=>{pe(e,{get sport(){return l(_),m(()=>l(_).currentSport)},get matches(){return l(V)},isAdmin:!1})},$$slots:{default:!0}})},n=e=>{var t=ye(),s=v(t),a=p(v(s),2),n=v(a);h(a);var i=p(a,2);h(s),h(t),f(e=>b(n,`${e??""}のトーナメントはまだ開始されていません。`),[()=>(l(_),m(()=>Y(l(_).currentSport)))]),q("click",i,Q),y(e,t)};u(s,e=>{l(R),l(V),m(()=>l(R)&&l(V).length>0)?e(a):e(n,!1)},!0),y(e,t)};u(s,e=>{l(_),l(R),m(()=>l(_).loading&&!l(R))?e(a):e(n,!1)},!0),y(e,t)};u(L,e=>{l(_),m(()=>l(_).error)?e(z):e(D,!1)}),h(j),f(e=>{i.disabled=(l(_),l(x),m(()=>l(_).loading||l(x).loading)),c=w(o,1,"refresh-icon svelte-eh2fp7",null,c,e)},[()=>({spinning:l(_).loading||l(x).loading})]),q("click",i,Q),y(e,s)},$$slots:{default:!0}}),h(s),y(e,s)}}}),k(),g()}export{Se as component};
