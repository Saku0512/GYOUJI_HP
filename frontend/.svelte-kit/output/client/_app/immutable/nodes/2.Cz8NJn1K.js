import"../chunks/DsnmJJEf.js";import{i as je}from"../chunks/B1pWaKUj.js";import{a1 as Se,aB as Ae,y as D,aE as G,A as w,$ as v,C as e,aF as xe,a2 as m,a7 as n,u as l,a9 as p,a8 as s,a4 as N,aa as C,a5 as f,a6 as qe,a3 as ge,ae as V,ac as Re,aT as Be,ad as Ie,af as ze,ah as Ne,aC as Me}from"../chunks/CuY-H75l.js";import{i as x}from"../chunks/DWiXyezG.js";import{e as ye,i as Te,L as Oe}from"../chunks/CdAJyZzl.js";import{s as fe,f as he,r as $e,b as ke,u as O,e as Pe}from"../chunks/CzS31Zl-.js";import{p as de,s as Ue,a as Ce}from"../chunks/BKXpaS3L.js";import{t as pe}from"../chunks/DC-asg-G.js";import{b as Ee}from"../chunks/BjkiwGu8.js";function De(S){return{pending:"未実施",in_progress:"進行中",completed:"完了",cancelled:"キャンセル"}[S]||S}function Le(S,b){return S==null||b===null||b===void 0?"未実施":`${S} - ${b}`}function _e(S,b=10){return S?S.length<=b?S:S.substring(0,b-3)+"...":""}var Je=m('<div class="round svelte-l0munw" data-testid="match-round"> </div>'),We=m('<div class="schedule svelte-l0munw" data-testid="match-schedule"> </div>'),Fe=m('<span class="winner-badge svelte-l0munw">🏆</span>'),He=m('<span class="winner-badge svelte-l0munw">🏆</span>'),Ve=m('<div class="score-edit svelte-l0munw" data-testid="score-edit"><input type="number" min="0" class="score-input svelte-l0munw" data-testid="score1-input" placeholder="0"/> <span class="score-separator svelte-l0munw">-</span> <input type="number" min="0" class="score-input svelte-l0munw" data-testid="score2-input" placeholder="0"/></div> <div class="edit-actions svelte-l0munw"><button class="btn btn-primary btn-sm svelte-l0munw" data-testid="save-score-btn">保存</button> <button class="btn btn-secondary btn-sm svelte-l0munw" data-testid="cancel-edit-btn">キャンセル</button></div>',1),Ge=m('<div class="score svelte-l0munw"> </div>'),Qe=m('<div class="status svelte-l0munw" data-testid="match-status"> </div>'),Xe=m('<button class="edit-btn svelte-l0munw" data-testid="edit-match-btn" aria-label="試合結果を編集">✏️ 編集</button>'),Ye=m('<div class="score-display svelte-l0munw" data-testid="score-display"><!></div> <!>',1),Ze=m('<div class="match-details svelte-l0munw"><div class="completion-time svelte-l0munw" data-testid="completion-time"> </div></div>'),Ke=m('<div data-testid="match-card"><div class="match-header svelte-l0munw"><!> <!></div> <div class="teams svelte-l0munw"><div data-testid="team1"><span class="team-name svelte-l0munw"> </span> <!></div> <div class="vs-section svelte-l0munw"><span class="vs svelte-l0munw">vs</span></div> <div data-testid="team2"><!> <span class="team-name svelte-l0munw"> </span></div></div> <div class="score-section svelte-l0munw"><!></div> <!></div>');function et(S,b){Se(b,!1);const y=D(),se=D(),Q=D(),R=D();let t=de(b,"match",24,()=>({})),M=de(b,"editable",8,!1),k=de(b,"compact",8,!1);const X=Ae();let L=D(!1),B=D(t().score1||""),Y=D(t().score2||"");function Z(){M()&&(w(L,!e(L)),e(L)&&(w(B,t().score1||""),w(Y,t().score2||"")))}function K(){const a=parseInt(e(B)),d=parseInt(e(Y));if(isNaN(a)||isNaN(d)||a<0||d<0){X("error",{message:"スコアは0以上の数値を入力してください"});return}X("updateScore",{matchId:t().id,score1:a,score2:d}),w(L,!1)}function ne(){w(L,!1),w(B,t().score1||""),w(Y,t().score2||"")}function ae(a){return a.winner?a.winner:a.score1!==null&&a.score2!==null&&a.score1!==void 0&&a.score2!==void 0?a.score1>a.score2?a.team1:a.score2>a.score1?a.team2:"draw":null}function J(a){a.key==="Enter"?K():a.key==="Escape"&&ne()}G(()=>v(t()),()=>{w(y,ae(t()))}),G(()=>(v(k()),v(M()),e(L)),()=>{w(se,["match-card",k()?"compact":"",M()?"editable":"",e(L)?"edit-mode":""].filter(Boolean).join(" "))}),G(()=>(e(y),v(t())),()=>{w(Q,["team",e(y)===t().team1?"winner":""].filter(Boolean).join(" "))}),G(()=>(e(y),v(t())),()=>{w(R,["team",e(y)===t().team2?"winner":""].filter(Boolean).join(" "))}),xe(),je();var W=Ke(),P=n(W),ie=n(P);{var oe=a=>{var d=Je(),j=n(d,!0);s(d),N(()=>C(j,(v(t()),l(()=>t().round)))),f(a,d)};x(ie,a=>{v(t()),l(()=>t().round)&&a(oe)})}var ve=p(ie,2);{var ee=a=>{var d=We(),j=n(d,!0);s(d),N(u=>C(j,u),[()=>(v(t()),l(()=>new Date(t().scheduled_at).toLocaleDateString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})))]),f(a,d)};x(ve,a=>{v(t()),l(()=>t().scheduled_at)&&a(ee)})}s(P);var le=p(P,2),i=n(le),h=n(i),T=n(h,!0);s(h);var g=p(h,2);{var te=a=>{var d=Fe();f(a,d)};x(g,a=>{e(y),v(t()),l(()=>e(y)===t().team1)&&a(te)})}s(i);var F=p(i,4),ce=n(F);{var ue=a=>{var d=He();f(a,d)};x(ce,a=>{e(y),v(t()),l(()=>e(y)===t().team2)&&a(ue)})}var re=p(ce,2),r=n(re,!0);s(re),s(F),s(le);var o=p(le,2),c=n(o);{var $=a=>{var d=Ve(),j=ge(d),u=n(j);$e(u);var _=p(u,4);$e(_),s(j);var U=p(j,2),H=n(U),me=p(H,2);s(U),Ee(u,()=>e(B),q=>w(B,q)),V("keydown",u,J),Ee(_,()=>e(Y),q=>w(Y,q)),V("keydown",_,J),V("click",H,K),V("click",me,ne),f(a,d)},I=a=>{var d=Ye(),j=ge(d),u=n(j);{var _=q=>{var z=Ge(),we=n(z,!0);s(z),N(be=>C(we,be),[()=>(v(Le),v(t()),l(()=>Le(t().score1,t().score2)))]),f(q,z)},U=q=>{var z=Qe(),we=n(z,!0);s(z),N(be=>C(we,be),[()=>(v(De),v(t()),l(()=>De(t().status||"pending")))]),f(q,z)};x(u,q=>{v(t()),l(()=>t().score1!==null&&t().score1!==void 0&&t().score2!==null&&t().score2!==void 0)?q(_):q(U,!1)})}s(j);var H=p(j,2);{var me=q=>{var z=Xe();V("click",z,Z),f(q,z)};x(H,q=>{v(M()),v(t()),l(()=>M()&&t().status!=="completed")&&q(me)})}f(a,d)};x(c,a=>{e(L)?a($):a(I,!1)})}s(o);var E=p(o,2);{var A=a=>{var d=Ze(),j=n(d),u=n(j);s(j),s(d),N(_=>C(u,`完了: ${_??""}`),[()=>(v(t()),l(()=>new Date(t().completed_at).toLocaleDateString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})))]),f(a,d)};x(E,a=>{v(k()),v(t()),l(()=>!k()&&(t().completed_at||t().status==="completed"))&&a(A)})}s(W),N((a,d)=>{fe(W,1,he(e(se)),"svelte-l0munw"),fe(i,1,he(e(Q)),"svelte-l0munw"),C(T,a),fe(F,1,he(e(R)),"svelte-l0munw"),C(r,d)},[()=>(v(_e),v(t()),v(k()),l(()=>_e(t().team1||"Team A",k()?8:15))),()=>(v(_e),v(t()),v(k()),l(()=>_e(t().team2||"Team B",k()?8:15)))]),f(S,W),qe()}var tt=m('<p class="no-matches svelte-10kswq8">試合データがありません</p>'),at=m('<div class="winner-indicator svelte-10kswq8"> </div>'),rt=m('<button class="edit-button svelte-10kswq8" aria-label="試合結果を編集">結果入力</button>'),st=m('<div class="connection-line svelte-10kswq8" aria-hidden="true"></div>'),nt=m('<div class="match-wrapper svelte-10kswq8"><div class="match-card-container svelte-10kswq8"><!> <!> <!></div> <!></div>'),it=m('<div class="round-column svelte-10kswq8"><h3 class="round-title svelte-10kswq8"> </h3> <div class="matches-container svelte-10kswq8"></div></div>'),ot=m('<div class="bracket-container svelte-10kswq8"></div>'),lt=m('<div><div class="bracket-header svelte-10kswq8"><h2 class="tournament-title svelte-10kswq8"> </h2> <!></div> <!></div>');function dt(S,b){Se(b,!1);const y=D(),se=D();let Q=de(b,"sport",8,"volleyball"),R=de(b,"matches",24,()=>[]),t=de(b,"isAdmin",8,!1),M=de(b,"onEditMatch",8,null);const k={volleyball:"バレーボール",table_tennis:"卓球",soccer:"サッカー"},X={round_1:"1回戦",round_2:"2回戦",quarterfinal:"準々決勝",semifinal:"準決勝",final:"決勝",third_place:"3位決定戦"};function L(i){return Array.isArray(i)?i.reduce((h,T)=>{if(!T||typeof T!="object")return h;const g=T.round||"unknown";return h[g]||(h[g]=[]),h[g].push(T),h},{}):{}}function B(i){const h=Object.keys(i),T=["round_1","round_2","quarterfinal","semifinal","third_place","final"];return T.filter(g=>h.includes(g)).concat(h.filter(g=>!T.includes(g)))}function Y(i){t()&&M()&&typeof M()=="function"&&M()(i)}function Z(i){if(i.winner)return i.winner;if(i.score1!==void 0&&i.score2!==void 0){if(i.score1>i.score2)return i.team1;if(i.score2>i.score1)return i.team2}return null}function K(i){return i.status==="completed"||i.score1!==void 0&&i.score2!==void 0?"completed":i.status==="in_progress"?"in_progress":"pending"}function ne(){if(typeof window<"u"){const i=window.innerWidth;return i<768?"mobile":i<1024?"tablet":"desktop"}return"desktop"}let ae=D("desktop");typeof window<"u"&&(w(ae,ne()),window.addEventListener("resize",()=>{w(ae,ne())})),G(()=>v(R()),()=>{w(y,L(R()))}),G(()=>e(y),()=>{w(se,B(e(y)))}),xe(),je();var J=lt(),W=n(J),P=n(W),ie=n(P);s(P);var oe=p(P,2);{var ve=i=>{var h=tt();f(i,h)};x(oe,i=>{v(R()),l(()=>R().length===0)&&i(ve)})}s(W);var ee=p(W,2);{var le=i=>{var h=ot();ye(h,5,()=>e(se),Te,(T,g)=>{var te=it(),F=n(te),ce=n(F,!0);s(F);var ue=p(F,2);ye(ue,5,()=>(e(y),e(g),l(()=>e(y)[e(g)])),re=>re.id,(re,r)=>{var o=nt(),c=n(o),$=n(c);et($,{get match(){return e(r)},get editable(){return t()}});var I=p($,2);{var E=u=>{var _=at(),U=n(_);s(_),N(H=>C(U,`勝者: ${H??""}`),[()=>(e(r),l(()=>Z(e(r))))]),f(u,_)};x(I,u=>{e(r),l(()=>Z(e(r)))&&u(E)})}var A=p(I,2);{var a=u=>{var _=rt();V("click",_,()=>Y(e(r))),f(u,_)};x(A,u=>{v(t()),e(r),l(()=>t()&&K(e(r))==="pending")&&u(a)})}s(c);var d=p(c,2);{var j=u=>{var _=st();f(u,_)};x(d,u=>{e(g)!=="final"&&e(g)!=="third_place"&&u(j)})}s(o),N(u=>ke(o,"data-status",u),[()=>(e(r),l(()=>K(e(r))))]),f(re,o)}),s(ue),s(te),N(()=>{ke(te,"data-round",e(g)),C(ce,(e(g),l(()=>X[e(g)]||e(g))))}),f(T,te)}),s(h),f(i,h)};x(ee,i=>{v(R()),l(()=>R().length>0)&&i(le)})}s(J),N(()=>{fe(J,1,`tournament-bracket ${e(ae)??""}`,"svelte-10kswq8"),C(ie,`${v(Q()),l(()=>k[Q()]||Q())??""} トーナメント`)}),f(S,J),qe()}var vt=m('<meta name="description" content="バレーボール、卓球、サッカーのトーナメント結果をリアルタイムで確認できます"/>'),ct=m('<span class="last-updated svelte-srgitj"> </span>'),ut=m('<button><span class="sport-icon svelte-srgitj"> </span> <span class="sport-name svelte-srgitj"> </span></button>'),ft=m('<div class="error-container svelte-srgitj"><div class="error-message svelte-srgitj"><h3 class="svelte-srgitj">エラーが発生しました</h3> <p class="svelte-srgitj"> </p> <button class="retry-button svelte-srgitj">再試行</button></div></div>'),mt=m('<div class="loading-container svelte-srgitj"><!> <p class="loading-text svelte-srgitj">トーナメントデータを読み込み中...</p></div>'),pt=m('<div class="tournament-container svelte-srgitj"><!></div>'),_t=m('<div class="no-data-container svelte-srgitj"><div class="no-data-message svelte-srgitj"><h3 class="svelte-srgitj">トーナメントデータがありません</h3> <p class="svelte-srgitj"> </p> <button class="refresh-button svelte-srgitj">データを確認</button></div></div>'),gt=m('<div class="homepage svelte-srgitj"><div class="container svelte-srgitj"><div class="page-header svelte-srgitj"><h1 class="page-title svelte-srgitj">トーナメント管理システム</h1> <p class="page-description svelte-srgitj">リアルタイムでトーナメントの進行状況を確認できます</p> <div class="header-actions svelte-srgitj"><button class="refresh-button svelte-srgitj" aria-label="データを更新"><span>🔄</span> 更新</button> <!></div></div> <div class="sports-tabs svelte-srgitj"><div class="tabs-container svelte-srgitj"></div></div> <div class="main-content svelte-srgitj"><!></div></div></div>');function Nt(S,b){Se(b,!1);const[y,se]=Ue(),Q=()=>Ce(pe,"$tournamentStore",y),R=()=>Ce(Pe,"$uiStore",y),t=D(),M=D(),k=D(),X=D(),L=[{key:"volleyball",name:"バレーボール",icon:"🏐"},{key:"table_tennis",name:"卓球",icon:"🏓"},{key:"soccer",name:"サッカー",icon:"⚽"}];let B=null;Re(async()=>{try{await pe.initialize(),await Z(e(t).currentSport),ne()}catch(r){console.error("Homepage initialization error:",r),O.showNotification("データの読み込みに失敗しました","error")}}),Be(()=>{ae()});async function Y(r){try{if(r===e(t).currentSport)return;const o=pe.switchSport(r);o.success?await Z(r):O.showNotification(o.message||"スポーツの切り替えに失敗しました","error")}catch(o){console.error("Sport change error:",o),O.showNotification("スポーツの切り替えでエラーが発生しました","error")}}async function Z(r,o=!0){try{o&&O.setLoading(!0);const c=await pe.fetchTournaments(r);return c.success||O.showNotification(c.message||"データの取得に失敗しました","error"),c}catch(c){return console.error("Load tournament data error:",c),O.showNotification("データの読み込みでエラーが発生しました","error"),{success:!1,message:c.message}}finally{o&&O.setLoading(!1)}}async function K(){try{O.setLoading(!0);const r=await pe.refreshData(e(t).currentSport);r.success?O.showNotification("データを更新しました","success"):O.showNotification(r.message||"データの更新に失敗しました","error")}catch(r){console.error("Refresh error:",r),O.showNotification("データの更新でエラーが発生しました","error")}finally{O.setLoading(!1)}}function ne(){ae(),B=setInterval(async()=>{if(!(typeof document<"u"&&document.hidden)&&!(e(t).loading||e(M).loading))try{await Z(e(t).currentSport,!1)}catch(r){console.error("Polling update error:",r)}},3e4)}function ae(){B&&(clearInterval(B),B=null)}function J(r){const o=L.find(c=>c.key===r);return o?o.name:r}function W(){typeof document<"u"&&(document.hidden||Z(e(t).currentSport,!1))}typeof document<"u"&&document.addEventListener("visibilitychange",W),G(()=>Q(),()=>{w(t,Q())}),G(()=>R(),()=>{w(M,R())}),G(()=>e(t),()=>{w(k,e(t).tournaments[e(t).currentSport]||null)}),G(()=>e(k),()=>{w(X,e(k)?.matches||[])}),xe(),je();var P=gt();Ie(r=>{var o=vt();N(c=>ze.title=`トーナメント管理システム - ${c??""}`,[()=>(e(t),l(()=>J(e(t).currentSport)))]),f(r,o)});var ie=n(P),oe=n(ie),ve=p(n(oe),4),ee=n(ve),le=n(ee);let i;Ne(),s(ee);var h=p(ee,2);{var T=r=>{var o=ct(),c=n(o);s(o),N($=>C(c,`最終更新: ${$??""}`),[()=>(e(t),l(()=>new Date(e(t).lastUpdated).toLocaleTimeString("ja-JP")))]),f(r,o)};x(h,r=>{e(t),l(()=>e(t).lastUpdated)&&r(T)})}s(ve),s(oe);var g=p(oe,2),te=n(g);ye(te,5,()=>L,Te,(r,o)=>{var c=ut();let $;var I=n(c),E=n(I,!0);s(I);var A=p(I,2),a=n(A,!0);s(A),s(c),N(d=>{$=fe(c,1,"sport-tab svelte-srgitj",null,$,d),c.disabled=(e(t),l(()=>e(t).loading)),ke(c,"aria-label",`${e(o),l(()=>e(o).name)??""}のトーナメントを表示`),C(E,(e(o),l(()=>e(o).icon))),C(a,(e(o),l(()=>e(o).name)))},[()=>({active:e(t).currentSport===e(o).key})]),V("click",c,()=>Y(e(o).key)),f(r,c)}),s(te),s(g);var F=p(g,2),ce=n(F);{var ue=r=>{var o=ft(),c=n(o),$=p(n(c),2),I=n($,!0);s($);var E=p($,2);s(c),s(o),N(()=>C(I,(e(t),l(()=>e(t).error)))),V("click",E,K),f(r,o)},re=r=>{var o=Me(),c=ge(o);{var $=E=>{var A=mt(),a=n(A);Oe(a,{size:"large"}),Ne(2),s(A),f(E,A)},I=E=>{var A=Me(),a=ge(A);{var d=u=>{var _=pt(),U=n(_);dt(U,{get sport(){return e(t),l(()=>e(t).currentSport)},get matches(){return e(X)},isAdmin:!1}),s(_),f(u,_)},j=u=>{var _=_t(),U=n(_),H=p(n(U),2),me=n(H);s(H);var q=p(H,2);s(U),s(_),N(z=>C(me,`${z??""}のトーナメントはまだ開始されていません。`),[()=>(e(t),l(()=>J(e(t).currentSport)))]),V("click",q,K),f(u,_)};x(a,u=>{e(k),e(X),l(()=>e(k)&&e(X).length>0)?u(d):u(j,!1)},!0)}f(E,A)};x(c,E=>{e(t),e(k),l(()=>e(t).loading&&!e(k))?E($):E(I,!1)},!0)}f(r,o)};x(ce,r=>{e(t),l(()=>e(t).error)?r(ue):r(re,!1)})}s(F),s(ie),s(P),N(r=>{ee.disabled=(e(t),e(M),l(()=>e(t).loading||e(M).loading)),i=fe(le,1,"refresh-icon svelte-srgitj",null,i,r)},[()=>({spinning:e(t).loading||e(M).loading})]),V("click",ee,K),f(S,P),qe(),se()}export{Nt as component};
