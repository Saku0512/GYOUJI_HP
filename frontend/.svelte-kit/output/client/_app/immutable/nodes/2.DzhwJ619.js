import"../chunks/DsnmJJEf.js";import"../chunks/DUpwANU7.js";import{w as Qe,g as ce,c as Ye,a as C,e as X,o as Ke,b as et}from"../chunks/CT_lE3Pl.js";import{a3 as je,J as N,aE as Z,K as T,B as g,A as r,aF as Oe,$ as w,a7 as l,u as v,a9 as y,a8 as c,a5 as O,a1 as _,a6 as Ie,a4 as Se,a0 as tt,a2 as rt,ar as Ue,aB as Pe}from"../chunks/BqLxJNge.js";import{i as $}from"../chunks/B7cxby2x.js";import{e as $e,i as ze,L as st}from"../chunks/YSpBSuTq.js";import{a as Je,s as pe,f as Ae,r as xe,b as ke,u as H,e as at}from"../chunks/DT5H3szw.js";import{i as Ce}from"../chunks/B2k5sg_-.js";import{p as fe,s as nt,a as Ge}from"../chunks/CCKrlfp6.js";import{b as Le}from"../chunks/CI-XvY1A.js";class ot{constructor(t=Je){this.client=t,this.supportedSports=["volleyball","table_tennis","soccer"]}validateSport(t){if(!t)throw new Error("スポーツ名が指定されていません");if(!this.supportedSports.includes(t))throw new Error(`サポートされていないスポーツです: ${t}`);return!0}async getTournaments(){try{const t=await this.client.get("/tournaments");return t.success?{success:!0,data:t.data,message:"トーナメント一覧を取得しました"}:t}catch(t){return console.error("Get tournaments error:",t),{success:!1,error:"GET_TOURNAMENTS_ERROR",message:"トーナメント一覧の取得に失敗しました",details:t.message}}}async getTournament(t){try{this.validateSport(t);const e=await this.client.get(`/tournaments/${t}`);return e.success?{success:!0,data:e.data,message:`${t}のトーナメント情報を取得しました`}:e}catch(e){return console.error("Get tournament error:",e),{success:!1,error:"GET_TOURNAMENT_ERROR",message:"トーナメント情報の取得に失敗しました",details:e.message}}}async getTournamentBracket(t){try{this.validateSport(t);const e=await this.client.get(`/tournaments/${t}/bracket`);return e.success?{success:!0,data:e.data,message:`${t}のブラケット情報を取得しました`}:e}catch(e){return console.error("Get tournament bracket error:",e),{success:!1,error:"GET_BRACKET_ERROR",message:"ブラケット情報の取得に失敗しました",details:e.message}}}async updateTournamentFormat(t,e){try{if(this.validateSport(t),!e)throw new Error("形式が指定されていません");const a=await this.client.put(`/tournaments/${t}/format`,{format:e});return a.success?{success:!0,data:a.data,message:`${t}のトーナメント形式を${e}に更新しました`}:a}catch(a){return console.error("Update tournament format error:",a),{success:!1,error:"UPDATE_FORMAT_ERROR",message:"トーナメント形式の更新に失敗しました",details:a.message}}}async createTournament(t){try{const{sport:e,format:a,teams:m}=t;if(this.validateSport(e),!a)throw new Error("トーナメント形式が指定されていません");if(!m||!Array.isArray(m)||m.length===0)throw new Error("参加チーム情報が正しくありません");const R=await this.client.post("/tournaments",{sport:e,format:a,teams:m});return R.success?{success:!0,data:R.data,message:`${e}のトーナメントを作成しました`}:R}catch(e){return console.error("Create tournament error:",e),{success:!1,error:"CREATE_TOURNAMENT_ERROR",message:"トーナメントの作成に失敗しました",details:e.message}}}async deleteTournament(t){try{this.validateSport(t);const e=await this.client.delete(`/tournaments/${t}`);return e.success?{success:!0,data:e.data,message:`${t}のトーナメントを削除しました`}:e}catch(e){return console.error("Delete tournament error:",e),{success:!1,error:"DELETE_TOURNAMENT_ERROR",message:"トーナメントの削除に失敗しました",details:e.message}}}async updateTournamentStatus(t,e){try{if(this.validateSport(t),!["pending","active","completed","cancelled"].includes(e))throw new Error(`無効なステータスです: ${e}`);const m=await this.client.patch(`/tournaments/${t}/status`,{status:e});return m.success?{success:!0,data:m.data,message:`${t}のトーナメント状態を${e}に更新しました`}:m}catch(a){return console.error("Update tournament status error:",a),{success:!1,error:"UPDATE_STATUS_ERROR",message:"トーナメント状態の更新に失敗しました",details:a.message}}}async getTournamentStats(t){try{this.validateSport(t);const e=await this.client.get(`/tournaments/${t}/stats`);return e.success?{success:!0,data:e.data,message:`${t}の統計情報を取得しました`}:e}catch(e){return console.error("Get tournament stats error:",e),{success:!1,error:"GET_STATS_ERROR",message:"統計情報の取得に失敗しました",details:e.message}}}async getAvailableFormats(t){try{this.validateSport(t);const e=await this.client.get(`/tournaments/${t}/formats`);return e.success?{success:!0,data:e.data,message:`${t}の利用可能な形式一覧を取得しました`}:e}catch(e){return console.error("Get available formats error:",e),{success:!1,error:"GET_FORMATS_ERROR",message:"形式一覧の取得に失敗しました",details:e.message}}}getSupportedSports(){return{success:!0,data:this.supportedSports,message:"サポートされているスポーツ一覧"}}}const qe=new ot;class it{constructor(t=Je){this.client=t,this.supportedSports=["volleyball","table_tennis","soccer"],this.validStatuses=["pending","in_progress","completed","cancelled"]}validateSport(t){if(!t)throw new Error("スポーツ名が指定されていません");if(!this.supportedSports.includes(t))throw new Error(`サポートされていないスポーツです: ${t}`);return!0}validateMatchId(t){if(!t)throw new Error("試合IDが指定されていません");if(typeof t!="number"&&typeof t!="string")throw new Error("試合IDの形式が正しくありません");return!0}validateMatchResult(t){if(!t||typeof t!="object")throw new Error("試合結果データが正しくありません");const{score1:e,score2:a,winner:m}=t;if(e!==void 0&&(typeof e!="number"||e<0))throw new Error("チーム1のスコアが正しくありません");if(a!==void 0&&(typeof a!="number"||a<0))throw new Error("チーム2のスコアが正しくありません");if(e!==void 0&&a!==void 0&&m!==void 0&&(typeof m!="string"||m.trim()===""))throw new Error("勝者の情報が正しくありません");return!0}async getMatches(t,e={}){try{this.validateSport(t);const a=new URLSearchParams;e.status&&a.append("status",e.status),e.round&&a.append("round",e.round),e.limit&&a.append("limit",e.limit.toString()),e.offset&&a.append("offset",e.offset.toString());const m=a.toString(),R=`/matches/${t}${m?`?${m}`:""}`,s=await this.client.get(R);return s.success?{success:!0,data:s.data,message:`${t}の試合一覧を取得しました`}:s}catch(a){return console.error("Get matches error:",a),{success:!1,error:"GET_MATCHES_ERROR",message:"試合一覧の取得に失敗しました",details:a.message}}}async getMatch(t){try{this.validateMatchId(t);const e=await this.client.get(`/matches/${t}`);return e.success?{success:!0,data:e.data,message:"試合詳細を取得しました"}:e}catch(e){return console.error("Get match error:",e),{success:!1,error:"GET_MATCH_ERROR",message:"試合詳細の取得に失敗しました",details:e.message}}}async updateMatch(t,e){try{this.validateMatchId(t),this.validateMatchResult(e);const a=await this.client.put(`/matches/${t}`,e);return a.success?{success:!0,data:a.data,message:"試合結果を更新しました"}:a}catch(a){return console.error("Update match error:",a),{success:!1,error:"UPDATE_MATCH_ERROR",message:"試合結果の更新に失敗しました",details:a.message}}}async createMatch(t){try{if(!t||typeof t!="object")throw new Error("試合データが正しくありません");const{sport:e,tournament_id:a,round:m,team1:R,team2:s,scheduled_at:k}=t;if(!e)throw new Error("スポーツが指定されていません");if(this.validateSport(e),!a)throw new Error("トーナメントIDが指定されていません");if(!m)throw new Error("ラウンドが指定されていません");if(!R||!s)throw new Error("対戦チームが正しく指定されていません");if(R===s)throw new Error("同じチーム同士の試合は作成できません");const S=await this.client.post("/matches",t);return S.success?{success:!0,data:S.data,message:"新しい試合を作成しました"}:S}catch(e){return console.error("Create match error:",e),{success:!1,error:"CREATE_MATCH_ERROR",message:"試合の作成に失敗しました",details:e.message}}}async deleteMatch(t){try{this.validateMatchId(t);const e=await this.client.delete(`/matches/${t}`);return e.success?{success:!0,data:e.data,message:"試合を削除しました"}:e}catch(e){return console.error("Delete match error:",e),{success:!1,error:"DELETE_MATCH_ERROR",message:"試合の削除に失敗しました",details:e.message}}}async updateMatchStatus(t,e){try{if(this.validateMatchId(t),!this.validStatuses.includes(e))throw new Error(`無効なステータスです: ${e}`);const a=await this.client.patch(`/matches/${t}/status`,{status:e});return a.success?{success:!0,data:a.data,message:`試合状態を${e}に更新しました`}:a}catch(a){return console.error("Update match status error:",a),{success:!1,error:"UPDATE_MATCH_STATUS_ERROR",message:"試合状態の更新に失敗しました",details:a.message}}}async getPendingMatches(t){try{this.validateSport(t);const e=await this.client.get(`/matches/${t}/pending`);return e.success?{success:!0,data:e.data,message:`${t}の未完了試合一覧を取得しました`}:e}catch(e){return console.error("Get pending matches error:",e),{success:!1,error:"GET_PENDING_MATCHES_ERROR",message:"未完了試合一覧の取得に失敗しました",details:e.message}}}async updateMultipleMatches(t){try{if(!Array.isArray(t)||t.length===0)throw new Error("更新データが正しくありません");for(const a of t){if(!a.matchId)throw new Error("試合IDが指定されていない更新データがあります");this.validateMatchId(a.matchId),this.validateMatchResult(a.result)}const e=await this.client.put("/matches/batch",{updates:t});return e.success?{success:!0,data:e.data,message:`${t.length}件の試合結果を更新しました`}:e}catch(e){return console.error("Update multiple matches error:",e),{success:!1,error:"UPDATE_MULTIPLE_MATCHES_ERROR",message:"試合結果の一括更新に失敗しました",details:e.message}}}async getMatchStats(t){try{this.validateMatchId(t);const e=await this.client.get(`/matches/${t}/stats`);return e.success?{success:!0,data:e.data,message:"試合統計情報を取得しました"}:e}catch(e){return console.error("Get match stats error:",e),{success:!1,error:"GET_MATCH_STATS_ERROR",message:"試合統計情報の取得に失敗しました",details:e.message}}}async getNextMatch(t){try{this.validateSport(t);const e=await this.client.get(`/matches/${t}/next`);return e.success?{success:!0,data:e.data,message:`${t}の次の試合情報を取得しました`}:e}catch(e){return console.error("Get next match error:",e),{success:!1,error:"GET_NEXT_MATCH_ERROR",message:"次の試合情報の取得に失敗しました",details:e.message}}}getSupportedSports(){return{success:!0,data:this.supportedSports,message:"サポートされているスポーツ一覧"}}getValidStatuses(){return{success:!0,data:this.validStatuses,message:"有効なステータス一覧"}}}const ct=new it,Ve={tournaments:{},currentSport:"volleyball",loading:!1,error:null,lastUpdated:null,cache:{},pollingInterval:null},{subscribe:ne,set:lt,update:Q}=Qe(Ve),ut=300*1e3,dt=30*1e3,We=["volleyball","table_tennis","soccer"];function be(n){Q(t=>({...t,loading:n}))}function ae(n){Q(t=>({...t,error:n,loading:!1}))}function Re(){Q(n=>({...n,error:null}))}function De(n){if(!n)throw new Error("スポーツ名が指定されていません");if(!We.includes(n))throw new Error(`サポートされていないスポーツです: ${n}`);return!0}function vt(n){const e=ce({subscribe:ne}).cache[n];return!e||!e.timestamp?!1:Date.now()-e.timestamp<ut}function ft(n){const e=ce({subscribe:ne}).cache[n];return e&&vt(n)?e.data:null}function He(n,t){Q(e=>({...e,cache:{...e.cache,[n]:{data:t,timestamp:Date.now()}}}))}async function ye(n=null,t=!0){try{if(Re(),n){if(De(n),t){const a=ft(n);if(a)return Q(m=>({...m,tournaments:{...m.tournaments,[n]:a}})),{success:!0,data:a,message:`${n}のトーナメントデータを取得しました（キャッシュ）`}}be(!0);const e=await qe.getTournament(n);return e.success?(Q(a=>({...a,tournaments:{...a.tournaments,[n]:e.data},loading:!1,lastUpdated:Date.now()})),He(n,e.data),e):(ae(e.message||"トーナメントデータの取得に失敗しました"),e)}else{be(!0);const e=await qe.getTournaments();return e.success?(Q(a=>({...a,tournaments:e.data,loading:!1,lastUpdated:Date.now()})),e.data&&typeof e.data=="object"&&Object.keys(e.data).forEach(a=>{He(a,e.data[a])}),e):(ae(e.message||"トーナメントデータの取得に失敗しました"),e)}}catch(e){return console.error("Fetch tournaments error:",e),ae(e.message||"予期しないエラーが発生しました"),{success:!1,error:"FETCH_TOURNAMENTS_ERROR",message:e.message||"トーナメントデータの取得に失敗しました"}}}async function mt(n,t){try{if(Re(),!n)throw new Error("試合IDが指定されていません");if(!t||typeof t!="object")throw new Error("試合結果データが正しくありません");be(!0);const e=await ct.updateMatch(n,t);if(e.success){const m=ce({subscribe:ne}).currentSport;return await ye(m,!1),{success:!0,data:e.data,message:"試合結果を更新しました"}}else return ae(e.message||"試合結果の更新に失敗しました"),e}catch(e){return console.error("Update match error:",e),ae(e.message||"予期しないエラーが発生しました"),{success:!1,error:"UPDATE_MATCH_ERROR",message:e.message||"試合結果の更新に失敗しました"}}}function gt(n){try{return De(n),Q(t=>({...t,currentSport:n,error:null})),ye(n),{success:!0,message:`スポーツを${n}に切り替えました`}}catch(t){return console.error("Switch sport error:",t),ae(t.message||"スポーツの切り替えに失敗しました"),{success:!1,error:"SWITCH_SPORT_ERROR",message:t.message||"スポーツの切り替えに失敗しました"}}}async function Ne(n=null){try{Re();const t=ce({subscribe:ne}),e=n||t.currentSport,a=await ye(e,!1);return{success:!0,message:"データを更新しました"}}catch(t){return console.error("Refresh data error:",t),ae(t.message||"データの更新に失敗しました"),{success:!1,error:"REFRESH_DATA_ERROR",message:t.message||"データの更新に失敗しました"}}}function Xe(){if(ce({subscribe:ne}).pollingInterval)return;const t=setInterval(async()=>{if(!(typeof document<"u"&&document.hidden||ce({subscribe:ne}).loading))try{await Ne()}catch(a){console.error("Polling error:",a)}},dt);Q(e=>({...e,pollingInterval:t}))}function Ze(){Q(n=>(n.pollingInterval&&clearInterval(n.pollingInterval),{...n,pollingInterval:null}))}async function ht(){try{return await ye(),Xe(),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden||Ne()}),{success:!0,message:"トーナメントストアを初期化しました"}}catch(n){return console.error("Initialize tournament store error:",n),ae(n.message||"初期化に失敗しました"),{success:!1,error:"INITIALIZE_ERROR",message:n.message||"初期化に失敗しました"}}}function pt(){return Ze(),lt(Ve),{success:!0,message:"トーナメントストアをクリーンアップしました"}}function _t(){const n=ce({subscribe:ne});return n.tournaments[n.currentSport]||null}function wt(n){return De(n),ce({subscribe:ne}).tournaments[n]||null}function yt(){return[...We]}const we={subscribe:ne,fetchTournaments:ye,updateMatch:mt,switchSport:gt,refreshData:Ne,initialize:ht,cleanup:pt,startPolling:Xe,stopPolling:Ze,getCurrentTournament:_t,getTournamentBySport:wt,getSupportedSports:yt,setLoading:be,setError:ae,clearError:Re};function Be(n){return{pending:"未実施",in_progress:"進行中",completed:"完了",cancelled:"キャンセル"}[n]||n}function Fe(n,t){return n==null||t===null||t===void 0?"未実施":`${n} - ${t}`}function Ee(n,t=10){return n?n.length<=t?n:n.substring(0,t-3)+"...":""}var Et=w('<div class="round svelte-l0munw" data-testid="match-round"> </div>'),St=w('<div class="schedule svelte-l0munw" data-testid="match-schedule"> </div>'),bt=w('<span class="winner-badge svelte-l0munw">🏆</span>'),Rt=w('<span class="winner-badge svelte-l0munw">🏆</span>'),Tt=w('<div class="score-edit svelte-l0munw" data-testid="score-edit"><input type="number" min="0" class="score-input svelte-l0munw" data-testid="score1-input" placeholder="0"/> <span class="score-separator svelte-l0munw">-</span> <input type="number" min="0" class="score-input svelte-l0munw" data-testid="score2-input" placeholder="0"/></div> <div class="edit-actions svelte-l0munw"><button class="btn btn-primary btn-sm svelte-l0munw" data-testid="save-score-btn">保存</button> <button class="btn btn-secondary btn-sm svelte-l0munw" data-testid="cancel-edit-btn">キャンセル</button></div>',1),Mt=w('<div class="score svelte-l0munw"> </div>'),At=w('<div class="status svelte-l0munw" data-testid="match-status"> </div>'),$t=w('<button class="edit-btn svelte-l0munw" data-testid="edit-match-btn" aria-label="試合結果を編集">✏️ 編集</button>'),kt=w('<div class="score-display svelte-l0munw" data-testid="score-display"><!></div> <!>',1),jt=w('<div class="match-details svelte-l0munw"><div class="completion-time svelte-l0munw" data-testid="completion-time"> </div></div>'),Ot=w('<div data-testid="match-card"><div class="match-header svelte-l0munw"><!> <!></div> <div class="teams svelte-l0munw"><div data-testid="team1"><span class="team-name svelte-l0munw"> </span> <!></div> <div class="vs-section svelte-l0munw"><span class="vs svelte-l0munw">vs</span></div> <div data-testid="team2"><!> <span class="team-name svelte-l0munw"> </span></div></div> <div class="score-section svelte-l0munw"><!></div> <!></div>');function It(n,t){je(t,!1);const e=N(),a=N(),m=N(),R=N();let s=fe(t,"match",24,()=>({})),k=fe(t,"editable",8,!1),S=fe(t,"compact",8,!1);const Y=Ye();let U=N(!1),G=N(s().score1||""),K=N(s().score2||"");function ee(){k()&&(T(U,!r(U)),r(U)&&(T(G,s().score1||""),T(K,s().score2||"")))}function te(){const o=parseInt(r(G)),f=parseInt(r(K));if(isNaN(o)||isNaN(f)||o<0||f<0){Y("error",{message:"スコアは0以上の数値を入力してください"});return}Y("updateScore",{matchId:s().id,score1:o,score2:f}),T(U,!1)}function le(){T(U,!1),T(G,s().score1||""),T(K,s().score2||"")}function oe(o){return o.winner?o.winner:o.score1!==null&&o.score2!==null&&o.score1!==void 0&&o.score2!==void 0?o.score1>o.score2?o.team1:o.score2>o.score1?o.team2:"draw":null}function z(o){o.key==="Enter"?te():o.key==="Escape"&&le()}Z(()=>g(s()),()=>{T(e,oe(s()))}),Z(()=>(g(S()),g(k()),r(U)),()=>{T(a,["match-card",S()?"compact":"",k()?"editable":"",r(U)?"edit-mode":""].filter(Boolean).join(" "))}),Z(()=>(r(e),g(s())),()=>{T(m,["team",r(e)===s().team1?"winner":""].filter(Boolean).join(" "))}),Z(()=>(r(e),g(s())),()=>{T(R,["team",r(e)===s().team2?"winner":""].filter(Boolean).join(" "))}),Oe(),Ce();var J=Ot(),B=l(J),ue=l(B);{var de=o=>{var f=Et(),A=l(f,!0);c(f),O(()=>C(A,(g(s()),v(()=>s().round)))),_(o,f)};$(ue,o=>{g(s()),v(()=>s().round)&&o(de)})}var me=y(ue,2);{var re=o=>{var f=St(),A=l(f,!0);c(f),O(p=>C(A,p),[()=>(g(s()),v(()=>new Date(s().scheduled_at).toLocaleDateString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})))]),_(o,f)};$(me,o=>{g(s()),v(()=>s().scheduled_at)&&o(re)})}c(B);var ve=y(B,2),u=l(ve),M=l(u),P=l(M,!0);c(M);var b=y(M,2);{var se=o=>{var f=bt();_(o,f)};$(b,o=>{r(e),g(s()),v(()=>r(e)===s().team1)&&o(se)})}c(u);var V=y(u,4),ge=l(V);{var he=o=>{var f=Rt();_(o,f)};$(ge,o=>{r(e),g(s()),v(()=>r(e)===s().team2)&&o(he)})}var ie=y(ge,2),i=l(ie,!0);c(ie),c(V),c(ve);var d=y(ve,2),h=l(d);{var I=o=>{var f=Tt(),A=Se(f),p=l(A);xe(p);var E=y(p,4);xe(E),c(A);var F=y(A,2),W=l(F),_e=y(W,2);c(F),Le(p,()=>r(G),j=>T(G,j)),X("keydown",p,z),Le(E,()=>r(K),j=>T(K,j)),X("keydown",E,z),X("click",W,te),X("click",_e,le),_(o,f)},L=o=>{var f=kt(),A=Se(f),p=l(A);{var E=j=>{var q=Mt(),Te=l(q,!0);c(q),O(Me=>C(Te,Me),[()=>(g(Fe),g(s()),v(()=>Fe(s().score1,s().score2)))]),_(j,q)},F=j=>{var q=At(),Te=l(q,!0);c(q),O(Me=>C(Te,Me),[()=>(g(Be),g(s()),v(()=>Be(s().status||"pending")))]),_(j,q)};$(p,j=>{g(s()),v(()=>s().score1!==null&&s().score1!==void 0&&s().score2!==null&&s().score2!==void 0)?j(E):j(F,!1)})}c(A);var W=y(A,2);{var _e=j=>{var q=$t();X("click",q,ee),_(j,q)};$(W,j=>{g(k()),g(s()),v(()=>k()&&s().status!=="completed")&&j(_e)})}_(o,f)};$(h,o=>{r(U)?o(I):o(L,!1)})}c(d);var D=y(d,2);{var x=o=>{var f=jt(),A=l(f),p=l(A);c(A),c(f),O(E=>C(p,`完了: ${E??""}`),[()=>(g(s()),v(()=>new Date(s().completed_at).toLocaleDateString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})))]),_(o,f)};$(D,o=>{g(S()),g(s()),v(()=>!S()&&(s().completed_at||s().status==="completed"))&&o(x)})}c(J),O((o,f)=>{pe(J,1,Ae(r(a)),"svelte-l0munw"),pe(u,1,Ae(r(m)),"svelte-l0munw"),C(P,o),pe(V,1,Ae(r(R)),"svelte-l0munw"),C(i,f)},[()=>(g(Ee),g(s()),g(S()),v(()=>Ee(s().team1||"Team A",S()?8:15))),()=>(g(Ee),g(s()),g(S()),v(()=>Ee(s().team2||"Team B",S()?8:15)))]),_(n,J),Ie()}var Ct=w('<p class="no-matches svelte-10kswq8">試合データがありません</p>'),Dt=w('<div class="winner-indicator svelte-10kswq8"> </div>'),Nt=w('<button class="edit-button svelte-10kswq8" aria-label="試合結果を編集">結果入力</button>'),Ut=w('<div class="connection-line svelte-10kswq8" aria-hidden="true"></div>'),Pt=w('<div class="match-wrapper svelte-10kswq8"><div class="match-card-container svelte-10kswq8"><!> <!> <!></div> <!></div>'),xt=w('<div class="round-column svelte-10kswq8"><h3 class="round-title svelte-10kswq8"> </h3> <div class="matches-container svelte-10kswq8"></div></div>'),Gt=w('<div class="bracket-container svelte-10kswq8"></div>'),Lt=w('<div><div class="bracket-header svelte-10kswq8"><h2 class="tournament-title svelte-10kswq8"> </h2> <!></div> <!></div>');function qt(n,t){je(t,!1);const e=N(),a=N();let m=fe(t,"sport",8,"volleyball"),R=fe(t,"matches",24,()=>[]),s=fe(t,"isAdmin",8,!1),k=fe(t,"onEditMatch",8,null);const S={volleyball:"バレーボール",table_tennis:"卓球",soccer:"サッカー"},Y={round_1:"1回戦",round_2:"2回戦",quarterfinal:"準々決勝",semifinal:"準決勝",final:"決勝",third_place:"3位決定戦"};function U(u){return Array.isArray(u)?u.reduce((M,P)=>{if(!P||typeof P!="object")return M;const b=P.round||"unknown";return M[b]||(M[b]=[]),M[b].push(P),M},{}):{}}function G(u){const M=Object.keys(u),P=["round_1","round_2","quarterfinal","semifinal","third_place","final"];return P.filter(b=>M.includes(b)).concat(M.filter(b=>!P.includes(b)))}function K(u){s()&&k()&&typeof k()=="function"&&k()(u)}function ee(u){if(u.winner)return u.winner;if(u.score1!==void 0&&u.score2!==void 0){if(u.score1>u.score2)return u.team1;if(u.score2>u.score1)return u.team2}return null}function te(u){return u.status==="completed"||u.score1!==void 0&&u.score2!==void 0?"completed":u.status==="in_progress"?"in_progress":"pending"}function le(){if(typeof window<"u"){const u=window.innerWidth;return u<768?"mobile":u<1024?"tablet":"desktop"}return"desktop"}let oe=N("desktop");typeof window<"u"&&(T(oe,le()),window.addEventListener("resize",()=>{T(oe,le())})),Z(()=>g(R()),()=>{T(e,U(R()))}),Z(()=>r(e),()=>{T(a,G(r(e)))}),Oe(),Ce();var z=Lt(),J=l(z),B=l(J),ue=l(B);c(B);var de=y(B,2);{var me=u=>{var M=Ct();_(u,M)};$(de,u=>{g(R()),v(()=>R().length===0)&&u(me)})}c(J);var re=y(J,2);{var ve=u=>{var M=Gt();$e(M,5,()=>r(a),ze,(P,b)=>{var se=xt(),V=l(se),ge=l(V,!0);c(V);var he=y(V,2);$e(he,5,()=>(r(e),r(b),v(()=>r(e)[r(b)])),ie=>ie.id,(ie,i)=>{var d=Pt(),h=l(d),I=l(h);It(I,{get match(){return r(i)},get editable(){return s()}});var L=y(I,2);{var D=p=>{var E=Dt(),F=l(E);c(E),O(W=>C(F,`勝者: ${W??""}`),[()=>(r(i),v(()=>ee(r(i))))]),_(p,E)};$(L,p=>{r(i),v(()=>ee(r(i)))&&p(D)})}var x=y(L,2);{var o=p=>{var E=Nt();X("click",E,()=>K(r(i))),_(p,E)};$(x,p=>{g(s()),r(i),v(()=>s()&&te(r(i))==="pending")&&p(o)})}c(h);var f=y(h,2);{var A=p=>{var E=Ut();_(p,E)};$(f,p=>{r(b)!=="final"&&r(b)!=="third_place"&&p(A)})}c(d),O(p=>ke(d,"data-status",p),[()=>(r(i),v(()=>te(r(i))))]),_(ie,d)}),c(he),c(se),O(()=>{ke(se,"data-round",r(b)),C(ge,(r(b),v(()=>Y[r(b)]||r(b))))}),_(P,se)}),c(M),_(u,M)};$(re,u=>{g(R()),v(()=>R().length>0)&&u(ve)})}c(z),O(()=>{pe(z,1,`tournament-bracket ${r(oe)??""}`,"svelte-10kswq8"),C(ue,`${g(m()),v(()=>S[m()]||m())??""} トーナメント`)}),_(n,z),Ie()}var Ht=w('<meta name="description" content="バレーボール、卓球、サッカーのトーナメント結果をリアルタイムで確認できます"/>'),Bt=w('<span class="last-updated svelte-srgitj"> </span>'),Ft=w('<button><span class="sport-icon svelte-srgitj"> </span> <span class="sport-name svelte-srgitj"> </span></button>'),zt=w('<div class="error-container svelte-srgitj"><div class="error-message svelte-srgitj"><h3 class="svelte-srgitj">エラーが発生しました</h3> <p class="svelte-srgitj"> </p> <button class="retry-button svelte-srgitj">再試行</button></div></div>'),Jt=w('<div class="loading-container svelte-srgitj"><!> <p class="loading-text svelte-srgitj">トーナメントデータを読み込み中...</p></div>'),Vt=w('<div class="tournament-container svelte-srgitj"><!></div>'),Wt=w('<div class="no-data-container svelte-srgitj"><div class="no-data-message svelte-srgitj"><h3 class="svelte-srgitj">トーナメントデータがありません</h3> <p class="svelte-srgitj"> </p> <button class="refresh-button svelte-srgitj">データを確認</button></div></div>'),Xt=w('<div class="homepage svelte-srgitj"><div class="container svelte-srgitj"><div class="page-header svelte-srgitj"><h1 class="page-title svelte-srgitj">トーナメント管理システム</h1> <p class="page-description svelte-srgitj">リアルタイムでトーナメントの進行状況を確認できます</p> <div class="header-actions svelte-srgitj"><button class="refresh-button svelte-srgitj" aria-label="データを更新"><span>🔄</span> 更新</button> <!></div></div> <div class="sports-tabs svelte-srgitj"><div class="tabs-container svelte-srgitj"></div></div> <div class="main-content svelte-srgitj"><!></div></div></div>');function or(n,t){je(t,!1);const[e,a]=nt(),m=()=>Ge(we,"$tournamentStore",e),R=()=>Ge(at,"$uiStore",e),s=N(),k=N(),S=N(),Y=N(),U=[{key:"volleyball",name:"バレーボール",icon:"🏐"},{key:"table_tennis",name:"卓球",icon:"🏓"},{key:"soccer",name:"サッカー",icon:"⚽"}];let G=null;Ke(async()=>{try{await we.initialize(),await ee(r(s).currentSport),le()}catch(i){console.error("Homepage initialization error:",i),H.showNotification("データの読み込みに失敗しました","error")}}),et(()=>{oe()});async function K(i){try{if(i===r(s).currentSport)return;const d=we.switchSport(i);d.success?await ee(i):H.showNotification(d.message||"スポーツの切り替えに失敗しました","error")}catch(d){console.error("Sport change error:",d),H.showNotification("スポーツの切り替えでエラーが発生しました","error")}}async function ee(i,d=!0){try{d&&H.setLoading(!0);const h=await we.fetchTournaments(i);return h.success||H.showNotification(h.message||"データの取得に失敗しました","error"),h}catch(h){return console.error("Load tournament data error:",h),H.showNotification("データの読み込みでエラーが発生しました","error"),{success:!1,message:h.message}}finally{d&&H.setLoading(!1)}}async function te(){try{H.setLoading(!0);const i=await we.refreshData(r(s).currentSport);i.success?H.showNotification("データを更新しました","success"):H.showNotification(i.message||"データの更新に失敗しました","error")}catch(i){console.error("Refresh error:",i),H.showNotification("データの更新でエラーが発生しました","error")}finally{H.setLoading(!1)}}function le(){oe(),G=setInterval(async()=>{if(!(typeof document<"u"&&document.hidden)&&!(r(s).loading||r(k).loading))try{await ee(r(s).currentSport,!1)}catch(i){console.error("Polling update error:",i)}},3e4)}function oe(){G&&(clearInterval(G),G=null)}function z(i){const d=U.find(h=>h.key===i);return d?d.name:i}function J(){typeof document<"u"&&(document.hidden||ee(r(s).currentSport,!1))}typeof document<"u"&&document.addEventListener("visibilitychange",J),Z(()=>m(),()=>{T(s,m())}),Z(()=>R(),()=>{T(k,R())}),Z(()=>r(s),()=>{T(S,r(s).tournaments[r(s).currentSport]||null)}),Z(()=>r(S),()=>{T(Y,r(S)?.matches||[])}),Oe(),Ce();var B=Xt();tt(i=>{var d=Ht();O(h=>rt.title=`トーナメント管理システム - ${h??""}`,[()=>(r(s),v(()=>z(r(s).currentSport)))]),_(i,d)});var ue=l(B),de=l(ue),me=y(l(de),4),re=l(me),ve=l(re);let u;Ue(),c(re);var M=y(re,2);{var P=i=>{var d=Bt(),h=l(d);c(d),O(I=>C(h,`最終更新: ${I??""}`),[()=>(r(s),v(()=>new Date(r(s).lastUpdated).toLocaleTimeString("ja-JP")))]),_(i,d)};$(M,i=>{r(s),v(()=>r(s).lastUpdated)&&i(P)})}c(me),c(de);var b=y(de,2),se=l(b);$e(se,5,()=>U,ze,(i,d)=>{var h=Ft();let I;var L=l(h),D=l(L,!0);c(L);var x=y(L,2),o=l(x,!0);c(x),c(h),O(f=>{I=pe(h,1,"sport-tab svelte-srgitj",null,I,f),h.disabled=(r(s),v(()=>r(s).loading)),ke(h,"aria-label",`${r(d),v(()=>r(d).name)??""}のトーナメントを表示`),C(D,(r(d),v(()=>r(d).icon))),C(o,(r(d),v(()=>r(d).name)))},[()=>({active:r(s).currentSport===r(d).key})]),X("click",h,()=>K(r(d).key)),_(i,h)}),c(se),c(b);var V=y(b,2),ge=l(V);{var he=i=>{var d=zt(),h=l(d),I=y(l(h),2),L=l(I,!0);c(I);var D=y(I,2);c(h),c(d),O(()=>C(L,(r(s),v(()=>r(s).error)))),X("click",D,te),_(i,d)},ie=i=>{var d=Pe(),h=Se(d);{var I=D=>{var x=Jt(),o=l(x);st(o,{size:"large"}),Ue(2),c(x),_(D,x)},L=D=>{var x=Pe(),o=Se(x);{var f=p=>{var E=Vt(),F=l(E);qt(F,{get sport(){return r(s),v(()=>r(s).currentSport)},get matches(){return r(Y)},isAdmin:!1}),c(E),_(p,E)},A=p=>{var E=Wt(),F=l(E),W=y(l(F),2),_e=l(W);c(W);var j=y(W,2);c(F),c(E),O(q=>C(_e,`${q??""}のトーナメントはまだ開始されていません。`),[()=>(r(s),v(()=>z(r(s).currentSport)))]),X("click",j,te),_(p,E)};$(o,p=>{r(S),r(Y),v(()=>r(S)&&r(Y).length>0)?p(f):p(A,!1)},!0)}_(D,x)};$(h,D=>{r(s),r(S),v(()=>r(s).loading&&!r(S))?D(I):D(L,!1)},!0)}_(i,d)};$(ge,i=>{r(s),v(()=>r(s).error)?i(he):i(ie,!1)})}c(V),c(ue),c(B),O(i=>{re.disabled=(r(s),r(k),v(()=>r(s).loading||r(k).loading)),u=pe(ve,1,"refresh-icon svelte-srgitj",null,u,i)},[()=>({spinning:r(s).loading||r(k).loading})]),X("click",re,te),_(n,B),Ie(),a()}export{or as component};
