import"../chunks/DsnmJJEf.js";import"../chunks/CemgtdTq.js";import{w as et,g as ce,c as tt,s as C,e as Q,o as rt,b as st}from"../chunks/CAxiFA8R.js";import{a_ as at,I as we,a9 as nt,y as ot,u as f,r as it,a$ as ct,p as Ce,Q as N,aH as X,R as T,h as g,g as s,aI as De,k as y,s as l,w as E,v as c,t as O,m as w,o as Ne,n as be,l as lt,$ as ut,aK as Ge,aa as Le}from"../chunks/DZk1ynsy.js";import{p as fe,i as k,s as dt,a as qe}from"../chunks/uc740CFE.js";import{a as Je,s as pe,d as Ae,r as He,e as Oe,b as Ie,i as Qe,u as H,c as vt,L as ft}from"../chunks/BSPZMg3t.js";import{i as Ue}from"../chunks/ButnKw6t.js";function Be(r,t,e=t){var n=new WeakSet;at(r,"input",async v=>{var h=v?r.defaultValue:r.value;if(h=ke(r)?je(h):h,e(h),we!==null&&n.add(we),await nt(),h!==(h=t())){var a=r.selectionStart,$=r.selectionEnd;r.value=h??"",$!==null&&(r.selectionStart=a,r.selectionEnd=Math.min($,r.value.length))}}),(ot&&r.defaultValue!==r.value||f(t)==null&&r.value)&&(e(ke(r)?je(r.value):r.value),we!==null&&n.add(we)),it(()=>{var v=t();if(r===document.activeElement){var h=ct??we;if(n.has(h))return}ke(r)&&v===je(r.value)||r.type==="date"&&!v&&!r.value||v!==r.value&&(r.value=v??"")})}function ke(r){var t=r.type;return t==="number"||t==="range"}function je(r){return r===""?null:+r}class mt{constructor(t=Je){this.client=t,this.supportedSports=["volleyball","table_tennis","soccer"]}validateSport(t){if(!t)throw new Error("スポーツ名が指定されていません");if(!this.supportedSports.includes(t))throw new Error(`サポートされていないスポーツです: ${t}`);return!0}async getTournaments(){try{const t=await this.client.get("/tournaments");return t.success?{success:!0,data:t.data,message:"トーナメント一覧を取得しました"}:t}catch(t){return console.error("Get tournaments error:",t),{success:!1,error:"GET_TOURNAMENTS_ERROR",message:"トーナメント一覧の取得に失敗しました",details:t.message}}}async getTournament(t){try{this.validateSport(t);const e=await this.client.get(`/tournaments/${t}`);return e.success?{success:!0,data:e.data,message:`${t}のトーナメント情報を取得しました`}:e}catch(e){return console.error("Get tournament error:",e),{success:!1,error:"GET_TOURNAMENT_ERROR",message:"トーナメント情報の取得に失敗しました",details:e.message}}}async getTournamentBracket(t){try{this.validateSport(t);const e=await this.client.get(`/tournaments/${t}/bracket`);return e.success?{success:!0,data:e.data,message:`${t}のブラケット情報を取得しました`}:e}catch(e){return console.error("Get tournament bracket error:",e),{success:!1,error:"GET_BRACKET_ERROR",message:"ブラケット情報の取得に失敗しました",details:e.message}}}async updateTournamentFormat(t,e){try{if(this.validateSport(t),!e)throw new Error("形式が指定されていません");const n=await this.client.put(`/tournaments/${t}/format`,{format:e});return n.success?{success:!0,data:n.data,message:`${t}のトーナメント形式を${e}に更新しました`}:n}catch(n){return console.error("Update tournament format error:",n),{success:!1,error:"UPDATE_FORMAT_ERROR",message:"トーナメント形式の更新に失敗しました",details:n.message}}}async createTournament(t){try{const{sport:e,format:n,teams:v}=t;if(this.validateSport(e),!n)throw new Error("トーナメント形式が指定されていません");if(!v||!Array.isArray(v)||v.length===0)throw new Error("参加チーム情報が正しくありません");const h=await this.client.post("/tournaments",{sport:e,format:n,teams:v});return h.success?{success:!0,data:h.data,message:`${e}のトーナメントを作成しました`}:h}catch(e){return console.error("Create tournament error:",e),{success:!1,error:"CREATE_TOURNAMENT_ERROR",message:"トーナメントの作成に失敗しました",details:e.message}}}async deleteTournament(t){try{this.validateSport(t);const e=await this.client.delete(`/tournaments/${t}`);return e.success?{success:!0,data:e.data,message:`${t}のトーナメントを削除しました`}:e}catch(e){return console.error("Delete tournament error:",e),{success:!1,error:"DELETE_TOURNAMENT_ERROR",message:"トーナメントの削除に失敗しました",details:e.message}}}async updateTournamentStatus(t,e){try{if(this.validateSport(t),!["pending","active","completed","cancelled"].includes(e))throw new Error(`無効なステータスです: ${e}`);const v=await this.client.patch(`/tournaments/${t}/status`,{status:e});return v.success?{success:!0,data:v.data,message:`${t}のトーナメント状態を${e}に更新しました`}:v}catch(n){return console.error("Update tournament status error:",n),{success:!1,error:"UPDATE_STATUS_ERROR",message:"トーナメント状態の更新に失敗しました",details:n.message}}}async getTournamentStats(t){try{this.validateSport(t);const e=await this.client.get(`/tournaments/${t}/stats`);return e.success?{success:!0,data:e.data,message:`${t}の統計情報を取得しました`}:e}catch(e){return console.error("Get tournament stats error:",e),{success:!1,error:"GET_STATS_ERROR",message:"統計情報の取得に失敗しました",details:e.message}}}async getAvailableFormats(t){try{this.validateSport(t);const e=await this.client.get(`/tournaments/${t}/formats`);return e.success?{success:!0,data:e.data,message:`${t}の利用可能な形式一覧を取得しました`}:e}catch(e){return console.error("Get available formats error:",e),{success:!1,error:"GET_FORMATS_ERROR",message:"形式一覧の取得に失敗しました",details:e.message}}}getSupportedSports(){return{success:!0,data:this.supportedSports,message:"サポートされているスポーツ一覧"}}}const Fe=new mt;class gt{constructor(t=Je){this.client=t,this.supportedSports=["volleyball","table_tennis","soccer"],this.validStatuses=["pending","in_progress","completed","cancelled"]}validateSport(t){if(!t)throw new Error("スポーツ名が指定されていません");if(!this.supportedSports.includes(t))throw new Error(`サポートされていないスポーツです: ${t}`);return!0}validateMatchId(t){if(!t)throw new Error("試合IDが指定されていません");if(typeof t!="number"&&typeof t!="string")throw new Error("試合IDの形式が正しくありません");return!0}validateMatchResult(t){if(!t||typeof t!="object")throw new Error("試合結果データが正しくありません");const{score1:e,score2:n,winner:v}=t;if(e!==void 0&&(typeof e!="number"||e<0))throw new Error("チーム1のスコアが正しくありません");if(n!==void 0&&(typeof n!="number"||n<0))throw new Error("チーム2のスコアが正しくありません");if(e!==void 0&&n!==void 0&&v!==void 0&&(typeof v!="string"||v.trim()===""))throw new Error("勝者の情報が正しくありません");return!0}async getMatches(t,e={}){try{this.validateSport(t);const n=new URLSearchParams;e.status&&n.append("status",e.status),e.round&&n.append("round",e.round),e.limit&&n.append("limit",e.limit.toString()),e.offset&&n.append("offset",e.offset.toString());const v=n.toString(),h=`/matches/${t}${v?`?${v}`:""}`,a=await this.client.get(h);return a.success?{success:!0,data:a.data,message:`${t}の試合一覧を取得しました`}:a}catch(n){return console.error("Get matches error:",n),{success:!1,error:"GET_MATCHES_ERROR",message:"試合一覧の取得に失敗しました",details:n.message}}}async getMatch(t){try{this.validateMatchId(t);const e=await this.client.get(`/matches/${t}`);return e.success?{success:!0,data:e.data,message:"試合詳細を取得しました"}:e}catch(e){return console.error("Get match error:",e),{success:!1,error:"GET_MATCH_ERROR",message:"試合詳細の取得に失敗しました",details:e.message}}}async updateMatch(t,e){try{this.validateMatchId(t),this.validateMatchResult(e);const n=await this.client.put(`/matches/${t}`,e);return n.success?{success:!0,data:n.data,message:"試合結果を更新しました"}:n}catch(n){return console.error("Update match error:",n),{success:!1,error:"UPDATE_MATCH_ERROR",message:"試合結果の更新に失敗しました",details:n.message}}}async createMatch(t){try{if(!t||typeof t!="object")throw new Error("試合データが正しくありません");const{sport:e,tournament_id:n,round:v,team1:h,team2:a,scheduled_at:$}=t;if(!e)throw new Error("スポーツが指定されていません");if(this.validateSport(e),!n)throw new Error("トーナメントIDが指定されていません");if(!v)throw new Error("ラウンドが指定されていません");if(!h||!a)throw new Error("対戦チームが正しく指定されていません");if(h===a)throw new Error("同じチーム同士の試合は作成できません");const b=await this.client.post("/matches",t);return b.success?{success:!0,data:b.data,message:"新しい試合を作成しました"}:b}catch(e){return console.error("Create match error:",e),{success:!1,error:"CREATE_MATCH_ERROR",message:"試合の作成に失敗しました",details:e.message}}}async deleteMatch(t){try{this.validateMatchId(t);const e=await this.client.delete(`/matches/${t}`);return e.success?{success:!0,data:e.data,message:"試合を削除しました"}:e}catch(e){return console.error("Delete match error:",e),{success:!1,error:"DELETE_MATCH_ERROR",message:"試合の削除に失敗しました",details:e.message}}}async updateMatchStatus(t,e){try{if(this.validateMatchId(t),!this.validStatuses.includes(e))throw new Error(`無効なステータスです: ${e}`);const n=await this.client.patch(`/matches/${t}/status`,{status:e});return n.success?{success:!0,data:n.data,message:`試合状態を${e}に更新しました`}:n}catch(n){return console.error("Update match status error:",n),{success:!1,error:"UPDATE_MATCH_STATUS_ERROR",message:"試合状態の更新に失敗しました",details:n.message}}}async getPendingMatches(t){try{this.validateSport(t);const e=await this.client.get(`/matches/${t}/pending`);return e.success?{success:!0,data:e.data,message:`${t}の未完了試合一覧を取得しました`}:e}catch(e){return console.error("Get pending matches error:",e),{success:!1,error:"GET_PENDING_MATCHES_ERROR",message:"未完了試合一覧の取得に失敗しました",details:e.message}}}async updateMultipleMatches(t){try{if(!Array.isArray(t)||t.length===0)throw new Error("更新データが正しくありません");for(const n of t){if(!n.matchId)throw new Error("試合IDが指定されていない更新データがあります");this.validateMatchId(n.matchId),this.validateMatchResult(n.result)}const e=await this.client.put("/matches/batch",{updates:t});return e.success?{success:!0,data:e.data,message:`${t.length}件の試合結果を更新しました`}:e}catch(e){return console.error("Update multiple matches error:",e),{success:!1,error:"UPDATE_MULTIPLE_MATCHES_ERROR",message:"試合結果の一括更新に失敗しました",details:e.message}}}async getMatchStats(t){try{this.validateMatchId(t);const e=await this.client.get(`/matches/${t}/stats`);return e.success?{success:!0,data:e.data,message:"試合統計情報を取得しました"}:e}catch(e){return console.error("Get match stats error:",e),{success:!1,error:"GET_MATCH_STATS_ERROR",message:"試合統計情報の取得に失敗しました",details:e.message}}}async getNextMatch(t){try{this.validateSport(t);const e=await this.client.get(`/matches/${t}/next`);return e.success?{success:!0,data:e.data,message:`${t}の次の試合情報を取得しました`}:e}catch(e){return console.error("Get next match error:",e),{success:!1,error:"GET_NEXT_MATCH_ERROR",message:"次の試合情報の取得に失敗しました",details:e.message}}}getSupportedSports(){return{success:!0,data:this.supportedSports,message:"サポートされているスポーツ一覧"}}getValidStatuses(){return{success:!0,data:this.validStatuses,message:"有効なステータス一覧"}}}const ht=new gt,Xe={tournaments:{},currentSport:"volleyball",loading:!1,error:null,lastUpdated:null,cache:{},pollingInterval:null},{subscribe:ne,set:pt,update:Z}=et(Xe),_t=300*1e3,wt=30*1e3,Ze=["volleyball","table_tennis","soccer"];function Re(r){Z(t=>({...t,loading:r}))}function ae(r){Z(t=>({...t,error:r,loading:!1}))}function Te(){Z(r=>({...r,error:null}))}function Pe(r){if(!r)throw new Error("スポーツ名が指定されていません");if(!Ze.includes(r))throw new Error(`サポートされていないスポーツです: ${r}`);return!0}function yt(r){const e=ce({subscribe:ne}).cache[r];return!e||!e.timestamp?!1:Date.now()-e.timestamp<_t}function Et(r){const e=ce({subscribe:ne}).cache[r];return e&&yt(r)?e.data:null}function ze(r,t){Z(e=>({...e,cache:{...e.cache,[r]:{data:t,timestamp:Date.now()}}}))}async function Ee(r=null,t=!0){try{if(Te(),r){if(Pe(r),t){const n=Et(r);if(n)return Z(v=>({...v,tournaments:{...v.tournaments,[r]:n}})),{success:!0,data:n,message:`${r}のトーナメントデータを取得しました（キャッシュ）`}}Re(!0);const e=await Fe.getTournament(r);return e.success?(Z(n=>({...n,tournaments:{...n.tournaments,[r]:e.data},loading:!1,lastUpdated:Date.now()})),ze(r,e.data),e):(ae(e.message||"トーナメントデータの取得に失敗しました"),e)}else{Re(!0);const e=await Fe.getTournaments();return e.success?(Z(n=>({...n,tournaments:e.data,loading:!1,lastUpdated:Date.now()})),e.data&&typeof e.data=="object"&&Object.keys(e.data).forEach(n=>{ze(n,e.data[n])}),e):(ae(e.message||"トーナメントデータの取得に失敗しました"),e)}}catch(e){return console.error("Fetch tournaments error:",e),ae(e.message||"予期しないエラーが発生しました"),{success:!1,error:"FETCH_TOURNAMENTS_ERROR",message:e.message||"トーナメントデータの取得に失敗しました"}}}async function St(r,t){try{if(Te(),!r)throw new Error("試合IDが指定されていません");if(!t||typeof t!="object")throw new Error("試合結果データが正しくありません");Re(!0);const e=await ht.updateMatch(r,t);if(e.success){const v=ce({subscribe:ne}).currentSport;return await Ee(v,!1),{success:!0,data:e.data,message:"試合結果を更新しました"}}else return ae(e.message||"試合結果の更新に失敗しました"),e}catch(e){return console.error("Update match error:",e),ae(e.message||"予期しないエラーが発生しました"),{success:!1,error:"UPDATE_MATCH_ERROR",message:e.message||"試合結果の更新に失敗しました"}}}function bt(r){try{return Pe(r),Z(t=>({...t,currentSport:r,error:null})),Ee(r),{success:!0,message:`スポーツを${r}に切り替えました`}}catch(t){return console.error("Switch sport error:",t),ae(t.message||"スポーツの切り替えに失敗しました"),{success:!1,error:"SWITCH_SPORT_ERROR",message:t.message||"スポーツの切り替えに失敗しました"}}}async function xe(r=null){try{Te();const t=ce({subscribe:ne}),e=r||t.currentSport,n=await Ee(e,!1);return{success:!0,message:"データを更新しました"}}catch(t){return console.error("Refresh data error:",t),ae(t.message||"データの更新に失敗しました"),{success:!1,error:"REFRESH_DATA_ERROR",message:t.message||"データの更新に失敗しました"}}}function Ye(){if(ce({subscribe:ne}).pollingInterval)return;const t=setInterval(async()=>{if(!(typeof document<"u"&&document.hidden||ce({subscribe:ne}).loading))try{await xe()}catch(n){console.error("Polling error:",n)}},wt);Z(e=>({...e,pollingInterval:t}))}function Ke(){Z(r=>(r.pollingInterval&&clearInterval(r.pollingInterval),{...r,pollingInterval:null}))}async function Rt(){try{return await Ee(),Ye(),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden||xe()}),{success:!0,message:"トーナメントストアを初期化しました"}}catch(r){return console.error("Initialize tournament store error:",r),ae(r.message||"初期化に失敗しました"),{success:!1,error:"INITIALIZE_ERROR",message:r.message||"初期化に失敗しました"}}}function Tt(){return Ke(),pt(Xe),{success:!0,message:"トーナメントストアをクリーンアップしました"}}function Mt(){const r=ce({subscribe:ne});return r.tournaments[r.currentSport]||null}function $t(r){return Pe(r),ce({subscribe:ne}).tournaments[r]||null}function At(){return[...Ze]}const ye={subscribe:ne,fetchTournaments:Ee,updateMatch:St,switchSport:bt,refreshData:xe,initialize:Rt,cleanup:Tt,startPolling:Ye,stopPolling:Ke,getCurrentTournament:Mt,getTournamentBySport:$t,getSupportedSports:At,setLoading:Re,setError:ae,clearError:Te};function Ve(r){return{pending:"未実施",in_progress:"進行中",completed:"完了",cancelled:"キャンセル"}[r]||r}function We(r,t){return r==null||t===null||t===void 0?"未実施":`${r} - ${t}`}function Se(r,t=10){return r?r.length<=t?r:r.substring(0,t-3)+"...":""}var kt=y('<div class="round svelte-l0munw" data-testid="match-round"> </div>'),jt=y('<div class="schedule svelte-l0munw" data-testid="match-schedule"> </div>'),Ot=y('<span class="winner-badge svelte-l0munw">🏆</span>'),It=y('<span class="winner-badge svelte-l0munw">🏆</span>'),Ct=y('<div class="score-edit svelte-l0munw" data-testid="score-edit"><input type="number" min="0" class="score-input svelte-l0munw" data-testid="score1-input" placeholder="0"/> <span class="score-separator svelte-l0munw">-</span> <input type="number" min="0" class="score-input svelte-l0munw" data-testid="score2-input" placeholder="0"/></div> <div class="edit-actions svelte-l0munw"><button class="btn btn-primary btn-sm svelte-l0munw" data-testid="save-score-btn">保存</button> <button class="btn btn-secondary btn-sm svelte-l0munw" data-testid="cancel-edit-btn">キャンセル</button></div>',1),Dt=y('<div class="score svelte-l0munw"> </div>'),Nt=y('<div class="status svelte-l0munw" data-testid="match-status"> </div>'),Ut=y('<button class="edit-btn svelte-l0munw" data-testid="edit-match-btn" aria-label="試合結果を編集">✏️ 編集</button>'),Pt=y('<div class="score-display svelte-l0munw" data-testid="score-display"><!></div> <!>',1),xt=y('<div class="match-details svelte-l0munw"><div class="completion-time svelte-l0munw" data-testid="completion-time"> </div></div>'),Gt=y('<div data-testid="match-card"><div class="match-header svelte-l0munw"><!> <!></div> <div class="teams svelte-l0munw"><div data-testid="team1"><span class="team-name svelte-l0munw"> </span> <!></div> <div class="vs-section svelte-l0munw"><span class="vs svelte-l0munw">vs</span></div> <div data-testid="team2"><!> <span class="team-name svelte-l0munw"> </span></div></div> <div class="score-section svelte-l0munw"><!></div> <!></div>');function Lt(r,t){Ce(t,!1);const e=N(),n=N(),v=N(),h=N();let a=fe(t,"match",24,()=>({})),$=fe(t,"editable",8,!1),b=fe(t,"compact",8,!1);const Y=tt();let U=N(!1),G=N(a().score1||""),K=N(a().score2||"");function ee(){$()&&(T(U,!s(U)),s(U)&&(T(G,a().score1||""),T(K,a().score2||"")))}function te(){const o=parseInt(s(G)),m=parseInt(s(K));if(isNaN(o)||isNaN(m)||o<0||m<0){Y("error",{message:"スコアは0以上の数値を入力してください"});return}Y("updateScore",{matchId:a().id,score1:o,score2:m}),T(U,!1)}function le(){T(U,!1),T(G,a().score1||""),T(K,a().score2||"")}function oe(o){return o.winner?o.winner:o.score1!==null&&o.score2!==null&&o.score1!==void 0&&o.score2!==void 0?o.score1>o.score2?o.team1:o.score2>o.score1?o.team2:"draw":null}function z(o){o.key==="Enter"?te():o.key==="Escape"&&le()}X(()=>g(a()),()=>{T(e,oe(a()))}),X(()=>(g(b()),g($()),s(U)),()=>{T(n,["match-card",b()?"compact":"",$()?"editable":"",s(U)?"edit-mode":""].filter(Boolean).join(" "))}),X(()=>(s(e),g(a())),()=>{T(v,["team",s(e)===a().team1?"winner":""].filter(Boolean).join(" "))}),X(()=>(s(e),g(a())),()=>{T(h,["team",s(e)===a().team2?"winner":""].filter(Boolean).join(" "))}),De(),Ue();var V=Gt(),B=l(V),ue=l(B);{var de=o=>{var m=kt(),A=l(m,!0);c(m),O(()=>C(A,(g(a()),f(()=>a().round)))),w(o,m)};k(ue,o=>{g(a()),f(()=>a().round)&&o(de)})}var me=E(ue,2);{var re=o=>{var m=jt(),A=l(m,!0);c(m),O(_=>C(A,_),[()=>(g(a()),f(()=>new Date(a().scheduled_at).toLocaleDateString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})))]),w(o,m)};k(me,o=>{g(a()),f(()=>a().scheduled_at)&&o(re)})}c(B);var ve=E(B,2),u=l(ve),M=l(u),P=l(M,!0);c(M);var R=E(M,2);{var se=o=>{var m=Ot();w(o,m)};k(R,o=>{s(e),g(a()),f(()=>s(e)===a().team1)&&o(se)})}c(u);var W=E(u,4),ge=l(W);{var he=o=>{var m=It();w(o,m)};k(ge,o=>{s(e),g(a()),f(()=>s(e)===a().team2)&&o(he)})}var ie=E(ge,2),i=l(ie,!0);c(ie),c(W),c(ve);var d=E(ve,2),p=l(d);{var I=o=>{var m=Ct(),A=be(m),_=l(A);He(_);var S=E(_,4);He(S),c(A);var F=E(A,2),J=l(F),_e=E(J,2);c(F),Be(_,()=>s(G),j=>T(G,j)),Q("keydown",_,z),Be(S,()=>s(K),j=>T(K,j)),Q("keydown",S,z),Q("click",J,te),Q("click",_e,le),w(o,m)},L=o=>{var m=Pt(),A=be(m),_=l(A);{var S=j=>{var q=Dt(),Me=l(q,!0);c(q),O($e=>C(Me,$e),[()=>(g(We),g(a()),f(()=>We(a().score1,a().score2)))]),w(j,q)},F=j=>{var q=Nt(),Me=l(q,!0);c(q),O($e=>C(Me,$e),[()=>(g(Ve),g(a()),f(()=>Ve(a().status||"pending")))]),w(j,q)};k(_,j=>{g(a()),f(()=>a().score1!==null&&a().score1!==void 0&&a().score2!==null&&a().score2!==void 0)?j(S):j(F,!1)})}c(A);var J=E(A,2);{var _e=j=>{var q=Ut();Q("click",q,ee),w(j,q)};k(J,j=>{g($()),g(a()),f(()=>$()&&a().status!=="completed")&&j(_e)})}w(o,m)};k(p,o=>{s(U)?o(I):o(L,!1)})}c(d);var D=E(d,2);{var x=o=>{var m=xt(),A=l(m),_=l(A);c(A),c(m),O(S=>C(_,`完了: ${S??""}`),[()=>(g(a()),f(()=>new Date(a().completed_at).toLocaleDateString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})))]),w(o,m)};k(D,o=>{g(b()),g(a()),f(()=>!b()&&(a().completed_at||a().status==="completed"))&&o(x)})}c(V),O((o,m)=>{pe(V,1,Ae(s(n)),"svelte-l0munw"),pe(u,1,Ae(s(v)),"svelte-l0munw"),C(P,o),pe(W,1,Ae(s(h)),"svelte-l0munw"),C(i,m)},[()=>(g(Se),g(a()),g(b()),f(()=>Se(a().team1||"Team A",b()?8:15))),()=>(g(Se),g(a()),g(b()),f(()=>Se(a().team2||"Team B",b()?8:15)))]),w(r,V),Ne()}var qt=y('<p class="no-matches svelte-10kswq8">試合データがありません</p>'),Ht=y('<div class="winner-indicator svelte-10kswq8"> </div>'),Bt=y('<button class="edit-button svelte-10kswq8" aria-label="試合結果を編集">結果入力</button>'),Ft=y('<div class="connection-line svelte-10kswq8" aria-hidden="true"></div>'),zt=y('<div class="match-wrapper svelte-10kswq8"><div class="match-card-container svelte-10kswq8"><!> <!> <!></div> <!></div>'),Vt=y('<div class="round-column svelte-10kswq8"><h3 class="round-title svelte-10kswq8"> </h3> <div class="matches-container svelte-10kswq8"></div></div>'),Wt=y('<div class="bracket-container svelte-10kswq8"></div>'),Jt=y('<div><div class="bracket-header svelte-10kswq8"><h2 class="tournament-title svelte-10kswq8"> </h2> <!></div> <!></div>');function Qt(r,t){Ce(t,!1);const e=N(),n=N();let v=fe(t,"sport",8,"volleyball"),h=fe(t,"matches",24,()=>[]),a=fe(t,"isAdmin",8,!1),$=fe(t,"onEditMatch",8,null);const b={volleyball:"バレーボール",table_tennis:"卓球",soccer:"サッカー"},Y={round_1:"1回戦",round_2:"2回戦",quarterfinal:"準々決勝",semifinal:"準決勝",final:"決勝",third_place:"3位決定戦"};function U(u){return Array.isArray(u)?u.reduce((M,P)=>{if(!P||typeof P!="object")return M;const R=P.round||"unknown";return M[R]||(M[R]=[]),M[R].push(P),M},{}):{}}function G(u){const M=Object.keys(u),P=["round_1","round_2","quarterfinal","semifinal","third_place","final"];return P.filter(R=>M.includes(R)).concat(M.filter(R=>!P.includes(R)))}function K(u){a()&&$()&&typeof $()=="function"&&$()(u)}function ee(u){if(u.winner)return u.winner;if(u.score1!==void 0&&u.score2!==void 0){if(u.score1>u.score2)return u.team1;if(u.score2>u.score1)return u.team2}return null}function te(u){return u.status==="completed"||u.score1!==void 0&&u.score2!==void 0?"completed":u.status==="in_progress"?"in_progress":"pending"}function le(){if(typeof window<"u"){const u=window.innerWidth;return u<768?"mobile":u<1024?"tablet":"desktop"}return"desktop"}let oe=N("desktop");typeof window<"u"&&(T(oe,le()),window.addEventListener("resize",()=>{T(oe,le())})),X(()=>g(h()),()=>{T(e,U(h()))}),X(()=>s(e),()=>{T(n,G(s(e)))}),De(),Ue();var z=Jt(),V=l(z),B=l(V),ue=l(B);c(B);var de=E(B,2);{var me=u=>{var M=qt();w(u,M)};k(de,u=>{g(h()),f(()=>h().length===0)&&u(me)})}c(V);var re=E(V,2);{var ve=u=>{var M=Wt();Oe(M,5,()=>s(n),Qe,(P,R)=>{var se=Vt(),W=l(se),ge=l(W,!0);c(W);var he=E(W,2);Oe(he,5,()=>(s(e),s(R),f(()=>s(e)[s(R)])),ie=>ie.id,(ie,i)=>{var d=zt(),p=l(d),I=l(p);Lt(I,{get match(){return s(i)},get editable(){return a()}});var L=E(I,2);{var D=_=>{var S=Ht(),F=l(S);c(S),O(J=>C(F,`勝者: ${J??""}`),[()=>(s(i),f(()=>ee(s(i))))]),w(_,S)};k(L,_=>{s(i),f(()=>ee(s(i)))&&_(D)})}var x=E(L,2);{var o=_=>{var S=Bt();Q("click",S,()=>K(s(i))),w(_,S)};k(x,_=>{g(a()),s(i),f(()=>a()&&te(s(i))==="pending")&&_(o)})}c(p);var m=E(p,2);{var A=_=>{var S=Ft();w(_,S)};k(m,_=>{s(R)!=="final"&&s(R)!=="third_place"&&_(A)})}c(d),O(_=>Ie(d,"data-status",_),[()=>(s(i),f(()=>te(s(i))))]),w(ie,d)}),c(he),c(se),O(()=>{Ie(se,"data-round",s(R)),C(ge,(s(R),f(()=>Y[s(R)]||s(R))))}),w(P,se)}),c(M),w(u,M)};k(re,u=>{g(h()),f(()=>h().length>0)&&u(ve)})}c(z),O(()=>{pe(z,1,`tournament-bracket ${s(oe)??""}`,"svelte-10kswq8"),C(ue,`${g(v()),f(()=>b[v()]||v())??""} トーナメント`)}),w(r,z),Ne()}var Xt=y('<meta name="description" content="バレーボール、卓球、サッカーのトーナメント結果をリアルタイムで確認できます"/>'),Zt=y('<span class="last-updated svelte-srgitj"> </span>'),Yt=y('<button><span class="sport-icon svelte-srgitj"> </span> <span class="sport-name svelte-srgitj"> </span></button>'),Kt=y('<div class="error-container svelte-srgitj"><div class="error-message svelte-srgitj"><h3 class="svelte-srgitj">エラーが発生しました</h3> <p class="svelte-srgitj"> </p> <button class="retry-button svelte-srgitj">再試行</button></div></div>'),er=y('<div class="loading-container svelte-srgitj"><!> <p class="loading-text svelte-srgitj">トーナメントデータを読み込み中...</p></div>'),tr=y('<div class="tournament-container svelte-srgitj"><!></div>'),rr=y('<div class="no-data-container svelte-srgitj"><div class="no-data-message svelte-srgitj"><h3 class="svelte-srgitj">トーナメントデータがありません</h3> <p class="svelte-srgitj"> </p> <button class="refresh-button svelte-srgitj">データを確認</button></div></div>'),sr=y('<div class="homepage svelte-srgitj"><div class="container svelte-srgitj"><div class="page-header svelte-srgitj"><h1 class="page-title svelte-srgitj">トーナメント管理システム</h1> <p class="page-description svelte-srgitj">リアルタイムでトーナメントの進行状況を確認できます</p> <div class="header-actions svelte-srgitj"><button class="refresh-button svelte-srgitj" aria-label="データを更新"><span>🔄</span> 更新</button> <!></div></div> <div class="sports-tabs svelte-srgitj"><div class="tabs-container svelte-srgitj"></div></div> <div class="main-content svelte-srgitj"><!></div></div></div>');function dr(r,t){Ce(t,!1);const[e,n]=dt(),v=()=>qe(ye,"$tournamentStore",e),h=()=>qe(vt,"$uiStore",e),a=N(),$=N(),b=N(),Y=N(),U=[{key:"volleyball",name:"バレーボール",icon:"🏐"},{key:"table_tennis",name:"卓球",icon:"🏓"},{key:"soccer",name:"サッカー",icon:"⚽"}];let G=null;rt(async()=>{try{await ye.initialize(),await ee(s(a).currentSport),le()}catch(i){console.error("Homepage initialization error:",i),H.showNotification("データの読み込みに失敗しました","error")}}),st(()=>{oe()});async function K(i){try{if(i===s(a).currentSport)return;const d=ye.switchSport(i);d.success?await ee(i):H.showNotification(d.message||"スポーツの切り替えに失敗しました","error")}catch(d){console.error("Sport change error:",d),H.showNotification("スポーツの切り替えでエラーが発生しました","error")}}async function ee(i,d=!0){try{d&&H.setLoading(!0);const p=await ye.fetchTournaments(i);return p.success||H.showNotification(p.message||"データの取得に失敗しました","error"),p}catch(p){return console.error("Load tournament data error:",p),H.showNotification("データの読み込みでエラーが発生しました","error"),{success:!1,message:p.message}}finally{d&&H.setLoading(!1)}}async function te(){try{H.setLoading(!0);const i=await ye.refreshData(s(a).currentSport);i.success?H.showNotification("データを更新しました","success"):H.showNotification(i.message||"データの更新に失敗しました","error")}catch(i){console.error("Refresh error:",i),H.showNotification("データの更新でエラーが発生しました","error")}finally{H.setLoading(!1)}}function le(){oe(),G=setInterval(async()=>{if(!(typeof document<"u"&&document.hidden)&&!(s(a).loading||s($).loading))try{await ee(s(a).currentSport,!1)}catch(i){console.error("Polling update error:",i)}},3e4)}function oe(){G&&(clearInterval(G),G=null)}function z(i){const d=U.find(p=>p.key===i);return d?d.name:i}function V(){typeof document<"u"&&(document.hidden||ee(s(a).currentSport,!1))}typeof document<"u"&&document.addEventListener("visibilitychange",V),X(()=>v(),()=>{T(a,v())}),X(()=>h(),()=>{T($,h())}),X(()=>s(a),()=>{T(b,s(a).tournaments[s(a).currentSport]||null)}),X(()=>s(b),()=>{T(Y,s(b)?.matches||[])}),De(),Ue();var B=sr();lt(i=>{var d=Xt();O(p=>ut.title=`トーナメント管理システム - ${p??""}`,[()=>(s(a),f(()=>z(s(a).currentSport)))]),w(i,d)});var ue=l(B),de=l(ue),me=E(l(de),4),re=l(me),ve=l(re);let u;Ge(),c(re);var M=E(re,2);{var P=i=>{var d=Zt(),p=l(d);c(d),O(I=>C(p,`最終更新: ${I??""}`),[()=>(s(a),f(()=>new Date(s(a).lastUpdated).toLocaleTimeString("ja-JP")))]),w(i,d)};k(M,i=>{s(a),f(()=>s(a).lastUpdated)&&i(P)})}c(me),c(de);var R=E(de,2),se=l(R);Oe(se,5,()=>U,Qe,(i,d)=>{var p=Yt();let I;var L=l(p),D=l(L,!0);c(L);var x=E(L,2),o=l(x,!0);c(x),c(p),O(m=>{I=pe(p,1,"sport-tab svelte-srgitj",null,I,m),p.disabled=(s(a),f(()=>s(a).loading)),Ie(p,"aria-label",`${s(d),f(()=>s(d).name)??""}のトーナメントを表示`),C(D,(s(d),f(()=>s(d).icon))),C(o,(s(d),f(()=>s(d).name)))},[()=>({active:s(a).currentSport===s(d).key})]),Q("click",p,()=>K(s(d).key)),w(i,p)}),c(se),c(R);var W=E(R,2),ge=l(W);{var he=i=>{var d=Kt(),p=l(d),I=E(l(p),2),L=l(I,!0);c(I);var D=E(I,2);c(p),c(d),O(()=>C(L,(s(a),f(()=>s(a).error)))),Q("click",D,te),w(i,d)},ie=i=>{var d=Le(),p=be(d);{var I=D=>{var x=er(),o=l(x);ft(o,{size:"large"}),Ge(2),c(x),w(D,x)},L=D=>{var x=Le(),o=be(x);{var m=_=>{var S=tr(),F=l(S);Qt(F,{get sport(){return s(a),f(()=>s(a).currentSport)},get matches(){return s(Y)},isAdmin:!1}),c(S),w(_,S)},A=_=>{var S=rr(),F=l(S),J=E(l(F),2),_e=l(J);c(J);var j=E(J,2);c(F),c(S),O(q=>C(_e,`${q??""}のトーナメントはまだ開始されていません。`),[()=>(s(a),f(()=>z(s(a).currentSport)))]),Q("click",j,te),w(_,S)};k(o,_=>{s(b),s(Y),f(()=>s(b)&&s(Y).length>0)?_(m):_(A,!1)},!0)}w(D,x)};k(p,D=>{s(a),s(b),f(()=>s(a).loading&&!s(b))?D(I):D(L,!1)},!0)}w(i,d)};k(ge,i=>{s(a),f(()=>s(a).error)?i(he):i(ie,!1)})}c(W),c(ue),c(B),O(i=>{re.disabled=(s(a),s($),f(()=>s(a).loading||s($).loading)),u=pe(ve,1,"refresh-icon svelte-srgitj",null,u,i)},[()=>({spinning:s(a).loading||s($).loading})]),Q("click",re,te),w(r,B),Ne(),n()}export{dr as component};
