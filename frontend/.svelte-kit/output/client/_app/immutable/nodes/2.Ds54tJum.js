import"../chunks/Cm9PB-7n.js";import{i as e}from"../chunks/B-6MdqlE.js";import{z as t,ak as s,O as a,al as n,K as i,w as r,v as o,am as l,A as c,G as d,u as v,I as u,H as m,C as p,J as h,D as f,F as w,B as g,N as b,L as y,at as k,M as $,aw as j,ab as S,$ as N,Q as _,R as q}from"../chunks/VVabkdHj.js";import{p as L,i as x,s as z,a as D}from"../chunks/BSkGyvYi.js";import{s as I,c as A,r as T,a as B,u as E,e as J}from"../chunks/JJD-QFX9.js";import{S as P,t as U}from"../chunks/D8uSMR3S.js";import{e as C,i as M,R as O,L as R,A as F}from"../chunks/BH2mRkq2.js";import{b as G}from"../chunks/BCfgoF3A.js";function H(e){return{pending:"未実施",in_progress:"進行中",completed:"完了",cancelled:"キャンセル"}[e]||e}function K(e,t){return null==e||null==t?"未実施":`${e} - ${t}`}function Q(e,t=10){return e?e.length<=t?e:e.substring(0,t-3)+"...":""}var W=c('<div class="round svelte-l0munw" data-testid="match-round"> </div>'),V=c('<div class="schedule svelte-l0munw" data-testid="match-schedule"> </div>'),X=c('<span class="winner-badge svelte-l0munw">🏆</span>'),Y=c('<span class="winner-badge svelte-l0munw">🏆</span>'),Z=c('<div class="score-edit svelte-l0munw" data-testid="score-edit"><input type="number" min="0" class="score-input svelte-l0munw" data-testid="score1-input" placeholder="0"/> <span class="score-separator svelte-l0munw">-</span> <input type="number" min="0" class="score-input svelte-l0munw" data-testid="score2-input" placeholder="0"/></div> <div class="edit-actions svelte-l0munw"><button class="btn btn-primary btn-sm svelte-l0munw" data-testid="save-score-btn">保存</button> <button class="btn btn-secondary btn-sm svelte-l0munw" data-testid="cancel-edit-btn">キャンセル</button></div>',1),ee=c('<div class="score svelte-l0munw"> </div>'),te=c('<div class="status svelte-l0munw" data-testid="match-status"> </div>'),se=c('<button class="edit-btn svelte-l0munw" data-testid="edit-match-btn" aria-label="試合結果を編集">✏️ 編集</button>'),ae=c('<div class="score-display svelte-l0munw" data-testid="score-display"><!></div> <!>',1),ne=c('<div class="match-details svelte-l0munw"><div class="completion-time svelte-l0munw" data-testid="completion-time"> </div></div>'),ie=c('<div data-testid="match-card"><div class="match-header svelte-l0munw"><!> <!></div> <div class="teams svelte-l0munw"><div data-testid="team1"><span class="team-name svelte-l0munw"> </span> <!></div> <div class="vs-section svelte-l0munw"><span class="vs svelte-l0munw">vs</span></div> <div data-testid="team2"><!> <span class="team-name svelte-l0munw"> </span></div></div> <div class="score-section svelte-l0munw"><!></div> <!></div>');var re=c('<p class="no-matches svelte-10kswq8">試合データがありません</p>'),oe=c('<div class="winner-indicator svelte-10kswq8"> </div>'),le=c('<button class="edit-button svelte-10kswq8" aria-label="試合結果を編集">結果入力</button>'),ce=c('<div class="connection-line svelte-10kswq8" aria-hidden="true"></div>'),de=c('<div class="match-wrapper svelte-10kswq8"><div class="match-card-container svelte-10kswq8"><!> <!> <!></div> <!></div>'),ve=c('<div class="round-column svelte-10kswq8"><h3 class="round-title svelte-10kswq8"> </h3> <div class="matches-container svelte-10kswq8"></div></div>'),ue=c('<div class="bracket-container svelte-10kswq8"></div>'),me=c('<div><div class="bracket-header svelte-10kswq8"><h2 class="tournament-title svelte-10kswq8"> </h2> <!></div> <!></div>');function pe(c,y){t(y,!1);const k=a(),$=a();let j=L(y,"sport",8,"volleyball"),S=L(y,"matches",24,()=>[]),N=L(y,"isAdmin",8,!1),_=L(y,"onEditMatch",8,null);const q={volleyball:"バレーボール",table_tennis:"卓球",soccer:"サッカー"},z={round_1:"1回戦",round_2:"2回戦",quarterfinal:"準々決勝",semifinal:"準決勝",final:"決勝",third_place:"3位決定戦"};function D(e){if(e.winner)return e.winner;if(void 0!==e.score1&&void 0!==e.score2){if(e.score1>e.score2)return e.team1;if(e.score2>e.score1)return e.team2}return null}function E(e){return"completed"===e.status||void 0!==e.score1&&void 0!==e.score2?"completed":"in_progress"===e.status?"in_progress":"pending"}function J(){if("undefined"!=typeof window){const e=window.innerWidth;return e<768?"mobile":e<1024?"tablet":"desktop"}return"desktop"}let P=a("desktop");"undefined"!=typeof window&&(i(P,J()),window.addEventListener("resize",()=>{i(P,J())})),n(()=>r(S()),()=>{var e;i(k,(e=S(),Array.isArray(e)?e.reduce((e,t)=>{if(!t||"object"!=typeof t)return e;const s=t.round||"unknown";return e[s]||(e[s]=[]),e[s].push(t),e},{}):{}))}),n(()=>o(k),()=>{i($,function(e){const t=Object.keys(e),s=["round_1","round_2","quarterfinal","semifinal","third_place","final"];return s.filter(e=>t.includes(e)).concat(t.filter(e=>!s.includes(e)))}(o(k)))}),l(),e();var U=me(),O=d(U),R=d(O),F=d(R);m(R);var pe=u(R,2),he=e=>{var t=re();f(e,t)};x(pe,e=>{r(S()),v(()=>0===S().length)&&e(he)}),m(O);var fe=u(O,2),we=c=>{var y=ue();C(y,5,()=>o($),M,(c,y)=>{var $=ve(),j=d($),S=d(j,!0);m(j);var q=u(j,2);C(q,5,()=>(o(k),o(y),v(()=>o(k)[o(y)])),e=>e.id,(c,k)=>{var $=de(),j=d($),S=d(j);!function(c,y){t(y,!1);const k=a(),$=a(),j=a(),S=a();let N=L(y,"match",24,()=>({})),_=L(y,"editable",8,!1),q=L(y,"compact",8,!1);const z=s();let D=a(!1),B=a(N().score1||""),E=a(N().score2||"");function J(){_()&&(i(D,!o(D)),o(D)&&(i(B,N().score1||""),i(E,N().score2||"")))}function P(){const e=parseInt(o(B)),t=parseInt(o(E));isNaN(e)||isNaN(t)||e<0||t<0?z("error",{message:"スコアは0以上の数値を入力してください"}):(z("updateScore",{matchId:N().id,score1:e,score2:t}),i(D,!1))}function U(){i(D,!1),i(B,N().score1||""),i(E,N().score2||"")}function C(e){"Enter"===e.key?P():"Escape"===e.key&&U()}n(()=>r(N()),()=>{var e;i(k,(e=N()).winner?e.winner:null!==e.score1&&null!==e.score2&&void 0!==e.score1&&void 0!==e.score2?e.score1>e.score2?e.team1:e.score2>e.score1?e.team2:"draw":null)}),n(()=>(r(q()),r(_()),o(D)),()=>{i($,["match-card",q()?"compact":"",_()?"editable":"",o(D)?"edit-mode":""].filter(Boolean).join(" "))}),n(()=>(o(k),r(N())),()=>{i(j,["team",o(k)===N().team1?"winner":""].filter(Boolean).join(" "))}),n(()=>(o(k),r(N())),()=>{i(S,["team",o(k)===N().team2?"winner":""].filter(Boolean).join(" "))}),l(),e();var M=ie(),O=d(M),R=d(O),F=e=>{var t=W(),s=d(t,!0);m(t),p(()=>h(s,(r(N()),v(()=>N().round)))),f(e,t)};x(R,e=>{r(N()),v(()=>N().round)&&e(F)});var re=u(R,2),oe=e=>{var t=V(),s=d(t,!0);m(t),p(e=>h(s,e),[()=>(r(N()),v(()=>new Date(N().scheduled_at).toLocaleDateString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})))]),f(e,t)};x(re,e=>{r(N()),v(()=>N().scheduled_at)&&e(oe)}),m(O);var le=u(O,2),ce=d(le),de=d(ce),ve=d(de,!0);m(de);var ue=u(de,2),me=e=>{var t=X();f(e,t)};x(ue,e=>{o(k),r(N()),v(()=>o(k)===N().team1)&&e(me)}),m(ce);var pe=u(ce,4),he=d(pe),fe=e=>{var t=Y();f(e,t)};x(he,e=>{o(k),r(N()),v(()=>o(k)===N().team2)&&e(fe)});var we=u(he,2),ge=d(we,!0);m(we),m(pe),m(le);var be=u(le,2),ye=d(be),ke=e=>{var t=Z(),s=g(t),a=d(s);T(a);var n=u(a,4);T(n),m(s);var r=u(s,2),l=d(r),c=u(l,2);m(r),G(a,()=>o(B),e=>i(B,e)),b("keydown",a,C),G(n,()=>o(E),e=>i(E,e)),b("keydown",n,C),b("click",l,P),b("click",c,U),f(e,t)},$e=e=>{var t=ae(),s=g(t),a=d(s),n=e=>{var t=ee(),s=d(t,!0);m(t),p(e=>h(s,e),[()=>(r(K),r(N()),v(()=>K(N().score1,N().score2)))]),f(e,t)},i=e=>{var t=te(),s=d(t,!0);m(t),p(e=>h(s,e),[()=>(r(H),r(N()),v(()=>H(N().status||"pending")))]),f(e,t)};x(a,e=>{r(N()),v(()=>null!==N().score1&&void 0!==N().score1&&null!==N().score2&&void 0!==N().score2)?e(n):e(i,!1)}),m(s);var o=u(s,2),l=e=>{var t=se();b("click",t,J),f(e,t)};x(o,e=>{r(_()),r(N()),v(()=>_()&&"completed"!==N().status)&&e(l)}),f(e,t)};x(ye,e=>{o(D)?e(ke):e($e,!1)}),m(be);var je=u(be,2),Se=e=>{var t=ne(),s=d(t),a=d(s);m(s),m(t),p(e=>h(a,`完了: ${e??""}`),[()=>(r(N()),v(()=>new Date(N().completed_at).toLocaleDateString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})))]),f(e,t)};x(je,e=>{r(q()),r(N()),v(()=>!q()&&(N().completed_at||"completed"===N().status))&&e(Se)}),m(M),p((e,t)=>{I(M,1,A(o($)),"svelte-l0munw"),I(ce,1,A(o(j)),"svelte-l0munw"),h(ve,e),I(pe,1,A(o(S)),"svelte-l0munw"),h(ge,t)},[()=>(r(Q),r(N()),r(q()),v(()=>Q(N().team1||"Team A",q()?8:15))),()=>(r(Q),r(N()),r(q()),v(()=>Q(N().team2||"Team B",q()?8:15)))]),f(c,M),w()}(S,{get match(){return o(k)},get editable(){return N()}});var q=u(S,2),z=e=>{var t=oe(),s=d(t);m(t),p(e=>h(s,`勝者: ${e??""}`),[()=>(o(k),v(()=>D(o(k))))]),f(e,t)};x(q,e=>{o(k),v(()=>D(o(k)))&&e(z)});var J=u(q,2),P=e=>{var t=le();b("click",t,()=>function(e){N()&&_()&&"function"==typeof _()&&_()(e)}(o(k))),f(e,t)};x(J,e=>{r(N()),o(k),v(()=>N()&&"pending"===E(o(k)))&&e(P)}),m(j);var U=u(j,2),C=e=>{var t=ce();f(e,t)};x(U,e=>{"final"!==o(y)&&"third_place"!==o(y)&&e(C)}),m($),p(e=>B($,"data-status",e),[()=>(o(k),v(()=>E(o(k))))]),f(c,$)}),m(q),m($),p(()=>{B($,"data-round",o(y)),h(S,(o(y),v(()=>z[o(y)]||o(y))))}),f(c,$)}),m(y),f(c,y)};x(fe,e=>{r(S()),v(()=>S().length>0)&&e(we)}),m(U),p(()=>{I(U,1,`tournament-bracket ${o(P)??""}`,"svelte-10kswq8"),h(F,`${r(j()),v(()=>q[j()]||j())??""} トーナメント`)}),f(c,U),w()}var he=c('<meta name="description" content="バレーボール、卓球、サッカーのトーナメント結果をリアルタイムで確認できます"/>'),fe=c('<span class="last-updated responsive-text size-sm svelte-eh2fp7"> </span>'),we=c('<button slot="default"><span class="sport-icon svelte-eh2fp7"> </span> <span class="sport-name responsive-text size-sm svelte-eh2fp7"> </span></button>'),ge=c('<div class="error-container svelte-eh2fp7"><div class="error-message svelte-eh2fp7"><h3 class="svelte-eh2fp7">エラーが発生しました</h3> <p class="svelte-eh2fp7"> </p> <button class="retry-button touch-friendly svelte-eh2fp7">再試行</button></div></div>'),be=c('<div class="loading-container svelte-eh2fp7"><!> <p class="loading-text responsive-text size-lg svelte-eh2fp7">トーナメントデータを読み込み中...</p></div>'),ye=c('<div class="no-data-container svelte-eh2fp7"><div class="no-data-message svelte-eh2fp7"><h3 class="svelte-eh2fp7">トーナメントデータがありません</h3> <p class="svelte-eh2fp7"> </p> <button class="refresh-button touch-friendly svelte-eh2fp7">データを確認</button></div></div>'),ke=c('<div class="page-header svelte-eh2fp7"><h1 class="page-title responsive-text size-4xl svelte-eh2fp7">トーナメント管理システム</h1> <p class="page-description responsive-text size-lg svelte-eh2fp7">リアルタイムでトーナメントの進行状況を確認できます</p> <div class="header-actions responsive-flex justify-center align-center svelte-eh2fp7"><button class="refresh-button touch-friendly svelte-eh2fp7" aria-label="データを更新"><span>🔄</span> 更新</button> <!></div></div> <div class="sports-tabs svelte-eh2fp7"><!></div> <div class="main-content svelte-eh2fp7"><!></div>',1),$e=c('<div class="homepage svelte-eh2fp7"><!></div>');function je(s,c){t(c,!1);const[L,A]=z(),T=()=>D(U,"$tournamentStore",L),C=()=>D(J,"$uiStore",L),M=a(),G=a(),H=a(),K=a(),Q=[{key:"volleyball",name:"バレーボール",icon:"🏐"},{key:"table_tennis",name:"卓球",icon:"🏓"},{key:"soccer",name:"サッカー",icon:"⚽"}];let W=null;async function V(e,t=!0){try{t&&E.setLoading(!0);const s=await U.fetchTournaments(e);return s.success||E.showNotification(s.message||"データの取得に失敗しました","error"),s}catch(s){return E.showNotification("データの読み込みでエラーが発生しました","error"),{success:!1,message:s.message}}finally{t&&E.setLoading(!1)}}async function X(){try{E.setLoading(!0);const e=await U.refreshData(o(M).currentSport);e.success?E.showNotification("データを更新しました","success"):E.showNotification(e.message||"データの更新に失敗しました","error")}catch(e){E.showNotification("データの更新でエラーが発生しました","error")}finally{E.setLoading(!1)}}function Y(){W&&(clearInterval(W),W=null)}function Z(e){const t=Q.find(t=>t.key===e);return t?t.name:e}y(async()=>{try{await U.initialize(),await V(o(M).currentSport),Y(),W=setInterval(async()=>{if(!("undefined"!=typeof document&&document.hidden||o(M).loading||o(G).loading))try{await V(o(M).currentSport,!1)}catch(e){}},3e4)}catch(e){E.showNotification("データの読み込みに失敗しました","error")}}),k(()=>{Y()}),"undefined"!=typeof document&&document.addEventListener("visibilitychange",function(){"undefined"!=typeof document&&(document.hidden||V(o(M).currentSport,!1))}),n(()=>T(),()=>{i(M,T())}),n(()=>C(),()=>{i(G,C())}),n(()=>o(M),()=>{i(H,o(M).tournaments[o(M).currentSport]||null)}),n(()=>o(H),()=>{i(K,o(H)?.matches||[])}),l(),e(),$(e=>{var t=he();p(e=>N.title=`トーナメント管理システム - ${e??""}`,[()=>(o(M),v(()=>Z(o(M).currentSport)))]),f(e,t)}),O(s,{children:j,$$slots:{default:(e,t)=>{var s=$e(),a=d(s);O(a,{container:!0,padding:!0,children:(e,t)=>{var s=ke(),a=g(s),n=u(d(a),4),i=d(n),l=d(i);let c;_(),m(i);var w=u(i,2),y=e=>{var t=fe(),s=d(t);m(t),p(e=>h(s,`最終更新: ${e??""}`),[()=>(o(M),v(()=>new Date(o(M).lastUpdated).toLocaleTimeString("ja-JP")))]),f(e,t)};x(w,e=>{o(M),v(()=>o(M).lastUpdated)&&e(y)}),m(n),m(a);var k=u(a,2),$=d(k);{let e=S(()=>v(()=>Q.map(e=>({...e,id:e.key}))));P($,{get items(){return o(e)},staggerDelay:150,animationType:"scaleIn",tag:"div",itemTag:"div",className:"tabs-grid",itemClassName:"tab-item",children:(e,t)=>{var s=we();const a=S(()=>t.item);let n;var i=d(s),l=d(i,!0);m(i);var c=u(i,2),w=d(c,!0);m(c),m(s),p(e=>{n=I(s,1,"sport-tab touch-friendly hover-scale transition-all svelte-eh2fp7",null,n,e),s.disabled=(o(M),v(()=>o(M).loading)),B(s,"aria-label",`${r(o(a)),v(()=>o(a).name)??""}のトーナメントを表示`),h(l,(r(o(a)),v(()=>o(a).icon))),h(w,(r(o(a)),v(()=>o(a).name)))},[()=>({active:o(M).currentSport===o(a).key})]),b("click",s,()=>async function(e){try{if(e===o(M).currentSport)return;const t=U.switchSport(e);t.success?await V(e):E.showNotification(t.message||"スポーツの切り替えに失敗しました","error")}catch(t){E.showNotification("スポーツの切り替えでエラーが発生しました","error")}}(o(a).key)),f(e,s)},$$slots:{default:!0}})}m(k);var j=u(k,2),N=d(j),L=e=>{var t=ge(),s=d(t),a=u(d(s),2),n=d(a,!0);m(a);var i=u(a,2);m(s),m(t),p(()=>h(n,(o(M),v(()=>o(M).error)))),b("click",i,X),f(e,t)},z=e=>{var t=q(),s=g(t),a=e=>{var t=be(),s=d(t);R(s,{size:"large"}),_(2),m(t),f(e,t)},n=e=>{var t=q(),s=g(t),a=e=>{F(e,{show:!0,type:"fadeInUp",duration:500,className:"tournament-container",children:(e,t)=>{pe(e,{get sport(){return o(M),v(()=>o(M).currentSport)},get matches(){return o(K)},isAdmin:!1})},$$slots:{default:!0}})},n=e=>{var t=ye(),s=d(t),a=u(d(s),2),n=d(a);m(a);var i=u(a,2);m(s),m(t),p(e=>h(n,`${e??""}のトーナメントはまだ開始されていません。`),[()=>(o(M),v(()=>Z(o(M).currentSport)))]),b("click",i,X),f(e,t)};x(s,e=>{o(H),o(K),v(()=>o(H)&&o(K).length>0)?e(a):e(n,!1)},!0),f(e,t)};x(s,e=>{o(M),o(H),v(()=>o(M).loading&&!o(H))?e(a):e(n,!1)},!0),f(e,t)};x(N,e=>{o(M),v(()=>o(M).error)?e(L):e(z,!1)}),m(j),p(e=>{i.disabled=(o(M),o(G),v(()=>o(M).loading||o(G).loading)),c=I(l,1,"refresh-icon svelte-eh2fp7",null,c,e)},[()=>({spinning:o(M).loading||o(G).loading})]),b("click",i,X),f(e,s)},$$slots:{default:!0}}),m(s),f(e,s)}}}),w(),A()}export{je as component};
