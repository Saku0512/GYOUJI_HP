import{r as ue,v as B}from"../chunks/DspYYv4h.js";import{g as de,a as G}from"../chunks/DnIs1vw8.js";import"../chunks/DsnmJJEf.js";import{i as pe}from"../chunks/B1pWaKUj.js";import{a1 as me,A as c,ac as ve,a2 as h,ad as ce,a4 as M,C as a,ae as m,a5 as b,a6 as be,af as fe,a9 as d,a7 as n,aa as O,y as _,a8 as i,ag as x,ah as ge,ai as we}from"../chunks/CuY-H75l.js";import{i as P}from"../chunks/DWiXyezG.js";import{s as T,b as H,r as J,c as I,d as _e}from"../chunks/CzS31Zl-.js";import{b as Q}from"../chunks/BjkiwGu8.js";import{g as W}from"../chunks/CRuF0lUP.js";async function xe({url:k}){if(typeof window<"u"&&de()){const r=k.searchParams.get("redirect")||"/admin";throw ue(302,r)}return{}}const Re=Object.freeze(Object.defineProperty({__proto__:null,load:xe},Symbol.toStringTag,{value:"Module"}));var he=h('<span class="error-message svelte-1pxb3um"> </span>'),ye=h('<span class="error-message svelte-1pxb3um"> </span>'),Se=h('<span class="loading-spinner svelte-1pxb3um"></span> ログイン中...',1),Pe=h('<div class="loading-overlay svelte-1pxb3um"><div class="loading-content svelte-1pxb3um"><span class="loading-spinner large svelte-1pxb3um"></span> <p class="svelte-1pxb3um">認証中...</p></div></div>'),Te=h('<div class="login-container svelte-1pxb3um"><div class="login-card svelte-1pxb3um"><h1 class="svelte-1pxb3um">管理者ログイン</h1> <p class="login-description svelte-1pxb3um">トーナメント管理システムの管理者ダッシュボードにアクセスするには、認証情報を入力してください。</p> <form novalidate="" class="svelte-1pxb3um"><div class="form-group svelte-1pxb3um"><label for="username">ユーザー名</label> <input type="text" id="username" name="username" autocomplete="username" data-testid="username" required/> <!></div> <div class="form-group svelte-1pxb3um"><label for="password">パスワード</label> <div class="password-input-container svelte-1pxb3um"><input id="password" name="password" autocomplete="current-password" data-testid="password" required/> <button type="button" class="password-toggle svelte-1pxb3um"> </button></div> <!></div> <button type="submit" class="login-button svelte-1pxb3um" data-testid="login-button"><!></button></form> <!></div></div>');function Ue(k,R){me(R,!1);let r=_({username:"",password:""}),t=_({}),l=_(!1),f=_(!1),g=_({});G.subscribe(e=>{c(g,e)}),ve(()=>{if(a(g).isAuthenticated){const s=new URLSearchParams(window.location.search).get("redirect")||"/admin";W(s)}});function y(e){const s=B(a(r).username,a(r).password);s.errors[e]?x(t,a(t)[e]=s.errors[e]):delete a(t)[e],c(t,{...a(t)})}async function U(e){if(e.preventDefault(),a(l))return;const s=B(a(r).username,a(r).password);if(!s.isValid){c(t,s.errors),I("入力内容を確認してください");return}c(t,{}),c(l,!0);try{const o=await G.login({username:a(r).username.trim(),password:a(r).password});if(o.success){_e("ログインに成功しました");const le=new URLSearchParams(window.location.search).get("redirect")||"/admin";setTimeout(()=>{W(le)},500)}else{let v="ログインに失敗しました";o.error==="INVALID_CREDENTIALS"?v="ユーザー名またはパスワードが正しくありません":o.error==="ACCOUNT_LOCKED"?v="アカウントがロックされています":o.message&&(v=o.message),I(v),x(r,a(r).password="")}}catch(o){console.error("Login submission error:",o),I("ログイン処理でエラーが発生しました"),x(r,a(r).password="")}finally{c(l,!1)}}function X(){c(f,!a(f))}function V(e){e.key==="Enter"&&!a(l)&&U(e)}pe();var L=Te();ce(e=>{fe.title="管理者ログイン - Tournament Management System"});var j=n(L),S=d(n(j),4),A=n(S),q=n(A);let K;var p=d(q,2);J(p);let N;var Y=d(p,2);{var Z=e=>{var s=he(),o=n(s,!0);i(s),M(()=>O(o,a(t).username)),b(e,s)};P(Y,e=>{a(t).username&&e(Z)})}i(A);var C=d(A,2),$=n(C);let z;var E=d($,2),u=n(E);J(u);let F;var w=d(u,2),ee=n(w,!0);i(w),i(E);var ae=d(E,2);{var se=e=>{var s=ye(),o=n(s,!0);i(s),M(()=>O(o,a(t).password)),b(e,s)};P(ae,e=>{a(t).password&&e(se)})}i(C);var D=d(C,2),re=n(D);{var te=e=>{var s=Se();ge(),b(e,s)},oe=e=>{var s=we("ログイン");b(e,s)};P(re,e=>{a(l)||a(g).loading?e(te):e(oe,!1)})}i(D),i(S);var ne=d(S,2);{var ie=e=>{var s=Pe();b(e,s)};P(ne,e=>{a(g).loading&&e(ie)})}i(j),i(L),M((e,s,o,v)=>{K=T(q,1,"svelte-1pxb3um",null,K,e),p.disabled=a(l),N=T(p,1,"svelte-1pxb3um",null,N,s),z=T($,1,"svelte-1pxb3um",null,z,o),H(u,"type",a(f)?"text":"password"),u.disabled=a(l),F=T(u,1,"svelte-1pxb3um",null,F,v),w.disabled=a(l),H(w,"aria-label",a(f)?"パスワードを隠す":"パスワードを表示"),O(ee,a(f)?"🙈":"👁️"),D.disabled=a(l)||a(g).loading},[()=>({error:a(t).username}),()=>({error:a(t).username}),()=>({error:a(t).password}),()=>({error:a(t).password})]),Q(p,()=>a(r).username,e=>x(r,a(r).username=e)),m("blur",p,()=>y("username")),m("input",p,()=>y("username")),m("keydown",p,V),Q(u,()=>a(r).password,e=>x(r,a(r).password=e)),m("blur",u,()=>y("password")),m("input",u,()=>y("password")),m("keydown",u,V),m("click",w,X),m("submit",S,U),b(k,L),be()}export{Ue as component,Re as universal};
