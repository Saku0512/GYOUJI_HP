import{R as de,g as J}from"../chunks/BGq6rDGP.js";import{g as pe,a as B}from"../chunks/DWufORZG.js";import"../chunks/DsnmJJEf.js";import"../chunks/DUpwANU7.js";import{o as me,e as c,a as R}from"../chunks/CT_lE3Pl.js";import{a3 as ue,K as f,$ as x,a0 as ce,a5 as M,A as s,a1 as h,a6 as ve,a2 as be,a9 as p,a7 as l,J as y,a8 as n,aq as S,ar as fe,as as he}from"../chunks/BqLxJNge.js";import{i as T}from"../chunks/B7cxby2x.js";import{s as L,b as G,r as H,c as V,d as ge}from"../chunks/DT5H3szw.js";import{b as Q}from"../chunks/CI-XvY1A.js";import{i as we}from"../chunks/B2k5sg_-.js";function _e(m,v){throw new de(m,v.toString())}async function ye({url:m}){if(typeof window<"u"&&pe()){const a=m.searchParams.get("redirect")||"/admin";throw _e(302,a)}return{}}const qe=Object.freeze(Object.defineProperty({__proto__:null,load:ye},Symbol.toStringTag,{value:"Module"}));function W(m,v){const a={};return(!m||m.trim().length===0)&&(a.username="ユーザー名は必須です"),(!v||v.length===0)&&(a.password="パスワードは必須です"),{isValid:Object.keys(a).length===0,errors:a}}var Se=x('<span class="error-message svelte-pblh9m"> </span>'),xe=x('<span class="error-message svelte-pblh9m"> </span>'),Pe=x('<span class="loading-spinner svelte-pblh9m"></span> ログイン中...',1),ke=x('<div class="loading-overlay svelte-pblh9m"><div class="loading-content svelte-pblh9m"><span class="loading-spinner large svelte-pblh9m"></span> <p class="svelte-pblh9m">認証中...</p></div></div>'),Te=x('<div class="login-container svelte-pblh9m"><div class="login-card svelte-pblh9m"><h1 class="svelte-pblh9m">管理者ログイン</h1> <p class="login-description svelte-pblh9m">トーナメント管理システムの管理者ダッシュボードにアクセスするには、認証情報を入力してください。</p> <form novalidate="" class="svelte-pblh9m"><div class="form-group svelte-pblh9m"><label for="username">ユーザー名</label> <input type="text" id="username" name="username" autocomplete="username" data-testid="username" required/> <!></div> <div class="form-group svelte-pblh9m"><label for="password">パスワード</label> <div class="password-input-container svelte-pblh9m"><input id="password" name="password" autocomplete="current-password" data-testid="password" required/> <button type="button" class="password-toggle svelte-pblh9m"> </button></div> <!></div> <button type="submit" class="login-button svelte-pblh9m" data-testid="login-button"><!></button></form> <!></div></div>');function Ie(m,v){ue(v,!1);let a=y({username:"",password:""}),t=y({}),i=y(!1),g=y(!1),w=y({});B.subscribe(e=>{f(w,e)}),me(()=>{if(s(w).isAuthenticated){const r=new URLSearchParams(window.location.search).get("redirect")||"/admin";J(r)}});function P(e){const r=W(s(a).username,s(a).password);r.errors[e]?S(t,s(t)[e]=r.errors[e]):delete s(t)[e],f(t,{...s(t)})}async function j(e){if(e.preventDefault(),s(i))return;const r=W(s(a).username,s(a).password);if(!r.isValid){f(t,r.errors),V("入力内容を確認してください");return}f(t,{}),f(i,!0);try{const o=await B.login({username:s(a).username.trim(),password:s(a).password});if(o.success){ge("ログインに成功しました");const ie=new URLSearchParams(window.location.search).get("redirect")||"/admin";setTimeout(()=>{J(ie)},500)}else{let b="ログインに失敗しました";o.error==="INVALID_CREDENTIALS"?b="ユーザー名またはパスワードが正しくありません":o.error==="ACCOUNT_LOCKED"?b="アカウントがロックされています":o.message&&(b=o.message),V(b),S(a,s(a).password="")}}catch(o){console.error("Login submission error:",o),V("ログイン処理でエラーが発生しました"),S(a,s(a).password="")}finally{f(i,!1)}}function X(){f(g,!s(g))}function q(e){e.key==="Enter"&&!s(i)&&j(e)}we();var A=Te();ce(e=>{be.title="管理者ログイン - Tournament Management System"});var I=l(A),k=p(l(I),4),E=l(k),K=l(E);let U;var u=p(K,2);H(u);let $;var Y=p(u,2);{var Z=e=>{var r=Se(),o=l(r,!0);n(r),M(()=>R(o,s(t).username)),h(e,r)};T(Y,e=>{s(t).username&&e(Z)})}n(E);var C=p(E,2),N=l(C);let z;var D=p(N,2),d=l(D);H(d);let F;var _=p(d,2),ee=l(_,!0);n(_),n(D);var se=p(D,2);{var ae=e=>{var r=xe(),o=l(r,!0);n(r),M(()=>R(o,s(t).password)),h(e,r)};T(se,e=>{s(t).password&&e(ae)})}n(C);var O=p(C,2),re=l(O);{var te=e=>{var r=Pe();fe(),h(e,r)},oe=e=>{var r=he("ログイン");h(e,r)};T(re,e=>{s(i)||s(w).loading?e(te):e(oe,!1)})}n(O),n(k);var le=p(k,2);{var ne=e=>{var r=ke();h(e,r)};T(le,e=>{s(w).loading&&e(ne)})}n(I),n(A),M((e,r,o,b)=>{U=L(K,1,"svelte-pblh9m",null,U,e),u.disabled=s(i),$=L(u,1,"svelte-pblh9m",null,$,r),z=L(N,1,"svelte-pblh9m",null,z,o),G(d,"type",s(g)?"text":"password"),d.disabled=s(i),F=L(d,1,"svelte-pblh9m",null,F,b),_.disabled=s(i),G(_,"aria-label",s(g)?"パスワードを隠す":"パスワードを表示"),R(ee,s(g)?"🙈":"👁️"),O.disabled=s(i)||s(w).loading},[()=>({error:s(t).username}),()=>({error:s(t).username}),()=>({error:s(t).password}),()=>({error:s(t).password})]),Q(u,()=>s(a).username,e=>S(a,s(a).username=e)),c("blur",u,()=>P("username")),c("input",u,()=>P("username")),c("keydown",u,q),Q(d,()=>s(a).password,e=>S(a,s(a).password=e)),c("blur",d,()=>P("password")),c("input",d,()=>P("password")),c("keydown",d,q),c("click",_,X),c("submit",k,j),h(m,A),ve()}export{Ie as component,qe as universal};
